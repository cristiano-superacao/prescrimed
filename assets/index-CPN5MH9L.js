import{a as e,b as t,g as s,R as a,u as r,r as i,L as n,N as l,O as o,c as d,H as c,d as m,e as x}from"./vendor-KI1TBco6.js";import{z as p,B as u,M as h,L as b,A as f,U as g,S as j,a as v,H as y,b as N,P as w,c as S,F as C,d as k,T as A,R as E,D as P,C as R,e as z,f as D,g as T,h as _,i as L,j as $,k as O,X as q,l as I,m as F,n as B,o as M,p as U,q as V,r as G,s as H,t as J,u as Q,v as W,w as K,I as Y,x as X,y as Z,E as ee,G as te,J as se,K as ae,N as re,O as ie,Q as ne,V as le,W as oe,Y as de,Z as ce,_ as me,$ as xe,a0 as pe,a1 as ue,a2 as he,a3 as be,a4 as fe,a5 as ge,a6 as je,a7 as ve,a8 as ye,a9 as Ne,aa as we,ab as Se,ac as Ce,ad as ke,ae as Ae,af as Ee,ag as Pe,ah as Re,ai as ze,aj as De,ak as Te,al as _e}from"./ui-CfLhLiz_.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var Le,$e,Oe={exports:{}},qe={};var Ie,Fe=($e||($e=1,Oe.exports=function(){if(Le)return qe;Le=1;var t=e(),s=Symbol.for("react.element"),a=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,i=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,n={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,a){var l,o={},d=null,c=null;for(l in void 0!==a&&(d=""+a),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(c=t.ref),t)r.call(t,l)&&!n.hasOwnProperty(l)&&(o[l]=t[l]);if(e&&e.defaultProps)for(l in t=e.defaultProps)void 0===o[l]&&(o[l]=t[l]);return{$$typeof:s,type:e,key:d,ref:c,props:o,_owner:i.current}}return qe.Fragment=a,qe.jsx=l,qe.jsxs=l,qe}()),Oe.exports),Be={};const Me=s(function(){if(Ie)return Be;Ie=1;var e=t();return Be.createRoot=e.createRoot,Be.hydrateRoot=e.hydrateRoot,Be}());"undefined"!=typeof window&&(window.showToast=function(e,t="info"){const s={duration:4e3};return"success"===t?p.success(e,s):"error"===t?p.error(e,s):"loading"===t?p.loading(e,s):p(e,s)});const Ue=e=>{let t;const s=new Set,a=(e,a)=>{const r="function"==typeof e?e(t):e;if(!Object.is(r,t)){const e=t;t=(null!=a?a:"object"!=typeof r||null===r)?r:Object.assign({},t,r),s.forEach(s=>s(t,e))}},r=()=>t,i={setState:a,getState:r,getInitialState:()=>n,subscribe:e=>(s.add(e),()=>s.delete(e)),destroy:()=>{s.clear()}},n=t=e(a,r,i);return i};var Ve,Ge,He,Je,Qe={exports:{}},We={},Ke={exports:{}},Ye={};function Xe(){return Ge||(Ge=1,Ke.exports=function(){if(Ve)return Ye;Ve=1;var t=e(),s="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},a=t.useState,r=t.useEffect,i=t.useLayoutEffect,n=t.useDebugValue;function l(e){var t=e.getSnapshot;e=e.value;try{var a=t();return!s(e,a)}catch(r){return!0}}var o="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var s=t(),o=a({inst:{value:s,getSnapshot:t}}),d=o[0].inst,c=o[1];return i(function(){d.value=s,d.getSnapshot=t,l(d)&&c({inst:d})},[e,s,t]),r(function(){return l(d)&&c({inst:d}),e(function(){l(d)&&c({inst:d})})},[e]),n(s),s};return Ye.useSyncExternalStore=void 0!==t.useSyncExternalStore?t.useSyncExternalStore:o,Ye}()),Ke.exports}const Ze=s((Je||(Je=1,Qe.exports=function(){if(He)return We;He=1;var t=e(),s=Xe(),a="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},r=s.useSyncExternalStore,i=t.useRef,n=t.useEffect,l=t.useMemo,o=t.useDebugValue;return We.useSyncExternalStoreWithSelector=function(e,t,s,d,c){var m=i(null);if(null===m.current){var x={hasValue:!1,value:null};m.current=x}else x=m.current;m=l(function(){function e(e){if(!n){if(n=!0,r=e,e=d(e),void 0!==c&&x.hasValue){var t=x.value;if(c(t,e))return i=t}return i=e}if(t=i,a(r,e))return t;var s=d(e);return void 0!==c&&c(t,s)?(r=e,t):(r=e,i=s)}var r,i,n=!1,l=void 0===s?null:s;return[function(){return e(t())},null===l?void 0:function(){return e(l())}]},[t,s,d,c]);var p=r(e,m[0],m[1]);return n(function(){x.hasValue=!0,x.value=p},[p]),o(p),p},We}()),Qe.exports)),et={},{useDebugValue:tt}=a,{useSyncExternalStoreWithSelector:st}=Ze;let at=!1;const rt=e=>e;const it=e=>{const t="function"==typeof e?(e=>e?Ue(e):Ue)(e):e,s=(e,s)=>function(e,t=rt,s){"production"!==(et?"github":void 0)&&s&&!at&&(at=!0);const a=st(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,s);return tt(a),a}(t,e,s);return Object.assign(s,t),s};function nt(e,t){return function(){return e.apply(t,arguments)}}const{toString:lt}=Object.prototype,{getPrototypeOf:ot}=Object,{iterator:dt,toStringTag:ct}=Symbol,mt=(e=>t=>{const s=lt.call(t);return e[s]||(e[s]=s.slice(8,-1).toLowerCase())})(Object.create(null)),xt=e=>(e=e.toLowerCase(),t=>mt(t)===e),pt=e=>t=>typeof t===e,{isArray:ut}=Array,ht=pt("undefined");function bt(e){return null!==e&&!ht(e)&&null!==e.constructor&&!ht(e.constructor)&&jt(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const ft=xt("ArrayBuffer");const gt=pt("string"),jt=pt("function"),vt=pt("number"),yt=e=>null!==e&&"object"==typeof e,Nt=e=>{if("object"!==mt(e))return!1;const t=ot(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||ct in e||dt in e)},wt=xt("Date"),St=xt("File"),Ct=xt("Blob"),kt=xt("FileList"),At=xt("URLSearchParams"),[Et,Pt,Rt,zt]=["ReadableStream","Request","Response","Headers"].map(xt);function Dt(e,t,{allOwnKeys:s=!1}={}){if(null==e)return;let a,r;if("object"!=typeof e&&(e=[e]),ut(e))for(a=0,r=e.length;a<r;a++)t.call(null,e[a],a,e);else{if(bt(e))return;const r=s?Object.getOwnPropertyNames(e):Object.keys(e),i=r.length;let n;for(a=0;a<i;a++)n=r[a],t.call(null,e[n],n,e)}}function Tt(e,t){if(bt(e))return null;t=t.toLowerCase();const s=Object.keys(e);let a,r=s.length;for(;r-- >0;)if(a=s[r],t===a.toLowerCase())return a;return null}const _t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,Lt=e=>!ht(e)&&e!==_t;const $t=(e=>t=>e&&t instanceof e)("undefined"!=typeof Uint8Array&&ot(Uint8Array)),Ot=xt("HTMLFormElement"),qt=(({hasOwnProperty:e})=>(t,s)=>e.call(t,s))(Object.prototype),It=xt("RegExp"),Ft=(e,t)=>{const s=Object.getOwnPropertyDescriptors(e),a={};Dt(s,(s,r)=>{let i;!1!==(i=t(s,r,e))&&(a[r]=i||s)}),Object.defineProperties(e,a)};const Bt=xt("AsyncFunction"),Mt=(Ut="function"==typeof setImmediate,Vt=jt(_t.postMessage),Ut?setImmediate:Vt?(Gt=`axios@${Math.random()}`,Ht=[],_t.addEventListener("message",({source:e,data:t})=>{e===_t&&t===Gt&&Ht.length&&Ht.shift()()},!1),e=>{Ht.push(e),_t.postMessage(Gt,"*")}):e=>setTimeout(e));var Ut,Vt,Gt,Ht;const Jt="undefined"!=typeof queueMicrotask?queueMicrotask.bind(_t):"undefined"!=typeof process&&process.nextTick||Mt,Qt={isArray:ut,isArrayBuffer:ft,isBuffer:bt,isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||jt(e.append)&&("formdata"===(t=mt(e))||"object"===t&&jt(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&ft(e.buffer),t},isString:gt,isNumber:vt,isBoolean:e=>!0===e||!1===e,isObject:yt,isPlainObject:Nt,isEmptyObject:e=>{if(!yt(e)||bt(e))return!1;try{return 0===Object.keys(e).length&&Object.getPrototypeOf(e)===Object.prototype}catch(t){return!1}},isReadableStream:Et,isRequest:Pt,isResponse:Rt,isHeaders:zt,isUndefined:ht,isDate:wt,isFile:St,isBlob:Ct,isRegExp:It,isFunction:jt,isStream:e=>yt(e)&&jt(e.pipe),isURLSearchParams:At,isTypedArray:$t,isFileList:kt,forEach:Dt,merge:function e(){const{caseless:t,skipUndefined:s}=Lt(this)&&this||{},a={},r=(r,i)=>{const n=t&&Tt(a,i)||i;Nt(a[n])&&Nt(r)?a[n]=e(a[n],r):Nt(r)?a[n]=e({},r):ut(r)?a[n]=r.slice():s&&ht(r)||(a[n]=r)};for(let i=0,n=arguments.length;i<n;i++)arguments[i]&&Dt(arguments[i],r);return a},extend:(e,t,s,{allOwnKeys:a}={})=>(Dt(t,(t,a)=>{s&&jt(t)?e[a]=nt(t,s):e[a]=t},{allOwnKeys:a}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,s,a)=>{e.prototype=Object.create(t.prototype,a),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),s&&Object.assign(e.prototype,s)},toFlatObject:(e,t,s,a)=>{let r,i,n;const l={};if(t=t||{},null==e)return t;do{for(r=Object.getOwnPropertyNames(e),i=r.length;i-- >0;)n=r[i],a&&!a(n,e,t)||l[n]||(t[n]=e[n],l[n]=!0);e=!1!==s&&ot(e)}while(e&&(!s||s(e,t))&&e!==Object.prototype);return t},kindOf:mt,kindOfTest:xt,endsWith:(e,t,s)=>{e=String(e),(void 0===s||s>e.length)&&(s=e.length),s-=t.length;const a=e.indexOf(t,s);return-1!==a&&a===s},toArray:e=>{if(!e)return null;if(ut(e))return e;let t=e.length;if(!vt(t))return null;const s=new Array(t);for(;t-- >0;)s[t]=e[t];return s},forEachEntry:(e,t)=>{const s=(e&&e[dt]).call(e);let a;for(;(a=s.next())&&!a.done;){const s=a.value;t.call(e,s[0],s[1])}},matchAll:(e,t)=>{let s;const a=[];for(;null!==(s=e.exec(t));)a.push(s);return a},isHTMLForm:Ot,hasOwnProperty:qt,hasOwnProp:qt,reduceDescriptors:Ft,freezeMethods:e=>{Ft(e,(t,s)=>{if(jt(e)&&-1!==["arguments","caller","callee"].indexOf(s))return!1;const a=e[s];jt(a)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")}))})},toObjectSet:(e,t)=>{const s={},a=e=>{e.forEach(e=>{s[e]=!0})};return ut(e)?a(e):a(String(e).split(t)),s},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,s){return t.toUpperCase()+s}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:Tt,global:_t,isContextDefined:Lt,isSpecCompliantForm:function(e){return!!(e&&jt(e.append)&&"FormData"===e[ct]&&e[dt])},toJSONObject:e=>{const t=new Array(10),s=(e,a)=>{if(yt(e)){if(t.indexOf(e)>=0)return;if(bt(e))return e;if(!("toJSON"in e)){t[a]=e;const r=ut(e)?[]:{};return Dt(e,(e,t)=>{const i=s(e,a+1);!ht(i)&&(r[t]=i)}),t[a]=void 0,r}}return e};return s(e,0)},isAsyncFn:Bt,isThenable:e=>e&&(yt(e)||jt(e))&&jt(e.then)&&jt(e.catch),setImmediate:Mt,asap:Jt,isIterable:e=>null!=e&&jt(e[dt])};function Wt(e,t,s,a,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),s&&(this.config=s),a&&(this.request=a),r&&(this.response=r,this.status=r.status?r.status:null)}Qt.inherits(Wt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Qt.toJSONObject(this.config),code:this.code,status:this.status}}});const Kt=Wt.prototype,Yt={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Yt[e]={value:e}}),Object.defineProperties(Wt,Yt),Object.defineProperty(Kt,"isAxiosError",{value:!0}),Wt.from=(e,t,s,a,r,i)=>{const n=Object.create(Kt);Qt.toFlatObject(e,n,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e);const l=e&&e.message?e.message:"Error",o=null==t&&e?e.code:t;return Wt.call(n,l,o,s,a,r),e&&null==n.cause&&Object.defineProperty(n,"cause",{value:e,configurable:!0}),n.name=e&&e.name||"Error",i&&Object.assign(n,i),n};function Xt(e){return Qt.isPlainObject(e)||Qt.isArray(e)}function Zt(e){return Qt.endsWith(e,"[]")?e.slice(0,-2):e}function es(e,t,s){return e?e.concat(t).map(function(e,t){return e=Zt(e),!s&&t?"["+e+"]":e}).join(s?".":""):t}const ts=Qt.toFlatObject(Qt,{},null,function(e){return/^is[A-Z]/.test(e)});function ss(e,t,s){if(!Qt.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const a=(s=Qt.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!Qt.isUndefined(t[e])})).metaTokens,r=s.visitor||d,i=s.dots,n=s.indexes,l=(s.Blob||"undefined"!=typeof Blob&&Blob)&&Qt.isSpecCompliantForm(t);if(!Qt.isFunction(r))throw new TypeError("visitor must be a function");function o(e){if(null===e)return"";if(Qt.isDate(e))return e.toISOString();if(Qt.isBoolean(e))return e.toString();if(!l&&Qt.isBlob(e))throw new Wt("Blob is not supported. Use a Buffer instead.");return Qt.isArrayBuffer(e)||Qt.isTypedArray(e)?l&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function d(e,s,r){let l=e;if(e&&!r&&"object"==typeof e)if(Qt.endsWith(s,"{}"))s=a?s:s.slice(0,-2),e=JSON.stringify(e);else if(Qt.isArray(e)&&function(e){return Qt.isArray(e)&&!e.some(Xt)}(e)||(Qt.isFileList(e)||Qt.endsWith(s,"[]"))&&(l=Qt.toArray(e)))return s=Zt(s),l.forEach(function(e,a){!Qt.isUndefined(e)&&null!==e&&t.append(!0===n?es([s],a,i):null===n?s:s+"[]",o(e))}),!1;return!!Xt(e)||(t.append(es(r,s,i),o(e)),!1)}const c=[],m=Object.assign(ts,{defaultVisitor:d,convertValue:o,isVisitable:Xt});if(!Qt.isObject(e))throw new TypeError("data must be an object");return function e(s,a){if(!Qt.isUndefined(s)){if(-1!==c.indexOf(s))throw Error("Circular reference detected in "+a.join("."));c.push(s),Qt.forEach(s,function(s,i){!0===(!(Qt.isUndefined(s)||null===s)&&r.call(t,s,Qt.isString(i)?i.trim():i,a,m))&&e(s,a?a.concat(i):[i])}),c.pop()}}(e),t}function as(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function rs(e,t){this._pairs=[],e&&ss(e,this,t)}const is=rs.prototype;function ns(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function ls(e,t,s){if(!t)return e;const a=s&&s.encode||ns;Qt.isFunction(s)&&(s={serialize:s});const r=s&&s.serialize;let i;if(i=r?r(t,s):Qt.isURLSearchParams(t)?t.toString():new rs(t,s).toString(a),i){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e}is.append=function(e,t){this._pairs.push([e,t])},is.toString=function(e){const t=e?function(t){return e.call(this,t,as)}:as;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};class os{constructor(){this.handlers=[]}use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Qt.forEach(this.handlers,function(t){null!==t&&e(t)})}}const ds={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},cs={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:rs,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},ms="undefined"!=typeof window&&"undefined"!=typeof document,xs="object"==typeof navigator&&navigator||void 0,ps=ms&&(!xs||["ReactNative","NativeScript","NS"].indexOf(xs.product)<0),us="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,hs=ms&&window.location.href||"http://localhost",bs={...Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:ms,hasStandardBrowserEnv:ps,hasStandardBrowserWebWorkerEnv:us,navigator:xs,origin:hs},Symbol.toStringTag,{value:"Module"})),...cs};function fs(e){function t(e,s,a,r){let i=e[r++];if("__proto__"===i)return!0;const n=Number.isFinite(+i),l=r>=e.length;if(i=!i&&Qt.isArray(a)?a.length:i,l)return Qt.hasOwnProp(a,i)?a[i]=[a[i],s]:a[i]=s,!n;a[i]&&Qt.isObject(a[i])||(a[i]=[]);return t(e,s,a[i],r)&&Qt.isArray(a[i])&&(a[i]=function(e){const t={},s=Object.keys(e);let a;const r=s.length;let i;for(a=0;a<r;a++)i=s[a],t[i]=e[i];return t}(a[i])),!n}if(Qt.isFormData(e)&&Qt.isFunction(e.entries)){const s={};return Qt.forEachEntry(e,(e,a)=>{t(function(e){return Qt.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),a,s,0)}),s}return null}const gs={transitional:ds,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const s=t.getContentType()||"",a=s.indexOf("application/json")>-1,r=Qt.isObject(e);r&&Qt.isHTMLForm(e)&&(e=new FormData(e));if(Qt.isFormData(e))return a?JSON.stringify(fs(e)):e;if(Qt.isArrayBuffer(e)||Qt.isBuffer(e)||Qt.isStream(e)||Qt.isFile(e)||Qt.isBlob(e)||Qt.isReadableStream(e))return e;if(Qt.isArrayBufferView(e))return e.buffer;if(Qt.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let i;if(r){if(s.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return ss(e,new bs.classes.URLSearchParams,{visitor:function(e,t,s,a){return bs.isNode&&Qt.isBuffer(e)?(this.append(t,e.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)},...t})}(e,this.formSerializer).toString();if((i=Qt.isFileList(e))||s.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return ss(i?{"files[]":e}:e,t&&new t,this.formSerializer)}}return r||a?(t.setContentType("application/json",!1),function(e,t,s){if(Qt.isString(e))try{return(t||JSON.parse)(e),Qt.trim(e)}catch(a){if("SyntaxError"!==a.name)throw a}return(s||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||gs.transitional,s=t&&t.forcedJSONParsing,a="json"===this.responseType;if(Qt.isResponse(e)||Qt.isReadableStream(e))return e;if(e&&Qt.isString(e)&&(s&&!this.responseType||a)){const s=!(t&&t.silentJSONParsing)&&a;try{return JSON.parse(e,this.parseReviver)}catch(r){if(s){if("SyntaxError"===r.name)throw Wt.from(r,Wt.ERR_BAD_RESPONSE,this,null,this.response);throw r}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:bs.classes.FormData,Blob:bs.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Qt.forEach(["delete","get","head","post","put","patch"],e=>{gs.headers[e]={}});const js=Qt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),vs=Symbol("internals");function ys(e){return e&&String(e).trim().toLowerCase()}function Ns(e){return!1===e||null==e?e:Qt.isArray(e)?e.map(Ns):String(e)}function ws(e,t,s,a,r){return Qt.isFunction(a)?a.call(this,t,s):(r&&(t=s),Qt.isString(t)?Qt.isString(a)?-1!==t.indexOf(a):Qt.isRegExp(a)?a.test(t):void 0:void 0)}let Ss=class{constructor(e){e&&this.set(e)}set(e,t,s){const a=this;function r(e,t,s){const r=ys(t);if(!r)throw new Error("header name must be a non-empty string");const i=Qt.findKey(a,r);(!i||void 0===a[i]||!0===s||void 0===s&&!1!==a[i])&&(a[i||t]=Ns(e))}const i=(e,t)=>Qt.forEach(e,(e,s)=>r(e,s,t));if(Qt.isPlainObject(e)||e instanceof this.constructor)i(e,t);else if(Qt.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))i((e=>{const t={};let s,a,r;return e&&e.split("\n").forEach(function(e){r=e.indexOf(":"),s=e.substring(0,r).trim().toLowerCase(),a=e.substring(r+1).trim(),!s||t[s]&&js[s]||("set-cookie"===s?t[s]?t[s].push(a):t[s]=[a]:t[s]=t[s]?t[s]+", "+a:a)}),t})(e),t);else if(Qt.isObject(e)&&Qt.isIterable(e)){let s,a,r={};for(const t of e){if(!Qt.isArray(t))throw TypeError("Object iterator must return a key-value pair");r[a=t[0]]=(s=r[a])?Qt.isArray(s)?[...s,t[1]]:[s,t[1]]:t[1]}i(r,t)}else null!=e&&r(t,e,s);return this}get(e,t){if(e=ys(e)){const s=Qt.findKey(this,e);if(s){const e=this[s];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),s=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let a;for(;a=s.exec(e);)t[a[1]]=a[2];return t}(e);if(Qt.isFunction(t))return t.call(this,e,s);if(Qt.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=ys(e)){const s=Qt.findKey(this,e);return!(!s||void 0===this[s]||t&&!ws(0,this[s],s,t))}return!1}delete(e,t){const s=this;let a=!1;function r(e){if(e=ys(e)){const r=Qt.findKey(s,e);!r||t&&!ws(0,s[r],r,t)||(delete s[r],a=!0)}}return Qt.isArray(e)?e.forEach(r):r(e),a}clear(e){const t=Object.keys(this);let s=t.length,a=!1;for(;s--;){const r=t[s];e&&!ws(0,this[r],r,e,!0)||(delete this[r],a=!0)}return a}normalize(e){const t=this,s={};return Qt.forEach(this,(a,r)=>{const i=Qt.findKey(s,r);if(i)return t[i]=Ns(a),void delete t[r];const n=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,s)=>t.toUpperCase()+s)}(r):String(r).trim();n!==r&&delete t[r],t[n]=Ns(a),s[n]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return Qt.forEach(this,(s,a)=>{null!=s&&!1!==s&&(t[a]=e&&Qt.isArray(s)?s.join(", "):s)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const s=new this(e);return t.forEach(e=>s.set(e)),s}static accessor(e){const t=(this[vs]=this[vs]={accessors:{}}).accessors,s=this.prototype;function a(e){const a=ys(e);t[a]||(!function(e,t){const s=Qt.toCamelCase(" "+t);["get","set","has"].forEach(a=>{Object.defineProperty(e,a+s,{value:function(e,s,r){return this[a].call(this,t,e,s,r)},configurable:!0})})}(s,e),t[a]=!0)}return Qt.isArray(e)?e.forEach(a):a(e),this}};function Cs(e,t){const s=this||gs,a=t||s,r=Ss.from(a.headers);let i=a.data;return Qt.forEach(e,function(e){i=e.call(s,i,r.normalize(),t?t.status:void 0)}),r.normalize(),i}function ks(e){return!(!e||!e.__CANCEL__)}function As(e,t,s){Wt.call(this,null==e?"canceled":e,Wt.ERR_CANCELED,t,s),this.name="CanceledError"}function Es(e,t,s){const a=s.config.validateStatus;s.status&&a&&!a(s.status)?t(new Wt("Request failed with status code "+s.status,[Wt.ERR_BAD_REQUEST,Wt.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):e(s)}Ss.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Qt.reduceDescriptors(Ss.prototype,({value:e},t)=>{let s=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[s]=e}}}),Qt.freezeMethods(Ss),Qt.inherits(As,Wt,{__CANCEL__:!0});const Ps=(e,t,s=3)=>{let a=0;const r=function(e,t){e=e||10;const s=new Array(e),a=new Array(e);let r,i=0,n=0;return t=void 0!==t?t:1e3,function(l){const o=Date.now(),d=a[n];r||(r=o),s[i]=l,a[i]=o;let c=n,m=0;for(;c!==i;)m+=s[c++],c%=e;if(i=(i+1)%e,i===n&&(n=(n+1)%e),o-r<t)return;const x=d&&o-d;return x?Math.round(1e3*m/x):void 0}}(50,250);return function(e,t){let s,a,r=0,i=1e3/t;const n=(t,i=Date.now())=>{r=i,s=null,a&&(clearTimeout(a),a=null),e(...t)};return[(...e)=>{const t=Date.now(),l=t-r;l>=i?n(e,t):(s=e,a||(a=setTimeout(()=>{a=null,n(s)},i-l)))},()=>s&&n(s)]}(s=>{const i=s.loaded,n=s.lengthComputable?s.total:void 0,l=i-a,o=r(l);a=i;e({loaded:i,total:n,progress:n?i/n:void 0,bytes:l,rate:o||void 0,estimated:o&&n&&i<=n?(n-i)/o:void 0,event:s,lengthComputable:null!=n,[t?"download":"upload"]:!0})},s)},Rs=(e,t)=>{const s=null!=e;return[a=>t[0]({lengthComputable:s,total:e,loaded:a}),t[1]]},zs=e=>(...t)=>Qt.asap(()=>e(...t)),Ds=bs.hasStandardBrowserEnv?((e,t)=>s=>(s=new URL(s,bs.origin),e.protocol===s.protocol&&e.host===s.host&&(t||e.port===s.port)))(new URL(bs.origin),bs.navigator&&/(msie|trident)/i.test(bs.navigator.userAgent)):()=>!0,Ts=bs.hasStandardBrowserEnv?{write(e,t,s,a,r,i,n){if("undefined"==typeof document)return;const l=[`${e}=${encodeURIComponent(t)}`];Qt.isNumber(s)&&l.push(`expires=${new Date(s).toUTCString()}`),Qt.isString(a)&&l.push(`path=${a}`),Qt.isString(r)&&l.push(`domain=${r}`),!0===i&&l.push("secure"),Qt.isString(n)&&l.push(`SameSite=${n}`),document.cookie=l.join("; ")},read(e){if("undefined"==typeof document)return null;const t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read:()=>null,remove(){}};function _s(e,t,s){let a=!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t);return e&&(a||0==s)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const Ls=e=>e instanceof Ss?{...e}:e;function $s(e,t){t=t||{};const s={};function a(e,t,s,a){return Qt.isPlainObject(e)&&Qt.isPlainObject(t)?Qt.merge.call({caseless:a},e,t):Qt.isPlainObject(t)?Qt.merge({},t):Qt.isArray(t)?t.slice():t}function r(e,t,s,r){return Qt.isUndefined(t)?Qt.isUndefined(e)?void 0:a(void 0,e,0,r):a(e,t,0,r)}function i(e,t){if(!Qt.isUndefined(t))return a(void 0,t)}function n(e,t){return Qt.isUndefined(t)?Qt.isUndefined(e)?void 0:a(void 0,e):a(void 0,t)}function l(s,r,i){return i in t?a(s,r):i in e?a(void 0,s):void 0}const o={url:i,method:i,data:i,baseURL:n,transformRequest:n,transformResponse:n,paramsSerializer:n,timeout:n,timeoutMessage:n,withCredentials:n,withXSRFToken:n,adapter:n,responseType:n,xsrfCookieName:n,xsrfHeaderName:n,onUploadProgress:n,onDownloadProgress:n,decompress:n,maxContentLength:n,maxBodyLength:n,beforeRedirect:n,transport:n,httpAgent:n,httpsAgent:n,cancelToken:n,socketPath:n,responseEncoding:n,validateStatus:l,headers:(e,t,s)=>r(Ls(e),Ls(t),0,!0)};return Qt.forEach(Object.keys({...e,...t}),function(a){const i=o[a]||r,n=i(e[a],t[a],a);Qt.isUndefined(n)&&i!==l||(s[a]=n)}),s}const Os=e=>{const t=$s({},e);let{data:s,withXSRFToken:a,xsrfHeaderName:r,xsrfCookieName:i,headers:n,auth:l}=t;if(t.headers=n=Ss.from(n),t.url=ls(_s(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&n.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),Qt.isFormData(s))if(bs.hasStandardBrowserEnv||bs.hasStandardBrowserWebWorkerEnv)n.setContentType(void 0);else if(Qt.isFunction(s.getHeaders)){const e=s.getHeaders(),t=["content-type","content-length"];Object.entries(e).forEach(([e,s])=>{t.includes(e.toLowerCase())&&n.set(e,s)})}if(bs.hasStandardBrowserEnv&&(a&&Qt.isFunction(a)&&(a=a(t)),a||!1!==a&&Ds(t.url))){const e=r&&i&&Ts.read(i);e&&n.set(r,e)}return t},qs="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise(function(t,s){const a=Os(e);let r=a.data;const i=Ss.from(a.headers).normalize();let n,l,o,d,c,{responseType:m,onUploadProgress:x,onDownloadProgress:p}=a;function u(){d&&d(),c&&c(),a.cancelToken&&a.cancelToken.unsubscribe(n),a.signal&&a.signal.removeEventListener("abort",n)}let h=new XMLHttpRequest;function b(){if(!h)return;const a=Ss.from("getAllResponseHeaders"in h&&h.getAllResponseHeaders());Es(function(e){t(e),u()},function(e){s(e),u()},{data:m&&"text"!==m&&"json"!==m?h.response:h.responseText,status:h.status,statusText:h.statusText,headers:a,config:e,request:h}),h=null}h.open(a.method.toUpperCase(),a.url,!0),h.timeout=a.timeout,"onloadend"in h?h.onloadend=b:h.onreadystatechange=function(){h&&4===h.readyState&&(0!==h.status||h.responseURL&&0===h.responseURL.indexOf("file:"))&&setTimeout(b)},h.onabort=function(){h&&(s(new Wt("Request aborted",Wt.ECONNABORTED,e,h)),h=null)},h.onerror=function(t){const a=new Wt(t&&t.message?t.message:"Network Error",Wt.ERR_NETWORK,e,h);a.event=t||null,s(a),h=null},h.ontimeout=function(){let t=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const r=a.transitional||ds;a.timeoutErrorMessage&&(t=a.timeoutErrorMessage),s(new Wt(t,r.clarifyTimeoutError?Wt.ETIMEDOUT:Wt.ECONNABORTED,e,h)),h=null},void 0===r&&i.setContentType(null),"setRequestHeader"in h&&Qt.forEach(i.toJSON(),function(e,t){h.setRequestHeader(t,e)}),Qt.isUndefined(a.withCredentials)||(h.withCredentials=!!a.withCredentials),m&&"json"!==m&&(h.responseType=a.responseType),p&&([o,c]=Ps(p,!0),h.addEventListener("progress",o)),x&&h.upload&&([l,d]=Ps(x),h.upload.addEventListener("progress",l),h.upload.addEventListener("loadend",d)),(a.cancelToken||a.signal)&&(n=t=>{h&&(s(!t||t.type?new As(null,e,h):t),h.abort(),h=null)},a.cancelToken&&a.cancelToken.subscribe(n),a.signal&&(a.signal.aborted?n():a.signal.addEventListener("abort",n)));const f=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(a.url);f&&-1===bs.protocols.indexOf(f)?s(new Wt("Unsupported protocol "+f+":",Wt.ERR_BAD_REQUEST,e)):h.send(r||null)})},Is=(e,t)=>{const{length:s}=e=e?e.filter(Boolean):[];if(t||s){let s,a=new AbortController;const r=function(e){if(!s){s=!0,n();const t=e instanceof Error?e:this.reason;a.abort(t instanceof Wt?t:new As(t instanceof Error?t.message:t))}};let i=t&&setTimeout(()=>{i=null,r(new Wt(`timeout ${t} of ms exceeded`,Wt.ETIMEDOUT))},t);const n=()=>{e&&(i&&clearTimeout(i),i=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(r):e.removeEventListener("abort",r)}),e=null)};e.forEach(e=>e.addEventListener("abort",r));const{signal:l}=a;return l.unsubscribe=()=>Qt.asap(n),l}},Fs=function*(e,t){let s=e.byteLength;if(s<t)return void(yield e);let a,r=0;for(;r<s;)a=r+t,yield e.slice(r,a),r=a},Bs=async function*(e){if(e[Symbol.asyncIterator])return void(yield*e);const t=e.getReader();try{for(;;){const{done:e,value:s}=await t.read();if(e)break;yield s}}finally{await t.cancel()}},Ms=(e,t,s,a)=>{const r=async function*(e,t){for await(const s of Bs(e))yield*Fs(s,t)}(e,t);let i,n=0,l=e=>{i||(i=!0,a&&a(e))};return new ReadableStream({async pull(e){try{const{done:t,value:a}=await r.next();if(t)return l(),void e.close();let i=a.byteLength;if(s){let e=n+=i;s(e)}e.enqueue(new Uint8Array(a))}catch(t){throw l(t),t}},cancel:e=>(l(e),r.return())},{highWaterMark:2})},{isFunction:Us}=Qt,Vs=(({Request:e,Response:t})=>({Request:e,Response:t}))(Qt.global),{ReadableStream:Gs,TextEncoder:Hs}=Qt.global,Js=(e,...t)=>{try{return!!e(...t)}catch(s){return!1}},Qs=e=>{e=Qt.merge.call({skipUndefined:!0},Vs,e);const{fetch:t,Request:s,Response:a}=e,r=t?Us(t):"function"==typeof fetch,i=Us(s),n=Us(a);if(!r)return!1;const l=r&&Us(Gs),o=r&&("function"==typeof Hs?(e=>t=>e.encode(t))(new Hs):async e=>new Uint8Array(await new s(e).arrayBuffer())),d=i&&l&&Js(()=>{let e=!1;const t=new s(bs.origin,{body:new Gs,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),c=n&&l&&Js(()=>Qt.isReadableStream(new a("").body)),m={stream:c&&(e=>e.body)};r&&["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!m[e]&&(m[e]=(t,s)=>{let a=t&&t[e];if(a)return a.call(t);throw new Wt(`Response type '${e}' is not supported`,Wt.ERR_NOT_SUPPORT,s)})});const x=async(e,t)=>{const a=Qt.toFiniteNumber(e.getContentLength());return null==a?(async e=>{if(null==e)return 0;if(Qt.isBlob(e))return e.size;if(Qt.isSpecCompliantForm(e)){const t=new s(bs.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return Qt.isArrayBufferView(e)||Qt.isArrayBuffer(e)?e.byteLength:(Qt.isURLSearchParams(e)&&(e+=""),Qt.isString(e)?(await o(e)).byteLength:void 0)})(t):a};return async e=>{let{url:r,method:n,data:l,signal:o,cancelToken:p,timeout:u,onDownloadProgress:h,onUploadProgress:b,responseType:f,headers:g,withCredentials:j="same-origin",fetchOptions:v}=Os(e),y=t||fetch;f=f?(f+"").toLowerCase():"text";let N=Is([o,p&&p.toAbortSignal()],u),w=null;const S=N&&N.unsubscribe&&(()=>{N.unsubscribe()});let C;try{if(b&&d&&"get"!==n&&"head"!==n&&0!==(C=await x(g,l))){let e,t=new s(r,{method:"POST",body:l,duplex:"half"});if(Qt.isFormData(l)&&(e=t.headers.get("content-type"))&&g.setContentType(e),t.body){const[e,s]=Rs(C,Ps(zs(b)));l=Ms(t.body,65536,e,s)}}Qt.isString(j)||(j=j?"include":"omit");const t=i&&"credentials"in s.prototype,o={...v,signal:N,method:n.toUpperCase(),headers:g.normalize().toJSON(),body:l,duplex:"half",credentials:t?j:void 0};w=i&&new s(r,o);let p=await(i?y(w,v):y(r,o));const u=c&&("stream"===f||"response"===f);if(c&&(h||u&&S)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=p[t]});const t=Qt.toFiniteNumber(p.headers.get("content-length")),[s,r]=h&&Rs(t,Ps(zs(h),!0))||[];p=new a(Ms(p.body,65536,s,()=>{r&&r(),S&&S()}),e)}f=f||"text";let k=await m[Qt.findKey(m,f)||"text"](p,e);return!u&&S&&S(),await new Promise((t,s)=>{Es(t,s,{data:k,headers:Ss.from(p.headers),status:p.status,statusText:p.statusText,config:e,request:w})})}catch(k){if(S&&S(),k&&"TypeError"===k.name&&/Load failed|fetch/i.test(k.message))throw Object.assign(new Wt("Network Error",Wt.ERR_NETWORK,e,w),{cause:k.cause||k});throw Wt.from(k,k&&k.code,e,w)}}},Ws=new Map,Ks=e=>{let t=e&&e.env||{};const{fetch:s,Request:a,Response:r}=t,i=[a,r,s];let n,l,o=i.length,d=Ws;for(;o--;)n=i[o],l=d.get(n),void 0===l&&d.set(n,l=o?new Map:Qs(t)),d=l;return l};Ks();const Ys={http:null,xhr:qs,fetch:{get:Ks}};Qt.forEach(Ys,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(s){}Object.defineProperty(e,"adapterName",{value:t})}});const Xs=e=>`- ${e}`,Zs=e=>Qt.isFunction(e)||null===e||!1===e;const ea={getAdapter:function(e,t){e=Qt.isArray(e)?e:[e];const{length:s}=e;let a,r;const i={};for(let n=0;n<s;n++){let s;if(a=e[n],r=a,!Zs(a)&&(r=Ys[(s=String(a)).toLowerCase()],void 0===r))throw new Wt(`Unknown adapter '${s}'`);if(r&&(Qt.isFunction(r)||(r=r.get(t))))break;i[s||"#"+n]=r}if(!r){const e=Object.entries(i).map(([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build"));throw new Wt("There is no suitable adapter to dispatch the request "+(s?e.length>1?"since :\n"+e.map(Xs).join("\n"):" "+Xs(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r},adapters:Ys};function ta(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new As(null,e)}function sa(e){ta(e),e.headers=Ss.from(e.headers),e.data=Cs.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return ea.getAdapter(e.adapter||gs.adapter,e)(e).then(function(t){return ta(e),t.data=Cs.call(e,e.transformResponse,t),t.headers=Ss.from(t.headers),t},function(t){return ks(t)||(ta(e),t&&t.response&&(t.response.data=Cs.call(e,e.transformResponse,t.response),t.response.headers=Ss.from(t.response.headers))),Promise.reject(t)})}const aa="1.13.2",ra={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{ra[e]=function(s){return typeof s===e||"a"+(t<1?"n ":" ")+e}});const ia={};ra.transitional=function(e,t,s){return(a,r,i)=>{if(!1===e)throw new Wt(function(e,t){return"[Axios v"+aa+"] Transitional option '"+e+"'"+t+(s?". "+s:"")}(r," has been removed"+(t?" in "+t:"")),Wt.ERR_DEPRECATED);return t&&!ia[r]&&(ia[r]=!0),!e||e(a,r,i)}},ra.spelling=function(e){return(e,t)=>!0};const na={assertOptions:function(e,t,s){if("object"!=typeof e)throw new Wt("options must be an object",Wt.ERR_BAD_OPTION_VALUE);const a=Object.keys(e);let r=a.length;for(;r-- >0;){const i=a[r],n=t[i];if(n){const t=e[i],s=void 0===t||n(t,i,e);if(!0!==s)throw new Wt("option "+i+" must be "+s,Wt.ERR_BAD_OPTION_VALUE);continue}if(!0!==s)throw new Wt("Unknown option "+i,Wt.ERR_BAD_OPTION)}},validators:ra},la=na.validators;let oa=class{constructor(e){this.defaults=e||{},this.interceptors={request:new os,response:new os}}async request(e,t){try{return await this._request(e,t)}catch(s){if(s instanceof Error){let e={};Error.captureStackTrace?Error.captureStackTrace(e):e=new Error;const t=e.stack?e.stack.replace(/^.+\n/,""):"";try{s.stack?t&&!String(s.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(s.stack+="\n"+t):s.stack=t}catch(a){}}throw s}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=$s(this.defaults,t);const{transitional:s,paramsSerializer:a,headers:r}=t;void 0!==s&&na.assertOptions(s,{silentJSONParsing:la.transitional(la.boolean),forcedJSONParsing:la.transitional(la.boolean),clarifyTimeoutError:la.transitional(la.boolean)},!1),null!=a&&(Qt.isFunction(a)?t.paramsSerializer={serialize:a}:na.assertOptions(a,{encode:la.function,serialize:la.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),na.assertOptions(t,{baseUrl:la.spelling("baseURL"),withXsrfToken:la.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let i=r&&Qt.merge(r.common,r[t.method]);r&&Qt.forEach(["delete","get","head","post","put","patch","common"],e=>{delete r[e]}),t.headers=Ss.concat(i,r);const n=[];let l=!0;this.interceptors.request.forEach(function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(l=l&&e.synchronous,n.unshift(e.fulfilled,e.rejected))});const o=[];let d;this.interceptors.response.forEach(function(e){o.push(e.fulfilled,e.rejected)});let c,m=0;if(!l){const e=[sa.bind(this),void 0];for(e.unshift(...n),e.push(...o),c=e.length,d=Promise.resolve(t);m<c;)d=d.then(e[m++],e[m++]);return d}c=n.length;let x=t;for(;m<c;){const e=n[m++],t=n[m++];try{x=e(x)}catch(p){t.call(this,p);break}}try{d=sa.call(this,x)}catch(p){return Promise.reject(p)}for(m=0,c=o.length;m<c;)d=d.then(o[m++],o[m++]);return d}getUri(e){return ls(_s((e=$s(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};Qt.forEach(["delete","get","head","options"],function(e){oa.prototype[e]=function(t,s){return this.request($s(s||{},{method:e,url:t,data:(s||{}).data}))}}),Qt.forEach(["post","put","patch"],function(e){function t(t){return function(s,a,r){return this.request($s(r||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:s,data:a}))}}oa.prototype[e]=t(),oa.prototype[e+"Form"]=t(!0)});const da={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(da).forEach(([e,t])=>{da[t]=e});const ca=function e(t){const s=new oa(t),a=nt(oa.prototype.request,s);return Qt.extend(a,oa.prototype,s,{allOwnKeys:!0}),Qt.extend(a,s,null,{allOwnKeys:!0}),a.create=function(s){return e($s(t,s))},a}(gs);ca.Axios=oa,ca.CanceledError=As,ca.CancelToken=class e{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(e){t=e});const s=this;this.promise.then(e=>{if(!s._listeners)return;let t=s._listeners.length;for(;t-- >0;)s._listeners[t](e);s._listeners=null}),this.promise.then=e=>{let t;const a=new Promise(e=>{s.subscribe(e),t=e}).then(e);return a.cancel=function(){s.unsubscribe(t)},a},e(function(e,a,r){s.reason||(s.reason=new As(e,a,r),t(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let t;return{token:new e(function(e){t=e}),cancel:t}}},ca.isCancel=ks,ca.VERSION=aa,ca.toFormData=ss,ca.AxiosError=Wt,ca.Cancel=ca.CanceledError,ca.all=function(e){return Promise.all(e)},ca.spread=function(e){return function(t){return e.apply(null,t)}},ca.isAxiosError=function(e){return Qt.isObject(e)&&!0===e.isAxiosError},ca.mergeConfig=$s,ca.AxiosHeaders=Ss,ca.formToJSON=e=>fs(Qt.isHTMLForm(e)?new FormData(e):e),ca.getAdapter=ea.getAdapter,ca.HttpStatusCode=da,ca.default=ca;const{Axios:ma,AxiosError:xa,CanceledError:pa,isCancel:ua,CancelToken:ha,VERSION:ba,all:fa,Cancel:ga,isAxiosError:ja,spread:va,toFormData:ya,AxiosHeaders:Na,HttpStatusCode:wa,formToJSON:Sa,getAdapter:Ca,mergeConfig:ka}=ca,Aa={},Ea=function(e,t,s){let a=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),r=s?.nonce||s?.getAttribute("nonce");a=e(t.map(e=>{if((e=function(e){return"/prescrimed/"+e}(e))in Aa)return;Aa[e]=!0;const t=e.endsWith(".css"),s=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${s}`))return;const a=document.createElement("link");return a.rel=t?"stylesheet":"modulepreload",t||(a.as="script"),a.crossOrigin="",a.href=e,r&&a.setAttribute("nonce",r),document.head.appendChild(a),t?new Promise((t,s)=>{a.addEventListener("load",t),a.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function r(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return a.then(t=>{for(const e of t||[])"rejected"===e.status&&r(e.reason);return e().catch(r)})},Pa="empresaContextChanged";function Ra(){const e=localStorage.getItem("superadminEmpresaId"),t=null!=e?String(e).trim():"";return t||null}function za(e){return"superadmin"===e?.role&&!Ra()}function Da(e){return{headers:{"X-Empresa-Id":String(e)}}}function Ta(e){try{window.dispatchEvent(new CustomEvent(Pa,{detail:{empresaId:e?String(e):null}}))}catch{}}function _a(e){const t=t=>e?.(t?.detail||{});return window.addEventListener(Pa,t),()=>window.removeEventListener(Pa,t)}async function La(){const{default:e}=await Ea(async()=>{const{default:e}=await Promise.resolve().then(()=>Si);return{default:e}},void 0),t=await e.getAll(),s=Array.isArray(t)?t:t?.empresas||t?.data||[];return(Array.isArray(s)?s:[]).map(e=>({id:e?.id,nome:e?.nome,codigo:e?.codigo})).filter(e=>e.id)}const $a="https://prescrimed.up.railway.app",Oa=()=>{if(window.location.hostname.includes("railway.app"))return"";if(window.location.hostname.includes("github.io"))return $a;return"https://prescrimed.up.railway.app"},qa=(()=>{if(window.location.hostname.includes("railway.app"))return"/api";if(window.location.hostname.includes("github.io"))return`${$a}/api`;return"https://prescrimed.up.railway.app/api"})(),Ia=ca.create({baseURL:qa,headers:{"Content-Type":"application/json"}});Ia.interceptors.request.use(e=>{const t=localStorage.getItem("token");t&&(e.headers.Authorization=`Bearer ${t}`);try{const t=localStorage.getItem("user"),s=t?JSON.parse(t):null,a=Ra();"superadmin"===s?.role&&a&&(e.headers["X-Empresa-Id"]=a)}catch{}return e},e=>Promise.reject(e)),Ia.interceptors.response.use(e=>e,async e=>{const t=e.config;if(!e.response){const t=Oa(),s=`Não foi possível conectar ao servidor. Verifique se o backend está acessível em ${t?`${t}`:"seu backend/configurações de ambiente"} e se as variáveis de ambiente do frontend estão configuradas.`;return window.showToast&&window.showToast(s,"error"),Promise.reject({message:s,originalError:e,isNetworkError:!0})}if(401===e.response?.status&&!t._retry){if(t.url?.includes("/auth/refresh")||t.url?.includes("/auth/login"))return localStorage.clear(),window&&window.location&&!window.location.hash.includes("#/login")&&(window.location.hash="#/login"),Promise.reject({message:"Sessão expirada. Faça login novamente."});t._retry=!0;try{const e=localStorage.getItem("token"),s=localStorage.getItem("refreshToken");if(!e&&!s)return localStorage.clear(),window&&window.location&&!window.location.hash.includes("#/login")&&(window.location.hash="#/login"),Promise.reject({message:"Sessão expirada. Faça login novamente."});const a=await Ia.post("/auth/refresh",{refreshToken:s||e}),{token:r}=a.data;return localStorage.setItem("token",r),a.data.user&&localStorage.setItem("user",JSON.stringify(a.data.user)),t.headers.Authorization=`Bearer ${r}`,Ia(t)}catch(s){return localStorage.clear(),window&&window.location&&!window.location.hash.includes("#/login")&&(window.location.hash="#/login"),Promise.reject({message:"Sessão expirada. Faça login novamente.",originalError:s})}}if(404===e.response?.status||e.response,e.response?.status>=500){const t=e.response.status,s=e.response?.data?.error,a=503===t?s||"Serviço temporariamente indisponível. Tente novamente em instantes.":s||"Erro interno no servidor. Tente novamente em instantes.";window.showToast&&window.showToast(a,"error")}return Promise.reject(e)});const Fa=async(e,t,s,a={})=>(await Ia.request({method:e,url:t,data:s,...a})).data,Ba=(e={})=>{const t=new URLSearchParams;Object.entries(e).forEach(([e,s])=>{null!=s&&""!==s&&(Array.isArray(s)?s.forEach(s=>t.append(e,s)):t.append(e,s))});const s=t.toString();return s?`?${s}`:""},Ma=(e,t)=>Fa("get",e,void 0,t),Ua=(e,t,s)=>Fa("post",e,t,s),Va=(e,t,s)=>Fa("put",e,t,s),Ga=(e,t)=>Fa("delete",e,void 0,t),Ha=async e=>Ua("/auth/register",e),Ja=async(e,t)=>{const s=await Ua("/auth/login",{email:e,senha:t});return s.token&&(localStorage.setItem("token",s.token),localStorage.setItem("user",JSON.stringify(s.user))),s},Qa=()=>{localStorage.removeItem("token"),localStorage.removeItem("user")},Wa=()=>{try{const e=localStorage.getItem("user");return e&&"undefined"!==e?JSON.parse(e):null}catch(e){return localStorage.removeItem("user"),null}},Ka=()=>{const e=Wa(),t=localStorage.getItem("token");return e&&t?e:(localStorage.removeItem("user"),localStorage.removeItem("token"),null)},Ya=(Xa=e=>({user:Ka(),token:localStorage.getItem("token"),isAuthenticated:!!Ka(),login:async(t,s)=>{const a=await Ja(t,s);e({user:a.user,token:a.token,isAuthenticated:!0})},logout:()=>{Qa(),e({user:null,token:null,isAuthenticated:!1})},hasPermission:e=>{const t=Ya.getState();return!!t.user&&("admin"===t.user.role||"superadmin"===t.user.role||t.user.permissoes?.includes(e)||!1)}}))?it(Xa):it;var Xa;function Za(){return Fe.jsxs(Fe.Fragment,{children:[Fe.jsx("div",{className:"absolute inset-0 bg-[url('/pattern.svg')] opacity-20 bg-cover bg-center mix-blend-overlay","aria-hidden":"true"}),Fe.jsx("div",{className:"absolute inset-0 opacity-10 bg-cover bg-center mix-blend-overlay",style:{backgroundImage:"url('https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80')"},"aria-hidden":"true"}),Fe.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-primary-900/50 to-transparent","aria-hidden":"true"})]})}const er={create:{m:"criado",f:"criada"},update:{m:"atualizado",f:"atualizada"},delete:{m:"excluído",f:"excluída"}},tr={create:"criar",update:"atualizar",delete:"excluir",load:"carregar",save:"salvar",cancel:"cancelar",login:"fazer login",register:"realizar cadastro"},sr={accessDenied:"Acesso negado",passwordMismatch:"As senhas não coincidem",minPassword:"Senha deve ter no mínimo 6 caracteres",cannotDeleteSelf:"Você não pode excluir seu próprio usuário"},ar=(e,t,{gender:s="m",suffix:a=""}={})=>`${t} ${er[e]?.[s]||er[e]?.m||""} com sucesso${a}`,rr=(e,t)=>`Erro ao ${tr[e]||e} ${t}`,ir=e=>sr[e]||e,nr=(e,t)=>e?.response?.data?.error||e?.response?.data?.message||t,lr=e=>e?.response?.data?.code||null,or=e=>{switch(e){case"validation_error":return"Alguns dados parecem inválidos. Verifique os campos e tente novamente.";case"unique_constraint":return"Já existe um registro com esses dados.";case"auth_token_error":return"Sessão expirada. Faça login novamente.";case"access_denied":return"Você não tem permissão para esta ação.";case"not_found":return"Recurso não encontrado.";case"service_unavailable":return"Serviço indisponível no momento. Tente mais tarde.";case"empresa_inativa":return"Empresa inativa. Entre em contato com o suporte para reativação.";case"trial_expired":return"Período de teste encerrado. Entre em contato com o suporte para renovar ou contratar um plano.";default:return null}};function dr(){const e=r(),t=Ya(e=>e.login),[s,a]=i.useState({email:"",senha:""}),[l,o]=i.useState(!1),d=e=>{a({...s,[e.target.name]:e.target.value})};return Fe.jsxs("div",{className:"min-h-screen flex bg-white",children:[Fe.jsxs("div",{className:"hidden lg:flex lg:w-1/2 bg-gradient-to-br from-primary-600 to-primary-800 relative overflow-hidden text-white p-12 flex-col justify-between items-center text-center",children:[Fe.jsx(Za,{}),Fe.jsxs("div",{className:"relative z-10 flex flex-col items-center",children:[Fe.jsxs("div",{className:"flex items-center gap-3 text-2xl font-bold mb-2",children:[Fe.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center",children:Fe.jsx(u,{size:24})}),"Prescrimed"]}),Fe.jsx("p",{className:"text-primary-100",children:"Sistema de Gestão de Prescrições"})]}),Fe.jsxs("div",{className:"relative z-10 max-w-md",children:[Fe.jsx("h2",{className:"text-4xl font-bold mb-6 leading-tight",children:"Simplifique a gestão de prescrições da sua clínica."}),Fe.jsx("p",{className:"text-primary-100 text-lg leading-relaxed mb-8",children:"Segurança, agilidade e conformidade em um único lugar. Desenvolvido especialmente para Instituições de Longa Permanência e Clínicas."}),Fe.jsxs("div",{className:"flex gap-4 justify-center",children:[Fe.jsx("div",{className:"flex -space-x-4",children:[1,2,3,4].map(e=>Fe.jsx("div",{className:"w-10 h-10 rounded-full border-2 border-primary-700 bg-primary-800 flex items-center justify-center text-xs font-bold",children:e},e))}),Fe.jsxs("div",{className:"flex flex-col justify-center text-left",children:[Fe.jsx("span",{className:"font-bold",children:"Mais de 500+"}),Fe.jsx("span",{className:"text-xs text-primary-200",children:"Profissionais confiam"})]})]})]}),Fe.jsx("div",{className:"relative z-10 text-sm text-primary-200",children:"© 2025 Prescrimed System. Todos os direitos reservados."})]}),Fe.jsx("div",{className:"w-full lg:w-1/2 flex items-center justify-center p-6 md:p-12 bg-slate-50",children:Fe.jsxs("div",{className:"w-full max-w-md space-y-8",children:[Fe.jsxs("div",{className:"text-center lg:text-left",children:[Fe.jsx("div",{className:"lg:hidden flex justify-center mb-6",children:Fe.jsx("div",{className:"w-12 h-12 bg-primary-600 rounded-xl flex items-center justify-center text-white",children:Fe.jsx(u,{size:24})})}),Fe.jsx("h2",{className:"text-3xl font-bold text-slate-900 tracking-tight",children:"Bem-vindo de volta"}),Fe.jsx("p",{className:"text-slate-500 mt-2",children:"Acesse sua conta para gerenciar prescrições e pacientes."})]}),Fe.jsxs("form",{onSubmit:async a=>{a.preventDefault(),o(!0);try{await t(s.email,s.senha),p.success("Login realizado com sucesso!"),e("/dashboard")}catch(r){if(r.isNetworkError||!r.response)p.error("Não foi possível conectar ao servidor. Verifique sua conexão ou tente novamente mais tarde.");else if(401===r.response?.status)p.error("Email ou senha incorretos. Verifique suas credenciais e tente novamente.");else if(403===r.response?.status){const e=lr(r),t=or(e);p.error(t||nr(r,"Acesso negado."))}else p.error(nr(r,"Erro ao fazer login. Tente novamente."))}finally{o(!1)}},className:"space-y-6 bg-white p-8 rounded-2xl shadow-sm border border-slate-100",children:[Fe.jsxs("div",{className:"space-y-4",children:[Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"Email Profissional"}),Fe.jsxs("div",{className:"relative",children:[Fe.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-slate-400",children:Fe.jsx(h,{size:20})}),Fe.jsx("input",{type:"email",name:"email",value:s.email,onChange:d,className:"w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all",placeholder:"nome@clinica.com",required:!0})]})]}),Fe.jsxs("div",{children:[Fe.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Senha"}),Fe.jsx("a",{href:"#",className:"text-sm font-medium text-primary-600 hover:text-primary-700",children:"Esqueceu a senha?"})]}),Fe.jsxs("div",{className:"relative",children:[Fe.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-slate-400",children:Fe.jsx(b,{size:20})}),Fe.jsx("input",{type:"password",name:"senha",value:s.senha,onChange:d,className:"w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all",placeholder:"••••••••",required:!0})]})]})]}),Fe.jsx("button",{type:"submit",disabled:l,className:"w-full bg-primary-600 hover:bg-primary-700 text-white font-semibold py-3.5 rounded-xl transition-all duration-200 flex items-center justify-center gap-2 shadow-lg shadow-primary-600/20 hover:shadow-primary-600/30 focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",children:l?Fe.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):Fe.jsxs(Fe.Fragment,{children:[Fe.jsx("span",{children:"Entrar no Sistema"}),Fe.jsx(f,{size:18})]})}),Fe.jsxs("div",{className:"relative",children:[Fe.jsx("div",{className:"absolute inset-0 flex items-center",children:Fe.jsx("div",{className:"w-full border-t border-slate-200"})}),Fe.jsx("div",{className:"relative flex justify-center text-sm",children:Fe.jsx("span",{className:"px-2 bg-white text-slate-500",children:"Não tem uma conta?"})})]}),Fe.jsx(n,{to:"/register",className:"w-full bg-white border border-slate-200 text-slate-700 font-semibold py-3.5 rounded-xl hover:bg-slate-50 transition-all duration-200 flex items-center justify-center gap-2",children:"Criar conta da clínica"})]}),Fe.jsx("p",{className:"text-center text-xs text-slate-400",children:"Protegido por reCAPTCHA e sujeito à Política de Privacidade e Termos de Serviço do Google."})]})})]})}const cr=e=>{if(!e)return"";const t=String(e).replace(/\D/g,"");return 11!==t.length?e:t.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4")},mr=e=>{if(!e)return"";const t=String(e).replace(/\D/g,"");return 14!==t.length?e:t.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/,"$1.$2.$3/$4-$5")},xr=e=>{if(!e)return!1;const t=String(e).replace(/\D/g,"");if(11!==t.length)return!1;if(/^(\d)\1+$/.test(t))return!1;let s=0;for(let r=0;r<9;r++)s+=parseInt(t.charAt(r))*(10-r);let a=11-s%11;if(a>=10&&(a=0),a!==parseInt(t.charAt(9)))return!1;s=0;for(let r=0;r<10;r++)s+=parseInt(t.charAt(r))*(11-r);return a=11-s%11,a>=10&&(a=0),a===parseInt(t.charAt(10))},pr=e=>{if(!e)return!1;const t=String(e).replace(/\D/g,"");if(14!==t.length)return!1;if(/^(\d)\1+$/.test(t))return!1;let s=t.length-2,a=t.substring(0,s);const r=t.substring(s);let i=0,n=s-7;for(let o=s;o>=1;o--)i+=parseInt(a.charAt(s-o))*n--,n<2&&(n=9);let l=i%11<2?0:11-i%11;if(l!==parseInt(r.charAt(0)))return!1;s++,a=t.substring(0,s),i=0,n=s-7;for(let o=s;o>=1;o--)i+=parseInt(a.charAt(s-o))*n--,n<2&&(n=9);return l=i%11<2?0:11-i%11,l===parseInt(r.charAt(1))};function ur(){const e=r(),[t,s]=i.useState({tipoSistema:"casa-repouso",nomeEmpresa:"",cnpj:"",nomeUsuario:"",email:"",senha:"",confirmarSenha:"",cpf:"",contato:""}),[a,l]=i.useState(!1),o=[{title:"Cadastro guiado",description:"Organizamos os campos para você concluir o registro em poucos minutos.",icon:g},{title:"Informações seguras",description:"Seus dados ficam protegidos com padrões de segurança usados na saúde.",icon:j},{title:"Tudo em um só lugar",description:"Centralize empresas, usuários e prescrições em uma única plataforma.",icon:v}],d=e=>{const{name:a,value:r}=e.target,i=e=>{const t=String(e||"").replace(/\D/g,"").slice(0,11);return t.length<=3?t:t.length<=6?t.replace(/(\d{3})(\d{0,3})/,"$1.$2"):t.length<=9?t.replace(/(\d{3})(\d{3})(\d{0,3})/,"$1.$2.$3"):cr(t)},n=e=>{const t=String(e||"").replace(/\D/g,"").slice(0,14);return t.length<=2?t:t.length<=5?t.replace(/(\d{2})(\d{0,3})/,"$1.$2"):t.length<=8?t.replace(/(\d{2})(\d{3})(\d{0,3})/,"$1.$2.$3"):t.length<=12?t.replace(/(\d{2})(\d{3})(\d{3})(\d{0,4})/,"$1.$2.$3/$4"):mr(t)};s("cpf"!==a?"cnpj"!==a?{...t,[a]:r}:{...t,cnpj:n(r)}:{...t,cpf:i(r)})};return Fe.jsxs("div",{className:"min-h-screen flex bg-white",children:[Fe.jsxs("div",{className:"hidden lg:flex lg:w-1/2 bg-gradient-to-br from-primary-600 to-primary-800 relative overflow-hidden text-white p-12 flex-col justify-between items-center text-center",children:[Fe.jsx(Za,{}),Fe.jsxs("div",{className:"relative z-10 flex flex-col items-center",children:[Fe.jsxs("div",{className:"flex items-center gap-3 text-2xl font-bold mb-2",children:[Fe.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center",children:Fe.jsx(u,{size:24})}),"Prescrimed"]}),Fe.jsx("p",{className:"text-primary-100",children:"Onboarding & Setup"})]}),Fe.jsxs("div",{className:"relative z-10 max-w-md",children:[Fe.jsx("h2",{className:"text-4xl font-bold mb-6 leading-tight",children:"Comece a transformar sua gestão clínica hoje."}),Fe.jsx("div",{className:"space-y-6 text-left",children:o.map(({title:e,description:t,icon:s})=>Fe.jsxs("div",{className:"flex gap-4 items-start",children:[Fe.jsx("div",{className:"w-12 h-12 rounded-2xl bg-white/10 flex items-center justify-center shrink-0",children:Fe.jsx(s,{size:22,className:"text-white"})}),Fe.jsxs("div",{children:[Fe.jsx("p",{className:"font-semibold text-white text-lg",children:e}),Fe.jsx("p",{className:"text-primary-100 leading-relaxed",children:t})]})]},e))})]}),Fe.jsx("div",{className:"relative z-10 text-sm text-primary-200",children:"© 2025 Prescrimed System. Todos os direitos reservados."})]}),Fe.jsx("div",{className:"w-full lg:w-1/2 flex items-center justify-center p-6 md:p-12 bg-slate-50 overflow-y-auto",children:Fe.jsxs("div",{className:"w-full max-w-xl space-y-8",children:[Fe.jsxs("div",{className:"text-center lg:text-left",children:[Fe.jsx("div",{className:"lg:hidden flex justify-center mb-6",children:Fe.jsx("div",{className:"w-12 h-12 bg-primary-600 rounded-xl flex items-center justify-center text-white",children:Fe.jsx(u,{size:24})})}),Fe.jsx("h2",{className:"text-3xl font-bold text-slate-900 tracking-tight",children:"Criar nova conta"}),Fe.jsx("p",{className:"text-slate-500 mt-2",children:"Preencha os dados da sua empresa e do administrador."})]}),Fe.jsxs("form",{onSubmit:async s=>{s.preventDefault();const a=(t.cpf||"").replace(/\D/g,""),r=(t.cnpj||"").replace(/\D/g,"");if(pr(r))if(xr(a))if(t.senha===t.confirmarSenha){l(!0);try{await Ha({tipoSistema:t.tipoSistema,nomeEmpresa:t.nomeEmpresa,cnpj:r,nomeAdmin:t.nomeUsuario,email:t.email,senha:t.senha,cpf:a,contato:t.contato}),p.success("Cadastro realizado com sucesso! Faça login para continuar."),e("/login")}catch(i){const e=i?.response?.data?.error||rr("register","conta");p.error(e)}finally{l(!1)}}else p.error(ir("passwordMismatch"));else p.error("CPF inválido");else p.error("CNPJ inválido")},className:"space-y-6",children:[Fe.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-200 space-y-4",children:[Fe.jsxs("div",{className:"flex items-center gap-3 border-b border-slate-100 pb-4 mb-4",children:[Fe.jsx("div",{className:"w-8 h-8 rounded-lg bg-purple-100 text-purple-600 flex items-center justify-center",children:Fe.jsx(v,{size:18})}),Fe.jsxs("div",{children:[Fe.jsx("h3",{className:"font-semibold text-slate-900",children:"Tipo de Sistema"}),Fe.jsx("p",{className:"text-xs text-slate-500",children:"Selecione o tipo de estabelecimento"})]})]}),Fe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[Fe.jsx("button",{type:"button",onClick:()=>s({...t,tipoSistema:"casa-repouso"}),className:"p-5 rounded-xl border-2 transition-all duration-200 "+("casa-repouso"===t.tipoSistema?"border-primary-500 bg-primary-50 shadow-md":"border-slate-200 bg-white hover:border-slate-300"),children:Fe.jsxs("div",{className:"flex flex-col items-center gap-3 text-center",children:[Fe.jsx("div",{className:"w-14 h-14 rounded-2xl flex items-center justify-center "+("casa-repouso"===t.tipoSistema?"bg-primary-600 text-white":"bg-slate-100 text-slate-600"),children:Fe.jsx(y,{size:28})}),Fe.jsxs("div",{children:[Fe.jsx("h4",{className:"font-semibold "+("casa-repouso"===t.tipoSistema?"text-primary-700":"text-slate-900"),children:"Casa de Repouso"}),Fe.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Gestão de residentes e cuidados"})]})]})}),Fe.jsx("button",{type:"button",onClick:()=>s({...t,tipoSistema:"fisioterapia"}),className:"p-5 rounded-xl border-2 transition-all duration-200 "+("fisioterapia"===t.tipoSistema?"border-rose-500 bg-rose-50 shadow-md":"border-slate-200 bg-white hover:border-slate-300"),children:Fe.jsxs("div",{className:"flex flex-col items-center gap-3 text-center",children:[Fe.jsx("div",{className:"w-14 h-14 rounded-2xl flex items-center justify-center "+("fisioterapia"===t.tipoSistema?"bg-rose-600 text-white":"bg-slate-100 text-slate-600"),children:Fe.jsx(N,{size:28})}),Fe.jsxs("div",{children:[Fe.jsx("h4",{className:"font-semibold "+("fisioterapia"===t.tipoSistema?"text-rose-700":"text-slate-900"),children:"Clínica de Fisioterapia"}),Fe.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Gestão de sessões e evoluções"})]})]})}),Fe.jsx("button",{type:"button",onClick:()=>s({...t,tipoSistema:"petshop"}),className:"p-5 rounded-xl border-2 transition-all duration-200 "+("petshop"===t.tipoSistema?"border-emerald-500 bg-emerald-50 shadow-md":"border-slate-200 bg-white hover:border-slate-300"),children:Fe.jsxs("div",{className:"flex flex-col items-center gap-3 text-center",children:[Fe.jsx("div",{className:"w-14 h-14 rounded-2xl flex items-center justify-center "+("petshop"===t.tipoSistema?"bg-emerald-600 text-white":"bg-slate-100 text-slate-600"),children:Fe.jsx(w,{size:28})}),Fe.jsxs("div",{children:[Fe.jsx("h4",{className:"font-semibold "+("petshop"===t.tipoSistema?"text-emerald-700":"text-slate-900"),children:"Petshop / Veterinária"}),Fe.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Gestão de pets e atendimentos"})]})]})})]})]}),Fe.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-200 space-y-4",children:[Fe.jsxs("div",{className:"flex items-center gap-3 border-b border-slate-100 pb-4 mb-4",children:[Fe.jsx("div",{className:"w-8 h-8 rounded-lg bg-primary-100 text-primary-600 flex items-center justify-center",children:Fe.jsx(u,{size:18})}),Fe.jsxs("div",{children:[Fe.jsx("h3",{className:"font-semibold text-slate-900",children:"Dados da Empresa"}),Fe.jsx("p",{className:"text-xs text-slate-500",children:"casa-repouso"===t.tipoSistema?"Informações da casa de repouso":"petshop"===t.tipoSistema?"Informações do petshop/clínica veterinária":"Informações da clínica de fisioterapia"})]})]}),Fe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"Nome da Empresa *"}),Fe.jsx("input",{type:"text",name:"nomeEmpresa",value:t.nomeEmpresa,onChange:d,className:"w-full px-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all",placeholder:"casa-repouso"===t.tipoSistema?"Ex.: Casa de Repouso Vida":"petshop"===t.tipoSistema?"Ex.: Petshop Amigo Fiel":"Ex.: Clínica Fisio Movimento",required:!0})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"CNPJ *"}),Fe.jsx("input",{type:"text",name:"cnpj",value:t.cnpj,onChange:d,className:"w-full px-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all",placeholder:"00.000.000/0000-00",required:!0})]})]})]}),Fe.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-200 space-y-4",children:[Fe.jsxs("div",{className:"flex items-center gap-3 border-b border-slate-100 pb-4 mb-4",children:[Fe.jsx("div",{className:"w-8 h-8 rounded-lg bg-emerald-100 text-emerald-600 flex items-center justify-center",children:Fe.jsx(g,{size:18})}),Fe.jsxs("div",{children:[Fe.jsx("h3",{className:"font-semibold text-slate-900",children:"Administrador"}),Fe.jsx("p",{className:"text-xs text-slate-500",children:"Dados do responsável"})]})]}),Fe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Fe.jsxs("div",{className:"md:col-span-2",children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"Nome Completo *"}),Fe.jsx("input",{type:"text",name:"nomeUsuario",value:t.nomeUsuario,onChange:d,className:"w-full px-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all",placeholder:"Nome e sobrenome",required:!0})]}),Fe.jsxs("div",{className:"md:col-span-2",children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"E-mail *"}),Fe.jsx("input",{type:"email",name:"email",value:t.email,onChange:d,className:"w-full px-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all",placeholder:"seu@email.com",required:!0})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"CPF *"}),Fe.jsx("input",{type:"text",name:"cpf",value:t.cpf,onChange:d,className:"w-full px-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all",placeholder:"000.000.000-00",required:!0})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"Contato *"}),Fe.jsx("input",{type:"text",name:"contato",value:t.contato,onChange:d,className:"w-full px-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all",placeholder:"(00) 00000-0000",required:!0})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"Senha *"}),Fe.jsx("input",{type:"password",name:"senha",value:t.senha,onChange:d,className:"w-full px-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all",placeholder:"Mínimo 6 caracteres",minLength:6,required:!0})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"Confirmar Senha *"}),Fe.jsx("input",{type:"password",name:"confirmarSenha",value:t.confirmarSenha,onChange:d,className:"w-full px-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all",placeholder:"Repita a senha",minLength:6,required:!0})]})]})]}),Fe.jsx("button",{type:"submit",disabled:a,className:"w-full bg-primary-600 hover:bg-primary-700 text-white font-semibold py-4 rounded-xl transition-all duration-200 shadow-lg shadow-primary-600/20 hover:shadow-primary-600/30 focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",children:a?"Processando cadastro...":"Finalizar Cadastro"}),Fe.jsxs("p",{className:"text-center text-sm text-slate-600",children:["Já possui uma conta?"," ",Fe.jsx(n,{to:"/login",className:"text-primary-600 font-semibold hover:text-primary-700",children:"Fazer login"})]})]})]})})]})}const hr=async(e,t,s)=>{const a=Ba({dataInicio:e,dataFim:t,empresaId:s});return Ma(`/dashboard/stats${a}`)},br=async e=>{const t=Ba({empresaId:e});return Ma(`/dashboard/prescricoes-recentes${t}`)},fr=async e=>{const t=Ba({empresaId:e});return Ma(`/dashboard/pacientes-recentes${t}`)},gr=async e=>{const t=Ba({empresaId:e});return Ma(`/dashboard/next-steps${t}`)},jr=async e=>{const t=Ba({empresaId:e});return Ma(`/dashboard/alerts${t}`)};function vr({data:e,color:t="#2563eb",height:s=200}){if(!e||0===e.length)return null;const a=Math.max(...e.map(e=>e.count)),r=a-0||1,i=e.map((t,s)=>`${s/(e.length-1)*100},${100-(t.count-0)/r*80}`).join(" "),n=`${i} 100,100 0,100`;return Fe.jsx("div",{className:"w-full",style:{height:`${s}px`},children:Fe.jsxs("div",{className:"relative w-full h-full overflow-hidden",children:[Fe.jsxs("svg",{viewBox:"0 0 100 100",preserveAspectRatio:"none",className:"w-full h-full overflow-visible",children:[Fe.jsx("line",{x1:"0",y1:"20",x2:"100",y2:"20",stroke:"#e2e8f0",strokeWidth:"0.5",strokeDasharray:"2"}),Fe.jsx("line",{x1:"0",y1:"60",x2:"100",y2:"60",stroke:"#e2e8f0",strokeWidth:"0.5",strokeDasharray:"2"}),Fe.jsx("line",{x1:"0",y1:"100",x2:"100",y2:"100",stroke:"#e2e8f0",strokeWidth:"0.5"}),Fe.jsx("path",{d:`M${n}Z`,fill:t,fillOpacity:"0.1",stroke:"none"}),Fe.jsx("polyline",{fill:"none",stroke:t,strokeWidth:"2",points:i,vectorEffect:"non-scaling-stroke",strokeLinecap:"round",strokeLinejoin:"round"}),e.map((s,a)=>{const i=a/(e.length-1)*100,n=100-(s.count-0)/r*80;return Fe.jsx("circle",{cx:i,cy:n,r:"1.5",fill:"white",stroke:t,strokeWidth:"1",vectorEffect:"non-scaling-stroke",className:"opacity-0 hover:opacity-100 transition-opacity cursor-pointer",children:Fe.jsx("title",{children:`${new Date(s.date).toLocaleDateString("pt-BR")}: ${s.count} prescrições`})},a)})]}),Fe.jsxs("div",{className:"absolute bottom-0 left-0 w-full flex justify-between text-[10px] text-slate-400 pointer-events-none translate-y-4",children:[Fe.jsx("span",{children:new Date(e[0].date).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"})}),Fe.jsx("span",{children:new Date(e[Math.floor(e.length/2)].date).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"})}),Fe.jsx("span",{children:new Date(e[e.length-1].date).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"})})]})]})})}function yr({title:e,subtitle:t,label:s,children:a}){return Fe.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6",children:[Fe.jsxs("div",{className:"space-y-3",children:[s&&Fe.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-slate-400",children:s}),Fe.jsx("h1",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold text-slate-900",children:e}),t&&Fe.jsx("p",{className:"text-slate-500 text-sm max-w-2xl",children:t})]}),Fe.jsx("div",{className:"flex flex-col sm:flex-row w-full lg:w-auto gap-2 sm:gap-3",children:a})]})}function Nr({icon:e,label:t,value:s,description:a,color:r="primary"}){const i={primary:{border:"border-primary-500",bg:"bg-primary-50",text:"text-primary-600"},emerald:{border:"border-emerald-500",bg:"bg-emerald-50",text:"text-emerald-600"},red:{border:"border-red-500",bg:"bg-red-50",text:"text-red-600"},purple:{border:"border-purple-500",bg:"bg-purple-50",text:"text-purple-600"},orange:{border:"border-orange-500",bg:"bg-orange-50",text:"text-orange-600"},blue:{border:"border-blue-500",bg:"bg-blue-50",text:"text-blue-600"}},n=i[r]||i.primary;return Fe.jsxs("div",{className:`card p-6 border-l-4 ${n.border}`,children:[Fe.jsxs("div",{className:"flex items-center justify-between mb-4",children:[Fe.jsx("div",{className:`p-3 ${n.bg} rounded-xl`,children:Fe.jsx(e,{className:n.text,size:24})}),Fe.jsx("span",{className:"text-xs font-semibold text-slate-400 uppercase tracking-wider",children:t})]}),Fe.jsx("h3",{className:"text-2xl font-bold text-slate-900",children:s}),a&&Fe.jsx("p",{className:"text-sm text-slate-500 mt-1",children:a})]})}function wr(){const[e,t]=i.useState(null),[s,a]=i.useState([]),[n,l]=i.useState([]),[o,d]=i.useState([]),[c,m]=i.useState([]),[x,h]=i.useState([]),[b,f]=i.useState(!0),[g,j]=i.useState(!1),[v,y]=i.useState(null),N=r(),{user:w}=Ya();i.useEffect(()=>{I({background:!1});const e=setInterval(()=>{I({background:!0})},3e4);return()=>clearInterval(e)},[w?.empresaId]);const q=(e,t)=>Array.isArray(e)?e:e&&Array.isArray(e[t])?e[t]:[],I=async({background:e}={background:!1})=>{e?j(!0):f(!0);try{const e=w?.empresaId,[s,r,i,n,o]=await Promise.all([hr(void 0,void 0,e),br(e),fr(e),gr(e),jr(e)]),c=s?.stats||s||{},x=c.graficoPrescricoes||[],p=Array.isArray(x)?x.reduce((e,t)=>e+(Number(t.total)||0),0):0;if(t({...c,prescricoesPeriodo:p}),a(q(r,"prescricoes")),l(q(i,"pacientes")),d(n?.nextSteps||n||[]),m(o?.alerts||o||[]),Array.isArray(x)&&x.length>0){const e=x.map(e=>({date:new Date(e.data).toLocaleDateString("pt-BR",{day:"2-digit",month:"short"}),value:Number(e.total)||0}));h(e)}else h([]);y(new Date)}catch(s){const{handleApiError:e}=await Ea(async()=>{const{handleApiError:e}=await Promise.resolve().then(()=>zr);return{handleApiError:e}},void 0);e(s,rr("load","dados do dashboard"))}finally{f(!1),j(!1)}};if(b)return Fe.jsx("div",{className:"flex items-center justify-center h-full",children:Fe.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})});const F={critical:"bg-rose-50 text-rose-700 border-rose-200",warning:"bg-amber-50 text-amber-700 border-amber-200",info:"bg-primary-50 text-primary-700 border-primary-200"},B=[{label:"Dashboard",path:"/dashboard",icon:A,accent:"from-primary-500 to-primary-600"},{label:"Agenda",path:"/agenda",icon:R,accent:"from-emerald-500 to-emerald-600"},{label:"Cronograma",path:"/cronograma",icon:z,accent:"from-orange-500 to-amber-500"},{label:"Prescrições",path:"/prescricoes",icon:C,accent:"from-purple-500 to-purple-600"},{label:"Censo M.P.",path:"/censo-mp",icon:D,accent:"from-sky-500 to-sky-600"},{label:"Pacientes",path:"/residentes",icon:S,accent:"from-amber-500 to-orange-500"},{label:"Estoque",path:"/estoque",icon:T,accent:"from-blue-500 to-indigo-500"},{label:"Evolução",path:"/evolucao",icon:_,accent:"from-teal-500 to-emerald-500"},{label:"Financeiro",path:"/financeiro",icon:L,accent:"from-lime-500 to-green-500"},{label:"Usuários",path:"/usuarios",icon:k,accent:"from-fuchsia-500 to-purple-600"},{label:"Empresas",path:"/empresas",icon:u,accent:"from-cyan-500 to-blue-500"},{label:"Configurações",path:"/configuracoes",icon:$,accent:"from-slate-500 to-slate-700"}];return Fe.jsxs("div",{className:"space-y-8",children:[Fe.jsxs(yr,{label:"Visão Geral",title:"Dashboard",subtitle:"Acompanhe em tempo real pacientes, prescrições e equipes para manter a operação segura e eficiente."+(v?" Atualizado "+v.toLocaleTimeString("pt-BR"):""),children:[Fe.jsxs("button",{onClick:async()=>{await I({background:!0}),p.success("Dados atualizados com sucesso!")},className:"btn btn-secondary flex items-center justify-center gap-2",children:[Fe.jsx(E,{size:18})," Atualizar dados"]}),Fe.jsxs("button",{onClick:()=>{p.promise(new Promise(e=>setTimeout(e,2e3)),{loading:"Gerando relatório...",success:"Relatório enviado para seu e-mail!",error:"Erro ao gerar relatório"})},className:"btn btn-primary flex items-center justify-center gap-2",children:[Fe.jsx(P,{size:18})," Exportar relatório"]})]}),("superadmin"===w?.role||w&&"superadmin@prescrimed.com"===w.email)&&Fe.jsxs("div",{className:"card border border-slate-100 shadow-sm",children:[Fe.jsxs("div",{className:"flex items-center justify-between gap-3 mb-4",children:[Fe.jsxs("div",{children:[Fe.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:"Acesso rápido"}),Fe.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Módulos do sistema"}),Fe.jsx("p",{className:"text-sm text-slate-500",children:"Clique para abrir qualquer módulo com acesso total."})]}),Fe.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-primary-50 text-primary-700 border border-primary-100",children:"SuperAdmin"})]}),Fe.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-3",children:B.map(e=>{const t=e.icon;return Fe.jsxs("button",{onClick:()=>N(e.path),className:"group w-full text-left p-4 rounded-2xl border border-slate-100 bg-white hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200",children:[Fe.jsx("div",{className:`w-10 h-10 rounded-xl bg-gradient-to-br ${e.accent} text-white flex items-center justify-center mb-3 shadow-sm`,children:Fe.jsx(t,{size:20})}),Fe.jsx("p",{className:"font-semibold text-slate-900 leading-snug",children:e.label}),Fe.jsx("p",{className:"text-xs text-slate-500 mt-1 group-hover:text-slate-700",children:"Acesso direto"})]},e.path)})})]}),Fe.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[Fe.jsxs("div",{className:"card",children:[Fe.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[Fe.jsx(D,{className:"text-primary-600",size:24}),Fe.jsxs("div",{children:[Fe.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:"Próximos passos"}),Fe.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Controle operacional"})]})]}),Fe.jsx("div",{className:"space-y-4",children:o.length>0?o.map(e=>Fe.jsxs("div",{className:"p-4 rounded-2xl border border-slate-100 bg-slate-50",children:[Fe.jsx("h3",{className:"font-semibold text-slate-900",children:e.title}),Fe.jsx("p",{className:"text-sm text-slate-500 mt-1",children:e.description}),Fe.jsx("button",{onClick:()=>e.ctaRoute&&N(e.ctaRoute),className:"text-primary-600 text-sm font-semibold mt-3 hover:underline",children:e.ctaLabel})]},e.id)):Fe.jsx("p",{className:"text-sm text-slate-500",children:"Nenhuma pendência encontrada."})})]}),Fe.jsxs("div",{className:"card",children:[Fe.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[Fe.jsx(O,{className:"text-amber-600",size:24}),Fe.jsxs("div",{children:[Fe.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:"Alertas críticos"}),Fe.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Atenção imediata"})]})]}),Fe.jsx("div",{className:"space-y-4",children:c.length>0?c.map(e=>Fe.jsxs("div",{className:`p-4 rounded-2xl border ${F[e.severity]||"bg-slate-50 text-slate-700 border-slate-200"}`,children:[Fe.jsx("h3",{className:"font-semibold",children:e.title}),Fe.jsx("p",{className:"text-sm opacity-80 mt-1",children:e.detail})]},e.id)):Fe.jsx("p",{className:"text-sm text-slate-500",children:"Nenhum alerta crítico no momento."})})]})]}),Fe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6",children:[Fe.jsx(Nr,{icon:S,label:"Pacientes",value:e?.totalPacientes||0,description:`${e?.leitos?.ocupados||0} leitos ocupados`,color:"primary"}),Fe.jsx(Nr,{icon:C,label:"Prescrições",value:e?.totalPrescricoes||0,description:`${e?.prescrioesAtivas||0} ativas`,color:"emerald"}),Fe.jsx(Nr,{icon:k,label:"Equipe",value:e?.totalUsuarios||0,description:"Profissionais ativos",color:"purple"}),Fe.jsx(Nr,{icon:R,label:"Agendamentos",value:e?.agendamentosHoje||0,description:"Para hoje",color:"amber"})]}),Fe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[Fe.jsxs("div",{className:"card bg-gradient-to-br from-sky-50 to-blue-50 border-sky-200",children:[Fe.jsx("div",{className:"flex items-center justify-between mb-4",children:Fe.jsxs("div",{className:"flex items-center gap-3",children:[Fe.jsx("div",{className:"p-3 bg-sky-100 rounded-xl",children:Fe.jsx(u,{className:"text-sky-700",size:24})}),Fe.jsxs("div",{children:[Fe.jsx("p",{className:"text-xs uppercase tracking-wider text-sky-600 font-semibold",children:"Leitos"}),Fe.jsx("h3",{className:"text-2xl font-bold text-sky-900",children:e?.leitos?.total||0})]})]})}),Fe.jsxs("div",{className:"space-y-2",children:[Fe.jsxs("div",{className:"flex justify-between items-center",children:[Fe.jsx("span",{className:"text-sm text-sky-700",children:"Ocupados"}),Fe.jsx("span",{className:"font-semibold text-sky-900",children:e?.leitos?.ocupados||0})]}),Fe.jsxs("div",{className:"flex justify-between items-center",children:[Fe.jsx("span",{className:"text-sm text-sky-700",children:"Disponíveis"}),Fe.jsx("span",{className:"font-semibold text-emerald-700",children:e?.leitos?.disponiveis||0})]}),Fe.jsx("div",{className:"mt-3 w-full bg-sky-200 rounded-full h-2 overflow-hidden",children:Fe.jsx("div",{className:"bg-sky-600 h-full rounded-full transition-all",style:{width:(e?.leitos?.total>0?e?.leitos?.ocupados/e?.leitos?.total*100:0)+"%"}})}),Fe.jsxs("p",{className:"text-xs text-sky-600 text-center",children:[e?.leitos?.total>0?Math.round(e?.leitos?.ocupados/e?.leitos?.total*100):0,"% de ocupação"]})]})]}),Fe.jsxs("div",{className:"card bg-gradient-to-br from-orange-50 to-amber-50 border-orange-200",children:[Fe.jsx("div",{className:"flex items-center justify-between mb-4",children:Fe.jsxs("div",{className:"flex items-center gap-3",children:[Fe.jsx("div",{className:"p-3 bg-orange-100 rounded-xl",children:Fe.jsx(T,{className:"text-orange-700",size:24})}),Fe.jsxs("div",{children:[Fe.jsx("p",{className:"text-xs uppercase tracking-wider text-orange-600 font-semibold",children:"Estoque"}),Fe.jsx("h3",{className:"text-2xl font-bold text-orange-900",children:e?.estoque?.total||0})]})]})}),Fe.jsxs("div",{className:"space-y-2",children:[Fe.jsxs("div",{className:"flex justify-between items-center",children:[Fe.jsx("span",{className:"text-sm text-orange-700",children:"Itens cadastrados"}),Fe.jsx("span",{className:"font-semibold text-orange-900",children:e?.estoque?.total||0})]}),Fe.jsxs("div",{className:"flex justify-between items-center",children:[Fe.jsx("span",{className:"text-sm text-orange-700",children:"Abaixo do mínimo"}),Fe.jsx("span",{className:"font-semibold text-red-700",children:e?.estoque?.abaixoMinimo||0})]}),e?.estoque?.abaixoMinimo>0&&Fe.jsx("div",{className:"mt-3 p-2 bg-red-100 border border-red-200 rounded-lg",children:Fe.jsxs("p",{className:"text-xs text-red-700 font-semibold flex items-center gap-1",children:[Fe.jsx(O,{size:14}),"Atenção ao estoque!"]})})]})]}),Fe.jsxs("div",{className:"card bg-gradient-to-br from-emerald-50 to-green-50 border-emerald-200",children:[Fe.jsx("div",{className:"flex items-center justify-between mb-4",children:Fe.jsxs("div",{className:"flex items-center gap-3",children:[Fe.jsx("div",{className:"p-3 bg-emerald-100 rounded-xl",children:Fe.jsx(L,{className:"text-emerald-700",size:24})}),Fe.jsxs("div",{children:[Fe.jsx("p",{className:"text-xs uppercase tracking-wider text-emerald-600 font-semibold",children:"Saldo"}),Fe.jsxs("h3",{className:"text-2xl font-bold text-emerald-900",children:["R$ ",(e?.financeiro?.saldo||0).toLocaleString("pt-BR",{minimumFractionDigits:2})]})]})]})}),Fe.jsxs("div",{className:"space-y-2",children:[Fe.jsxs("div",{className:"flex justify-between items-center",children:[Fe.jsx("span",{className:"text-sm text-emerald-700",children:"Receitas"}),Fe.jsxs("span",{className:"font-semibold text-emerald-900",children:["R$ ",(e?.financeiro?.receitasPagas||0).toLocaleString("pt-BR",{minimumFractionDigits:2})]})]}),Fe.jsxs("div",{className:"flex justify-between items-center",children:[Fe.jsx("span",{className:"text-sm text-emerald-700",children:"Despesas"}),Fe.jsxs("span",{className:"font-semibold text-red-700",children:["R$ ",(e?.financeiro?.despesasPagas||0).toLocaleString("pt-BR",{minimumFractionDigits:2})]})]}),Fe.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-emerald-200",children:[Fe.jsx("span",{className:"text-sm text-emerald-700 font-semibold",children:"Pendentes"}),Fe.jsxs("span",{className:"text-xs text-amber-700",children:["R$ ",((e?.financeiro?.receitasPendentes||0)+(e?.financeiro?.despesasPendentes||0)).toLocaleString("pt-BR",{minimumFractionDigits:2})]})]})]})]})]}),Fe.jsxs("div",{className:"card p-6",children:[Fe.jsxs("div",{className:"flex items-center justify-between mb-6",children:[Fe.jsxs("div",{className:"flex items-center gap-3",children:[Fe.jsx(_,{className:"text-primary-600",size:24}),Fe.jsxs("div",{children:[Fe.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:"Análise"}),Fe.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"Evolução de Prescrições"})]})]}),Fe.jsxs("div",{className:"flex items-center gap-2",children:[Fe.jsx(R,{className:"text-slate-400",size:16}),Fe.jsx("span",{className:"text-sm text-slate-600",children:"Últimos 30 dias"}),g&&Fe.jsx("span",{className:"text-xs text-slate-400",children:"atualizando..."})]})]}),Fe.jsx("div",{className:"h-64 w-full",children:x.length>0?Fe.jsx(vr,{data:x,color:"#2d5016",height:250}):Fe.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-400",children:[Fe.jsx(A,{size:48,className:"mb-2 opacity-20"}),Fe.jsx("p",{children:"Dados insuficientes para o gráfico"}),Fe.jsx("p",{className:"text-xs mt-1",children:"Cadastre prescrições para visualizar a evolução"})]})})]}),Fe.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[Fe.jsxs("div",{className:"card",children:[Fe.jsxs("div",{className:"flex items-center justify-between mb-4",children:[Fe.jsxs("div",{children:[Fe.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:"Atividade"}),Fe.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"Prescrições Recentes"})]}),Fe.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-primary-50 text-primary-700",children:[s.length," registros"]})]}),Fe.jsx("div",{className:"space-y-4",children:s.length>0?s.map(e=>Fe.jsxs("div",{className:"p-4 rounded-2xl border border-slate-100 bg-slate-50",children:[Fe.jsxs("div",{className:"flex justify-between gap-3 mb-2",children:[Fe.jsxs("div",{children:[Fe.jsx("p",{className:"font-semibold text-slate-900",children:e.paciente?.nome||e.pacienteNome||"Paciente não identificado"}),Fe.jsx("p",{className:"text-xs text-slate-500",children:new Date(e.createdAt).toLocaleString("pt-BR")}),Fe.jsxs("p",{className:"text-xs text-slate-400",children:["Código: ",e.id||e._id]})]}),Fe.jsxs("div",{className:"flex gap-2",children:[Fe.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-semibold "+("medicamentosa"===e.tipo?"bg-orange-100 text-orange-700":"mista"===e.tipo?"bg-purple-100 text-purple-700":"bg-primary-100 text-primary-700"),children:"medicamentosa"===e.tipo?"Medicamentosa":"mista"===e.tipo?"Mista":"Nutricional"}),Fe.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-semibold "+("ativa"===(e.status||"ativa")?"bg-emerald-100 text-emerald-700":"bg-red-100 text-red-700"),children:e.status||"ativa"})]})]}),Array.isArray(e.itens)&&e.itens.length>0&&Fe.jsxs("p",{className:"text-sm text-slate-600",children:[e.itens[0]?.nome||"Item",e.itens.length>1&&` + ${e.itens.length-1} itens`]})]},e.id||e._id)):Fe.jsx("p",{className:"text-slate-500 text-center py-8",children:"Nenhuma prescrição recente"})})]}),Fe.jsxs("div",{className:"card",children:[Fe.jsxs("div",{className:"flex items-center justify-between mb-4",children:[Fe.jsxs("div",{children:[Fe.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:"Cadastros"}),Fe.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"Pacientes Recentes"})]}),Fe.jsx("span",{className:"text-xs text-slate-400",children:v?`Atualizado às ${v.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}`:"Atualizado hoje"})]}),Fe.jsx("div",{className:"space-y-3",children:n.length>0?n.map(e=>Fe.jsxs("div",{className:"p-4 rounded-2xl border border-slate-100",children:[Fe.jsx("p",{className:"font-semibold text-slate-900",children:e.nome}),Fe.jsxs("div",{className:"flex flex-wrap gap-3 text-sm text-slate-500 mt-1",children:[Fe.jsxs("span",{children:["CPF: ",e.cpf]}),Fe.jsxs("span",{children:["Entrada: ",new Date(e.createdAt).toLocaleDateString("pt-BR")]}),Fe.jsxs("span",{className:"text-xs text-slate-400",children:["Código: ",e.id||e._id]})]})]},e.id||e._id)):Fe.jsx("p",{className:"text-slate-500 text-center py-8",children:"Nenhum paciente recente"})})]})]})]})}const Sr=async(e="",t={})=>Ma(e?`/pacientes?${e}`:"/pacientes",t),Cr=async e=>Ma(`/pacientes/${e}/prescricoes`),kr=async e=>Ua("/pacientes",e),Ar=async(e,t)=>Va(`/pacientes/${e}`,t),Er=async e=>Va(`/pacientes/${e}/inativar`);function Pr({paciente:e,onClose:t}){const[s,a]=i.useState({nome:"",cpf:"",dataNascimento:"",sexo:"",telefone:"",email:"",cep:"",rua:"",numero:"",bairro:"",cidade:"",estado:"",contatoNome:"",contatoTelefone:"",contatoRelacao:""}),[r,n]=i.useState(!1),[l,o]=i.useState({});i.useEffect(()=>{if(e){let s={},r={};try{"string"==typeof e.endereco?s=JSON.parse(e.endereco||"{}"):e.endereco&&(s=e.endereco)}catch(t){}try{"string"==typeof e.contatoEmergencia?r=JSON.parse(e.contatoEmergencia||"{}"):e.contatoEmergencia&&(r=e.contatoEmergencia)}catch(t){}a({nome:e.nome||"",cpf:e.cpf||"",dataNascimento:e.dataNascimento?e.dataNascimento.split("T")[0]:"",sexo:e.sexo||"",telefone:e.telefone||"",email:e.email||"",cep:s.cep||"",rua:s.rua||"",numero:s.numero||"",bairro:s.bairro||"",cidade:s.cidade||"",estado:s.estado||"",contatoNome:r.nome||"",contatoTelefone:r.telefone||"",contatoRelacao:r.relacao||""})}},[e]);const d=async a=>{if(a.preventDefault(),(()=>{const e={};if(s.nome.trim()||(e.nome="Nome é obrigatório"),s.cpf.trim()||(e.cpf="CPF é obrigatório"),s.dataNascimento||(e.dataNascimento="Data de nascimento é obrigatória"),s.sexo||(e.sexo="Sexo é obrigatório"),s.telefone.trim()||(e.telefone="Telefone é obrigatório"),s.cpf){const t=s.cpf.replace(/\D/g,"");11!==t.length?e.cpf="CPF deve ter 11 dígitos":xr(t)||(e.cpf="CPF inválido")}return s.email&&s.email.trim()&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email)&&(e.email="E-mail inválido"),o(e),0===Object.keys(e).length})()){n(!0);try{const a=JSON.stringify({cep:s.cep||"",rua:s.rua||"",numero:s.numero||"",bairro:s.bairro||"",cidade:s.cidade||"",estado:s.estado||""}),r=JSON.stringify({nome:s.contatoNome||"",telefone:s.contatoTelefone||"",relacao:s.contatoRelacao||""}),i={nome:s.nome.trim(),cpf:s.cpf.replace(/\D/g,""),dataNascimento:s.dataNascimento,sexo:s.sexo,telefone:s.telefone.replace(/\D/g,""),email:s.email.trim()||null,endereco:a,contatoEmergencia:r};e?(await Ar(e.id||e._id,i),p.success(ar("update","Residente"))):(await kr(i),p.success(ar("create","Residente"))),t()}catch(r){const{handleApiError:e}=await Ea(async()=>{const{handleApiError:e}=await Promise.resolve().then(()=>zr);return{handleApiError:e}},void 0);e(r,rr("save","residente"))}finally{n(!1)}}else p.error("Por favor, corrija os erros no formulário")},c=e=>{const{name:t,value:r}=e.target;if(l[t]&&o({...l,[t]:null}),"cpf"===t){const e=String(r||"").replace(/\D/g,"").slice(0,11),t=11===e.length?cr(e):e.length<=3?e:e.length<=6?e.replace(/(\d{3})(\d{0,3})/,"$1.$2"):e.length<=9?e.replace(/(\d{3})(\d{3})(\d{0,3})/,"$1.$2.$3"):e;return void a({...s,cpf:t})}a({...s,[t]:r})};return Fe.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center p-4 z-50 overflow-y-auto",children:Fe.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-4xl my-8 animate-in fade-in zoom-in duration-200",children:[Fe.jsxs("div",{className:"px-6 py-5 border-b border-slate-200 dark:border-gray-700 flex justify-between items-center bg-gradient-to-r from-primary-50 to-primary-100/50 dark:from-gray-800 dark:to-gray-700 sticky top-0 z-10 rounded-t-2xl",children:[Fe.jsxs("div",{children:[Fe.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-gray-100",children:e?"Editar Paciente":"Novo Paciente"}),Fe.jsx("p",{className:"text-sm text-slate-600 dark:text-gray-400 mt-1",children:"Preencha os dados do residente para cadastro"})]}),Fe.jsx("button",{onClick:t,className:"p-2 hover:bg-white/50 dark:hover:bg-gray-700 rounded-lg transition",children:Fe.jsx(q,{size:24,className:"text-slate-600 dark:text-gray-300"})})]}),Fe.jsxs("form",{onSubmit:d,className:"p-6 space-y-6 max-h-[calc(90vh-120px)] overflow-y-auto custom-scrollbar",children:[Fe.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-slate-200 dark:border-gray-700 p-5",children:[Fe.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[Fe.jsx("div",{className:"p-2 bg-primary-100 dark:bg-primary-900 rounded-lg",children:Fe.jsx(I,{size:20,className:"text-primary-600 dark:text-primary-400"})}),Fe.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-gray-100",children:"Dados Pessoais"})]}),Fe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-gray-300 mb-1.5",children:"Nome Completo *"}),Fe.jsx("input",{type:"text",name:"nome",value:s.nome,onChange:c,className:"input w-full "+(l.nome?"border-red-500 focus:ring-red-500":""),placeholder:"Nome completo do residente",required:!0}),l.nome&&Fe.jsxs("p",{className:"text-red-500 text-xs mt-1 flex items-center gap-1",children:[Fe.jsx(F,{size:12})," ",l.nome]})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-gray-300 mb-1.5",children:"CPF *"}),Fe.jsx("input",{type:"text",name:"cpf",value:s.cpf,onChange:c,className:"input w-full "+(l.cpf?"border-red-500 focus:ring-red-500":""),placeholder:"000.000.000-00",maxLength:14,required:!0}),l.cpf&&Fe.jsxs("p",{className:"text-red-500 text-xs mt-1 flex items-center gap-1",children:[Fe.jsx(F,{size:12})," ",l.cpf]})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-gray-300 mb-1.5",children:"Data de Nascimento *"}),Fe.jsx("input",{type:"date",name:"dataNascimento",value:s.dataNascimento,onChange:c,className:"input w-full "+(l.dataNascimento?"border-red-500 focus:ring-red-500":""),required:!0}),l.dataNascimento&&Fe.jsxs("p",{className:"text-red-500 text-xs mt-1 flex items-center gap-1",children:[Fe.jsx(F,{size:12})," ",l.dataNascimento]})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-gray-300 mb-1.5",children:"Sexo *"}),Fe.jsxs("select",{name:"sexo",value:s.sexo,onChange:c,className:"input w-full "+(l.sexo?"border-red-500 focus:ring-red-500":""),required:!0,children:[Fe.jsx("option",{value:"",children:"Selecione"}),Fe.jsx("option",{value:"M",children:"Masculino"}),Fe.jsx("option",{value:"F",children:"Feminino"}),Fe.jsx("option",{value:"Outro",children:"Outro"})]}),l.sexo&&Fe.jsxs("p",{className:"text-red-500 text-xs mt-1 flex items-center gap-1",children:[Fe.jsx(F,{size:12})," ",l.sexo]})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-gray-300 mb-1.5",children:"Telefone *"}),Fe.jsx("input",{type:"tel",name:"telefone",value:s.telefone,onChange:c,className:"input w-full "+(l.telefone?"border-red-500 focus:ring-red-500":""),placeholder:"(00) 00000-0000",maxLength:15,required:!0}),l.telefone&&Fe.jsxs("p",{className:"text-red-500 text-xs mt-1 flex items-center gap-1",children:[Fe.jsx(F,{size:12})," ",l.telefone]})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-gray-300 mb-1.5",children:"E-mail"}),Fe.jsx("input",{type:"email",name:"email",value:s.email,onChange:c,className:"input w-full "+(l.email?"border-red-500 focus:ring-red-500":""),placeholder:"email@exemplo.com"}),l.email&&Fe.jsxs("p",{className:"text-red-500 text-xs mt-1 flex items-center gap-1",children:[Fe.jsx(F,{size:12})," ",l.email]})]})]})]}),Fe.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-slate-200 dark:border-gray-700 p-5",children:[Fe.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[Fe.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900 rounded-lg",children:Fe.jsx(B,{size:20,className:"text-blue-600 dark:text-blue-400"})}),Fe.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-gray-100",children:"Endereço"})]}),Fe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-gray-300 mb-1.5",children:"CEP"}),Fe.jsx("input",{type:"text",name:"cep",value:s.cep,onChange:c,className:"input w-full",placeholder:"00000-000",maxLength:9})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-gray-300 mb-1.5",children:"Rua"}),Fe.jsx("input",{type:"text",name:"rua",value:s.rua,onChange:c,className:"input w-full",placeholder:"Nome da rua"})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-gray-300 mb-1.5",children:"Número"}),Fe.jsx("input",{type:"text",name:"numero",value:s.numero,onChange:c,className:"input w-full",placeholder:"Nº"})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-gray-300 mb-1.5",children:"Bairro"}),Fe.jsx("input",{type:"text",name:"bairro",value:s.bairro,onChange:c,className:"input w-full",placeholder:"Bairro"})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-gray-300 mb-1.5",children:"Cidade"}),Fe.jsx("input",{type:"text",name:"cidade",value:s.cidade,onChange:c,className:"input w-full",placeholder:"Cidade"})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-gray-300 mb-1.5",children:"Estado"}),Fe.jsxs("select",{name:"estado",value:s.estado,onChange:c,className:"input w-full",children:[Fe.jsx("option",{value:"",children:"Selecione"}),Fe.jsx("option",{value:"AC",children:"Acre"}),Fe.jsx("option",{value:"AL",children:"Alagoas"}),Fe.jsx("option",{value:"AP",children:"Amapá"}),Fe.jsx("option",{value:"AM",children:"Amazonas"}),Fe.jsx("option",{value:"BA",children:"Bahia"}),Fe.jsx("option",{value:"CE",children:"Ceará"}),Fe.jsx("option",{value:"DF",children:"Distrito Federal"}),Fe.jsx("option",{value:"ES",children:"Espírito Santo"}),Fe.jsx("option",{value:"GO",children:"Goiás"}),Fe.jsx("option",{value:"MA",children:"Maranhão"}),Fe.jsx("option",{value:"MT",children:"Mato Grosso"}),Fe.jsx("option",{value:"MS",children:"Mato Grosso do Sul"}),Fe.jsx("option",{value:"MG",children:"Minas Gerais"}),Fe.jsx("option",{value:"PA",children:"Pará"}),Fe.jsx("option",{value:"PB",children:"Paraíba"}),Fe.jsx("option",{value:"PR",children:"Paraná"}),Fe.jsx("option",{value:"PE",children:"Pernambuco"}),Fe.jsx("option",{value:"PI",children:"Piauí"}),Fe.jsx("option",{value:"RJ",children:"Rio de Janeiro"}),Fe.jsx("option",{value:"RN",children:"Rio Grande do Norte"}),Fe.jsx("option",{value:"RS",children:"Rio Grande do Sul"}),Fe.jsx("option",{value:"RO",children:"Rondônia"}),Fe.jsx("option",{value:"RR",children:"Roraima"}),Fe.jsx("option",{value:"SC",children:"Santa Catarina"}),Fe.jsx("option",{value:"SP",children:"São Paulo"}),Fe.jsx("option",{value:"SE",children:"Sergipe"}),Fe.jsx("option",{value:"TO",children:"Tocantins"})]})]})]})]}),Fe.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-slate-200 dark:border-gray-700 p-5",children:[Fe.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[Fe.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-900 rounded-lg",children:Fe.jsx(M,{size:20,className:"text-orange-600 dark:text-orange-400"})}),Fe.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-gray-100",children:"Contato de Emergência"})]}),Fe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-gray-300 mb-1.5",children:"Nome"}),Fe.jsx("input",{type:"text",name:"contatoNome",value:s.contatoNome,onChange:c,className:"input w-full",placeholder:"Nome do contato"})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-gray-300 mb-1.5",children:"Telefone"}),Fe.jsx("input",{type:"tel",name:"contatoTelefone",value:s.contatoTelefone,onChange:c,className:"input w-full",placeholder:"(00) 00000-0000",maxLength:15})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-gray-300 mb-1.5",children:"Relação"}),Fe.jsx("input",{type:"text",name:"contatoRelacao",value:s.contatoRelacao,onChange:c,className:"input w-full",placeholder:"Ex: Filho(a), Cônjuge"})]})]})]})]}),Fe.jsxs("div",{className:"px-6 py-4 border-t border-slate-200 dark:border-gray-700 bg-slate-50 dark:bg-gray-900 flex justify-end gap-3 sticky bottom-0 rounded-b-2xl",children:[Fe.jsx("button",{type:"button",onClick:t,className:"btn btn-secondary px-6 py-2.5",disabled:r,children:"Cancelar"}),Fe.jsx("button",{type:"submit",onClick:d,disabled:r,className:"btn btn-primary px-6 py-2.5 shadow-lg shadow-primary-500/20 disabled:opacity-50 disabled:cursor-not-allowed",children:r?Fe.jsxs("span",{className:"flex items-center gap-2",children:[Fe.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Salvando..."]}):"Salvar"})]})]})})}function Rr(e,t="Ocorreu um erro.",s){try{const a=lr(e),r=or(a)||nr(e,t);return"undefined"!=typeof window&&"function"==typeof window.showToast&&window.showToast("error",r,s),r}catch(a){return"undefined"!=typeof window&&"function"==typeof window.showToast&&window.showToast("error",t,s),t}}const zr=Object.freeze(Object.defineProperty({__proto__:null,handleApiError:Rr},Symbol.toStringTag,{value:"Module"}));function Dr({searchTerm:e,onSearchChange:t,placeholder:s,children:a}){return Fe.jsxs("div",{className:"card p-4 flex flex-col md:flex-row gap-4 items-center justify-between",children:[Fe.jsxs("div",{className:"relative w-full md:w-96",children:[Fe.jsx(U,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:20}),Fe.jsx("input",{type:"text",placeholder:s||"Buscar...",value:e,onChange:e=>t(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition"})]}),Fe.jsx("div",{className:"flex flex-wrap gap-3 w-full md:w-auto justify-end",children:a})]})}function Tr({icon:e,title:t,description:s,actionLabel:a,onAction:r}){return Fe.jsxs("div",{className:"text-center py-16",children:[Fe.jsx("div",{className:"w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-4",children:Fe.jsx(e,{size:32,className:"text-slate-300"})}),Fe.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:t}),Fe.jsx("p",{className:"text-slate-500 mt-1",children:s}),a&&r&&Fe.jsx("button",{onClick:r,className:"btn btn-primary mt-4",children:a})]})}const _r={primary:"from-primary-500 to-primary-600",danger:"from-red-500 to-red-600",emerald:"from-emerald-500 to-emerald-600"};function Lr({onClick:e,disabled:t=!1,loading:s=!1,variant:a="primary",icon:r,iconSize:i=18,tooltip:n,title:l,ariaLabel:o,className:d="",tooltipClassName:c=""}){const m=_r[a]||_r.primary;return Fe.jsxs("button",{onClick:e,disabled:t,className:`group relative p-2.5 text-slate-500 hover:text-white hover:bg-gradient-to-br ${m} rounded-lg transition-all duration-200 shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed ${d}`,title:l||n,"aria-label":o||n,type:"button",children:[s?Fe.jsx("div",{className:"animate-spin rounded-full h-[18px] w-[18px] border-2 border-white border-t-transparent"}):r?Fe.jsx(r,{size:i}):null,n?Fe.jsx("span",{className:`absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 text-xs font-medium text-white bg-slate-800 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-10 ${c}`,children:n}):null]})}function $r({title:e,actions:t,emptyMessage:s,children:a}){return Fe.jsxs("div",{className:"bg-white dark:bg-gray-900 shadow rounded-lg",children:[(e||t)&&Fe.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-800",children:[e&&Fe.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100 flex-1",children:e}),t&&Fe.jsx("div",{className:"flex items-center gap-2",children:t})]}),Fe.jsx("div",{className:"px-2 md:px-0",children:a}),s&&Fe.jsx("div",{className:"px-4 py-6 text-center text-gray-500 dark:text-gray-400",children:s})]})}function Or({children:e}){return Fe.jsx("div",{className:"md:hidden space-y-3 p-2",children:e})}function qr({children:e}){return Fe.jsx("div",{className:"rounded-lg border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 p-3",children:e})}function Ir({children:e}){return Fe.jsx("div",{className:"hidden md:block overflow-x-auto",children:Fe.jsx("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-800",children:e})})}function Fr({columns:e}){return Fe.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:Fe.jsx("tr",{children:e.map((e,t)=>Fe.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:e},t))})})}function Br({children:e}){return Fe.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-800",children:e})}function Mr({children:e}){return Fe.jsx("tr",{children:e})}function Ur({children:e,className:t=""}){return Fe.jsx("td",{className:`px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-200 ${t}`,children:e})}function Vr(e){return null==e?"":String(e).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;")}function Gr({title:e,bodyHtml:t,styles:s="",printDelayMs:a=250}={}){const r=window.open("","_blank");if(!r)throw new Error("Não foi possível abrir a janela de impressão (popup bloqueado?)");const i=`\n    <!DOCTYPE html>\n    <html>\n      <head>\n        <title>${Vr(e||"Relatório - Prescrimed")}</title>\n        <meta charset="utf-8" />\n        ${s?`<style>${s}</style>`:""}\n      </head>\n      <body>\n        ${t||""}\n      </body>\n    </html>\n  `;return r.document.open(),r.document.write(i),r.document.close(),setTimeout(()=>{r.print()},a),r}var Hr=function(){return"undefined"!=typeof Buffer&&"undefined"!=typeof process&&void 0!==process.versions&&!!process.versions.node}();var Jr=/\u0000/g;var Qr=function(e,t,s){for(var a=[],r=t;r<s;r+=2)a.push(String.fromCharCode(ii(e,r)));return a.join("").replace(Jr,"")},Wr=Hr?function(e,t,s){return Buffer.isBuffer(e)?e.toString("utf16le",t,s).replace(Jr,""):Qr(e,t,s)}:Qr,Kr=function(e,t,s){for(var a=[],r=t;r<s;r++)a.push(String.fromCharCode(ri(e,r)));return a.join("")},Yr=Hr?function(e,t,s){return Buffer.isBuffer(e)?e.toString("utf8",t,s):Kr(e,t,s)}:Kr,Xr=function(e,t){var s=ni(e,t);return s>0?Yr(e,t+4,t+4+s-1):""},Zr=function(e,t){var s=ni(e,t);return s>0?Yr(e,t+4,t+4+s-1):""},ei=function(e,t){var s=2*ni(e,t);return s>0?Yr(e,t+4,t+4+s-1):""},ti=function(e,t){var s=ni(e,t);return s>0?Wr(e,t+4,t+4+s):""},si=function(e,t){var s=ni(e,t);return s>0?Yr(e,t+4,t+4+s):""},ai=function(e,t){return function(e,t){for(var s=1-2*(e[t+7]>>>7),a=((127&e[t+7])<<4)+(e[t+6]>>>4&15),r=15&e[t+6],i=5;i>=0;--i)r=256*r+e[t+i];return 2047==a?0==r?s*(1/0):NaN:(0==a?a=-1022:(a-=1023,r+=Math.pow(2,52)),s*Math.pow(2,a-52)*r)}(e,t)};var ri=function(e,t){return e[t]},ii=function(e,t){return 256*e[t+1]+e[t]},ni=function(e,t){return e[t+3]*(1<<24)+(e[t+2]<<16)+(e[t+1]<<8)+e[t]};function li(){const[e,t]=i.useState([]),[s,a]=i.useState(1),[r,n]=i.useState(0),[l,o]=i.useState(10),[d,c]=i.useState(!0),[m,x]=i.useState(""),[u,b]=i.useState(""),[f,g]=i.useState(!1),[j,v]=i.useState(!1),[y,N]=i.useState(null),[w,k]=i.useState(null),[A,z]=i.useState([]),[D,T]=i.useState(null),[_,L]=i.useState(!1);i.useRef(null);i.useEffect(()=>{$()},[s]);const $=async(e="")=>{try{c(!0);const a=new URLSearchParams;e&&a.append("search",e),u&&a.append("status",u),a.append("page",String(s)),a.append("pageSize",String(l));const r=await Sr(a.toString());if(Array.isArray(r))t(r),n(r.length);else{const e=Array.isArray(r.items)?r.items:r.pacientes||[];t(e),n(Number(r.total)||0),o(Number(r.pageSize)||10)}}catch(a){const{handleApiError:e}=await Ea(async()=>{const{handleApiError:e}=await Promise.resolve().then(()=>zr);return{handleApiError:e}},void 0);e(a,rr("load","pacientes"))}finally{c(!1)}},O=async e=>{try{k(e);const t=await Cr(e.id||e._id);z(t.prescricoes||[])}catch(t){const{handleApiError:e}=await Ea(async()=>{const{handleApiError:e}=await Promise.resolve().then(()=>zr);return{handleApiError:e}},void 0);e(t,rr("load","histórico"))}},I=e.filter(e=>{const t=e.nome.toLowerCase().includes(m.toLowerCase())||e.cpf&&e.cpf.includes(m),s=!u||e.status===u;return t&&s}),F=e.filter(e=>{if(!e.createdAt)return!1;const t=new Date(e.createdAt),s=new Date;return t.getMonth()===s.getMonth()&&t.getFullYear()===s.getFullYear()}).length,U=e.filter(e=>e.dataNascimento),V=U.length>0?Math.round(U.reduce((e,t)=>e+((new Date).getFullYear()-new Date(t.dataNascimento).getFullYear()),0)/U.length):0,G={total:e.length,novosMes:F,idadeMedia:V},{user:H}=Ya.getState(),Y=H?.role,X="superadmin"===Y||("fisioterapia"===(H?.empresa?.tipoSistema||"casa-repouso")?["admin","enfermeiro","assistente_social","fisioterapeuta","medico"].includes(Y):["admin","enfermeiro","assistente_social","medico"].includes(Y)),Z=e=>{X?(e=>{N(e),v(!0)})(e):Rr({response:{data:{code:"access_denied"}}},"Acesso negado: seu perfil não pode editar residentes neste módulo")},ee="admin"===Y,te=(e,t)=>{ee?(async(e,t)=>{const s=`Confirmar inativação do residente "${t}"?`;if(window.confirm(s))try{T(e),await Er(e),p.success("Residente inativado com sucesso"),$(m)}catch(a){const{handleApiError:e}=await Ea(async()=>{const{handleApiError:e}=await Promise.resolve().then(()=>zr);return{handleApiError:e}},void 0);e(a,"Não foi possível inativar o residente")}finally{T(null)}})(e,t):Rr({response:{data:{code:"access_denied"}}},"Apenas Administrador pode inativar residentes")};return Fe.jsxs("div",{className:"space-y-8",children:[Fe.jsx(yr,{label:"Cadastros",title:"Residentes",subtitle:"Gerencie os residentes da instituição, histórico clínico e dados pessoais.",children:(()=>{const{user:e}=Ya.getState(),t=e?.role;"superadmin"===t||("fisioterapia"===(e?.empresa?.tipoSistema||"casa-repouso")?["admin","enfermeiro","assistente_social","fisioterapeuta","medico"].includes(t):["admin","enfermeiro","assistente_social","medico"].includes(t));I.length})()}),Fe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[Fe.jsx(Nr,{icon:S,label:"Total",value:G.total,description:"Residentes cadastrados",color:"primary"}),Fe.jsx(Nr,{icon:J,label:"Novos",value:`+${G.novosMes}`,description:"Cadastrados este mês",color:"emerald"}),Fe.jsx(Nr,{icon:P,label:"Média",value:`${G.idadeMedia} anos`,description:"Idade média dos residentes",color:"purple"})]}),Fe.jsxs(Dr,{searchTerm:m,onSearchChange:x,placeholder:"Buscar por nome ou CPF...",children:[Fe.jsxs("select",{value:u,onChange:e=>b(e.target.value),className:"px-4 py-2 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none",children:[Fe.jsx("option",{value:"",children:"Todos os status"}),Fe.jsx("option",{value:"ativo",children:"Ativos"}),Fe.jsx("option",{value:"inativo",children:"Inativos"})]}),Fe.jsxs("button",{type:"button",onClick:()=>$(m),className:"btn btn-secondary flex items-center gap-2",children:[Fe.jsx(E,{size:18})," Atualizar"]})]}),Fe.jsx($r,{title:Fe.jsxs("button",{type:"button",onClick:()=>g(e=>!e),"aria-expanded":f,"aria-controls":"residentes-accordion",className:"w-full flex items-center justify-between gap-3 text-left",title:"Clique para abrir/fechar",children:[Fe.jsxs("span",{className:"flex items-center gap-3",children:[Fe.jsx("span",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100",children:"Residentes"}),Fe.jsx("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold bg-slate-100 text-slate-700 dark:bg-gray-800 dark:text-gray-200",children:I.length})]}),Fe.jsx(K,{size:18,className:"text-slate-500 transition-transform "+(f?"rotate-180":"rotate-0")})]}),children:f?d?Fe.jsx("div",{id:"residentes-accordion",className:"flex justify-center py-12",children:Fe.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):I.length>0?Fe.jsxs("div",{id:"residentes-accordion",children:[Fe.jsx(Or,{children:I.map(e=>Fe.jsxs(qr,{children:[Fe.jsxs("div",{className:"flex items-start justify-between",children:[Fe.jsxs("div",{className:"flex items-center gap-3",children:[Fe.jsx("div",{className:"w-10 h-10 rounded-full bg-primary-50 flex items-center justify-center text-primary-600 font-bold text-sm",children:e.nome.charAt(0)}),Fe.jsxs("div",{children:[Fe.jsx("p",{className:"font-medium text-slate-900 dark:text-gray-100",children:e.nome}),Fe.jsxs("p",{className:"text-[10px] text-slate-400",children:["Código: ",e.id||e._id]}),Fe.jsxs("p",{className:"text-xs text-slate-500 dark:text-gray-400",children:["CPF: ",e.cpf||"-"]}),Fe.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500 dark:text-gray-400 mt-1",children:[Fe.jsx(R,{size:12}),e.dataNascimento?new Date(e.dataNascimento).toLocaleDateString("pt-BR"):"-"]})]})]}),Fe.jsx("span",{className:"text-xs text-slate-500 dark:text-gray-400",children:"inativo"===e.status?"Inativo":"Ativo"})]}),Fe.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-3 text-xs text-slate-600 dark:text-gray-300",children:[Fe.jsxs("div",{className:"flex items-center gap-2",children:[Fe.jsx(M,{size:12}),Fe.jsx("span",{children:e.telefone||"-"})]}),Fe.jsxs("div",{className:"flex items-center gap-2",children:[Fe.jsx(h,{size:12}),Fe.jsx("span",{children:e.email||"-"})]}),e.endereco&&Fe.jsxs("div",{className:"flex items-center gap-2 col-span-2",children:[Fe.jsx(B,{size:12}),Fe.jsx("span",{className:"line-clamp-1",children:e.endereco})]})]}),Fe.jsxs("div",{className:"flex items-center justify-end gap-2 mt-3",children:[Fe.jsx("button",{onClick:()=>O(e),className:"group relative p-2.5 text-slate-500 hover:text-white hover:bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-lg transition-all duration-200 shadow-sm hover:shadow-md",title:"Ver Histórico","aria-label":"Ver histórico do paciente",children:Fe.jsx(C,{size:18})}),Fe.jsx("button",{onClick:()=>Z(e),className:"group relative p-2.5 text-slate-500 hover:text-white hover:bg-gradient-to-br from-primary-500 to-primary-600 rounded-lg transition-all duration-200 shadow-sm hover:shadow-md",title:"Editar paciente","aria-label":"Editar paciente",disabled:!X,children:Fe.jsx(Q,{size:18})}),Fe.jsx("button",{onClick:()=>te(e.id||e._id,e.nome),disabled:!ee||D===(e.id||e._id),className:"group relative p-2.5 text-slate-500 hover:text-white hover:bg-gradient-to-br from-red-500 to-red-600 rounded-lg transition-all duration-200 shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed",title:"Inativar residente","aria-label":"Inativar residente",children:D===(e.id||e._id)?Fe.jsx("div",{className:"animate-spin rounded-full h-[18px] w-[18px] border-2 border-white border-t-transparent"}):Fe.jsx(W,{size:18})})]})]},e.id||e._id))}),Fe.jsxs(Ir,{children:[Fe.jsx(Fr,{columns:["Nome","CPF","Nascimento","Telefone","Ações"]}),Fe.jsx(Br,{children:I.map(e=>Fe.jsxs(Mr,{children:[Fe.jsx(Ur,{children:Fe.jsxs("div",{className:"flex items-center gap-3",children:[Fe.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-50 flex items-center justify-center text-primary-600 font-bold text-xs",children:e.nome.charAt(0)}),Fe.jsxs("div",{className:"flex flex-col",children:[Fe.jsx("span",{className:"font-medium text-slate-900 dark:text-gray-100",children:e.nome}),Fe.jsxs("span",{className:"text-[11px] text-slate-400",children:["Código: ",e.id||e._id]})]})]})}),Fe.jsx(Ur,{className:"text-sm text-slate-600 dark:text-gray-300",children:e.cpf||"-"}),Fe.jsx(Ur,{className:"text-sm text-slate-600 dark:text-gray-300",children:e.dataNascimento?new Date(e.dataNascimento).toLocaleDateString("pt-BR"):"-"}),Fe.jsx(Ur,{className:"text-sm text-slate-600 dark:text-gray-300",children:e.telefone||"-"}),Fe.jsx(Ur,{className:"text-right",children:Fe.jsxs("div",{className:"flex items-center justify-end gap-2",children:[Fe.jsx(Lr,{onClick:()=>O(e),icon:C,tooltip:"Histórico",ariaLabel:"Ver histórico do paciente",variant:"emerald"}),Fe.jsx(Lr,{onClick:()=>Z(e),icon:Q,tooltip:"Editar",ariaLabel:"Editar paciente",variant:"primary",disabled:!X}),Fe.jsx(Lr,{onClick:()=>te(e.id||e._id,e.nome),icon:W,tooltip:"Inativar",ariaLabel:"Inativar residente",variant:"danger",disabled:!ee||D===(e.id||e._id),loading:D===(e.id||e._id)})]})})]},e.id||e._id))})]})]}):Fe.jsx(Tr,{title:"Nenhum residente encontrado",description:"Ajuste os filtros ou cadastre um novo residente.",actionLabel:"Novo residente",onAction:()=>v(!0)}):Fe.jsx("div",{className:"px-4 py-6 text-center text-sm text-slate-500 dark:text-gray-400",children:"Clique em “Residentes” para abrir a lista."})}),j&&Fe.jsx(Pr,{paciente:y,onClose:()=>{v(!1),N(null),$(m)}}),w&&Fe.jsx("div",{className:"fixed inset-0 bg-slate-900/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4",children:Fe.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[Fe.jsxs("div",{className:"p-6 border-b border-slate-100 flex justify-between items-center",children:[Fe.jsxs("div",{children:[Fe.jsxs("h3",{className:"text-xl font-bold text-slate-800 flex items-center gap-2",children:[Fe.jsx(C,{className:"text-primary-600"}),"Histórico de Prescrições"]}),Fe.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:[w.nome," - ",w.cpf]})]}),Fe.jsx("button",{onClick:()=>{k(null),z([])},className:"p-2 hover:bg-slate-100 rounded-full transition-colors",children:Fe.jsx(q,{size:20,className:"text-slate-400"})})]}),Fe.jsx("div",{className:"p-6 overflow-y-auto flex-1",children:A.length>0?Fe.jsx("div",{className:"space-y-4",children:A.map(e=>Fe.jsxs("div",{className:"p-4 rounded-2xl border border-slate-100 bg-slate-50 hover:bg-slate-100 transition",children:[Fe.jsxs("div",{className:"flex justify-between items-start mb-3",children:[Fe.jsxs("div",{children:[Fe.jsx("p",{className:"text-sm text-slate-500",children:new Date(e.createdAt).toLocaleString("pt-BR")}),Fe.jsxs("p",{className:"text-sm font-medium text-slate-700 mt-1",children:["Dr(a). ",e.medicoId?.nome||"Não informado",e.medicoId?.crm&&` - CRM ${e.medicoId.crm}`]})]}),Fe.jsxs("div",{className:"flex gap-2",children:[Fe.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-semibold "+("controlado"===e.tipo?"bg-orange-100 text-orange-700":"bg-primary-100 text-primary-700"),children:"controlado"===e.tipo?"Controlado":"Comum"}),Fe.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-semibold "+("ativa"===e.status?"bg-emerald-100 text-emerald-700":"bg-slate-100 text-slate-700"),children:e.status})]})]}),e.medicamentos&&e.medicamentos.length>0&&Fe.jsxs("div",{className:"mt-3",children:[Fe.jsx("p",{className:"text-xs font-semibold text-slate-500 uppercase mb-2",children:"Medicamentos"}),Fe.jsx("ul",{className:"space-y-1",children:e.medicamentos.map((e,t)=>Fe.jsxs("li",{className:"text-sm text-slate-700",children:["• ",e.nome,e.dosagem&&` - ${e.dosagem}`,e.via&&` (${e.via})`]},t))})]}),e.observacoes&&Fe.jsxs("div",{className:"mt-3 p-3 bg-white rounded-lg",children:[Fe.jsx("p",{className:"text-xs font-semibold text-slate-500 uppercase mb-1",children:"Observações"}),Fe.jsx("p",{className:"text-sm text-slate-600",children:e.observacoes})]})]},e._id))}):Fe.jsxs("div",{className:"text-center py-12",children:[Fe.jsx(C,{size:48,className:"mx-auto text-slate-300 mb-3"}),Fe.jsx("p",{className:"text-slate-500",children:"Nenhuma prescrição encontrada"}),Fe.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Este paciente ainda não possui prescrições registradas."})]})})]})}),Fe.jsxs("div",{className:"flex items-center justify-between gap-3",children:[Fe.jsxs("div",{className:"text-sm text-slate-600",children:["Página ",Fe.jsx("span",{className:"font-semibold",children:s})]}),Fe.jsxs("div",{className:"flex gap-2",children:[Fe.jsx("button",{className:"btn btn-secondary",disabled:s<=1,onClick:()=>a(e=>Math.max(1,e-1)),children:"Anterior"}),Fe.jsx("button",{className:"btn btn-secondary",disabled:s*l>=r&&r>0,onClick:()=>a(e=>e+1),children:"Próxima"})]})]})]})}const oi=async(e={},t={})=>{const s=Ba(e);return Ma(`/prescricoes${s}`,t)},di=async e=>Ua("/prescricoes",e),ci=async e=>Va(`/prescricoes/${e}/cancelar`);function mi(){const[e,t]=i.useState([]),[s,a]=i.useState(1),[r,n]=i.useState(0),[l,o]=i.useState(10),[d,c]=i.useState([]),[m,x]=i.useState(!0),[u,h]=i.useState(!1),[b,f]=i.useState(""),[g,j]=i.useState("comum"),[v,y]=i.useState([{nome:"",dosagem:"",frequencia:"",duracao:"",observacoes:""}]),[N,w]=i.useState("todas"),[S,k]=i.useState("todas"),[A,P]=i.useState(null),R=e=>{if(!e)return"Data não informada";try{const t=new Date(e);return isNaN(t.getTime())?"Data inválida":t.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"})}catch(t){return"Data inválida"}},z=e=>{if(!e)return"--:--";try{const t=new Date(e);return isNaN(t.getTime())?"--:--":t.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}catch(t){return"--:--"}};i.useEffect(()=>{D()},[s]);const D=async()=>{try{x(!0);const[e,a]=await Promise.all([oi({page:s,pageSize:l}),Sr()]);if(Array.isArray(e))t(e),n(e.length);else{const s=Array.isArray(e.items)?e.items:e.prescricoes||[];t(s),n(Number(e.total)||0),o(Number(e.pageSize)||10)}const r=Array.isArray(a)?a:a.pacientes||[];c(r)}catch(e){Rr(e,rr("load","dados"))}finally{x(!1)}},T=(e,t,s)=>{const a=[...v];a[e][t]=s,y(a)},_=async e=>{if(window.confirm("Tem certeza que deseja cancelar esta prescrição?"))try{await ci(e),p.success("Prescrição cancelada"),P({type:"warning",message:"Prescrição foi cancelada."}),D()}catch(t){Rr(t,rr("cancel","prescrição"))}},L=e.filter(e=>("todas"===N||e.status===N)&&("todas"===S||e.tipo===S)),$={total:e.length,ativas:e.filter(e=>"ativa"===e.status).length,controladas:e.filter(e=>"controlado"===e.tipo).length,hoje:e.filter(e=>{const t=new Date(e.createdAt),s=new Date;return t.getDate()===s.getDate()&&t.getMonth()===s.getMonth()&&t.getFullYear()===s.getFullYear()}).length};return Fe.jsxs("div",{className:"space-y-8",children:[Fe.jsx(yr,{label:"Operação Clínica",title:"Prescrições",subtitle:"Controle total das prescrições emitidas, status em tempo real e histórico completo.",children:Fe.jsxs("div",{className:"flex flex-col sm:flex-row w-full lg:w-auto gap-3",children:[Fe.jsxs("button",{onClick:()=>h(!0),className:"btn btn-primary flex items-center justify-center gap-2 shadow-lg shadow-primary-500/20",children:[Fe.jsx(V,{size:18})," Nova Prescrição"]}),Fe.jsxs("button",{type:"button",onClick:()=>{try{const e=new Date,t="\n        body { font-family: Arial, sans-serif; padding: 20px; }\n        h1 { color: #2563eb; border-bottom: 2px solid #2563eb; padding-bottom: 10px; }\n        .meta { color: #6b7280; font-size: 12px; margin-top: 6px; }\n        table { width: 100%; border-collapse: collapse; margin-top: 16px; }\n        th, td { padding: 10px 12px; text-align: left; border-bottom: 1px solid #e5e7eb; vertical-align: top; }\n        th { background: #f9fafb; font-weight: 600; color: #374151; }\n        .badge { display: inline-block; padding: 2px 8px; border-radius: 999px; font-size: 12px; font-weight: 600; }\n        .ativa { background: #d1fae5; color: #065f46; }\n        .cancelada { background: #fee2e2; color: #991b1b; }\n        @media print { body { padding: 0; } }\n      ",s=L.map(e=>{const t=e.pacienteNome||e.pacienteId?.nome||e.paciente?.nome||"-",s=e.createdAt||e.dataEmissao||e.data||null,a=s?new Date(s):null,r=a&&!Number.isNaN(a.getTime())?`${a.toLocaleDateString("pt-BR")} ${a.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}`:"-",i="ativa"===(e.status||"").toLowerCase()?"ativa":"cancelada",n=Array.isArray(e.medicamentos)?e.medicamentos.length:0;return`\n            <tr>\n              <td>${Vr(r)}</td>\n              <td>${Vr(t)}</td>\n              <td>${Vr(e.tipo||"-")}</td>\n              <td>${Vr(n)}</td>\n              <td><span class="badge ${i}">${Vr(e.status||"-")}</span></td>\n            </tr>\n          `}).join("");Gr({title:"Relatório - Prescrições",bodyHtml:`\n        <h1>Relatório - Prescrições</h1>\n        <div class="meta">Gerado em: ${Vr(e.toLocaleDateString("pt-BR"))} às ${Vr(e.toLocaleTimeString("pt-BR"))}</div>\n        <div class="meta">Registros: ${Vr(L.length)}</div>\n        <table>\n          <thead>\n            <tr>\n              <th>Emissão</th>\n              <th>Paciente</th>\n              <th>Tipo</th>\n              <th>Medicamentos</th>\n              <th>Status</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${s}\n          </tbody>\n        </table>\n      `,styles:t}),p.success("Abrindo visualização para impressão/PDF")}catch(e){p.error("Erro ao gerar PDF")}},disabled:0===L.length,className:"btn btn-secondary flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",title:"Exportar para PDF",children:[Fe.jsx(G,{size:18})," Exportar PDF"]}),Fe.jsxs("button",{type:"button",onClick:D,className:"btn btn-secondary flex items-center justify-center gap-2",children:[Fe.jsx(E,{size:18})," Atualizar"]})]})}),Fe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[Fe.jsx(Nr,{icon:C,label:"Total",value:$.total,description:"Prescrições emitidas",color:"primary"}),Fe.jsx(Nr,{icon:J,label:"Ativas",value:$.ativas,description:"Em vigência",color:"emerald"}),Fe.jsx(Nr,{icon:Y,label:"Controladas",value:$.controladas,description:"Medicamentos controlados",color:"orange"}),Fe.jsx(Nr,{icon:V,label:"Hoje",value:`+${$.hoje}`,description:"Emitidas hoje",color:"purple"})]}),Fe.jsx("div",{className:"card p-4",children:Fe.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[Fe.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500",children:[Fe.jsx(X,{size:16}),Fe.jsx("span",{className:"font-medium",children:"Filtros:"})]}),Fe.jsxs("div",{className:"flex flex-wrap gap-3 w-full md:w-auto",children:[Fe.jsxs("select",{value:N,onChange:e=>w(e.target.value),className:"px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl text-sm text-slate-600 focus:outline-none focus:border-primary-500",children:[Fe.jsx("option",{value:"todas",children:"Todos os Status"}),Fe.jsx("option",{value:"ativa",children:"Ativas"}),Fe.jsx("option",{value:"cancelada",children:"Canceladas"})]}),Fe.jsxs("select",{value:S,onChange:e=>k(e.target.value),className:"px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl text-sm text-slate-600 focus:outline-none focus:border-primary-500",children:[Fe.jsx("option",{value:"todas",children:"Todos os Tipos"}),Fe.jsx("option",{value:"comum",children:"Comum"}),Fe.jsx("option",{value:"controlado",children:"Controlado"})]})]})]})}),A&&Fe.jsxs("div",{className:"card flex items-center gap-3 border "+("success"===A.type?"border-emerald-200 bg-emerald-50":"border-amber-200 bg-amber-50"),children:[Fe.jsx(J,{className:"text-emerald-500",size:20}),Fe.jsx("p",{className:"text-sm text-slate-700",children:A.message}),Fe.jsx("button",{className:"ml-auto text-xs text-slate-500",onClick:()=>P(null),children:"Fechar"})]}),Fe.jsx($r,{title:"Prescrições",children:m?Fe.jsx("div",{className:"flex justify-center py-12",children:Fe.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):L.length>0?Fe.jsxs(Fe.Fragment,{children:[Fe.jsx(Or,{children:L.map(e=>Fe.jsxs(qr,{children:[Fe.jsxs("div",{className:"flex items-start justify-between",children:[Fe.jsxs("div",{className:"flex items-center gap-3",children:[Fe.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-50 flex items-center justify-center text-primary-600 font-bold text-xs",children:e.pacienteNome?e.pacienteNome.charAt(0).toUpperCase():"P"}),Fe.jsxs("div",{children:[Fe.jsx("p",{className:"font-medium text-slate-900 dark:text-gray-100",children:e.pacienteNome||"Paciente não identificado"}),Fe.jsxs("p",{className:"text-[10px] text-slate-400",children:["Código: ",e.id||e._id]}),Fe.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-slate-600 dark:text-gray-300",children:[Fe.jsx("span",{children:R(e.createdAt)}),Fe.jsx("span",{className:"text-slate-400",children:z(e.createdAt)})]})]})]}),Fe.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-medium "+("controlado"===e.tipo?"bg-orange-100 text-orange-700":"bg-blue-100 text-blue-700"),children:"controlado"===e.tipo?"Controlado":"Comum"})]}),Fe.jsx("div",{className:"mt-3 text-sm text-slate-700 dark:text-gray-200",children:e.medicamentos&&e.medicamentos.length>0?Fe.jsxs("div",{children:[Fe.jsx("span",{className:"font-medium",children:e.medicamentos[0].nome}),e.medicamentos.length>1&&Fe.jsxs("span",{className:"text-slate-400 text-xs ml-1",children:["+",e.medicamentos.length-1," ",2===e.medicamentos.length?"outro":"outros"]})]}):Fe.jsx("span",{className:"text-slate-400 italic",children:"Sem medicamentos"})}),Fe.jsxs("div",{className:"flex items-center justify-between mt-3",children:[Fe.jsx("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium "+("ativa"===e.status?"bg-emerald-50 text-emerald-700 border border-emerald-100":"bg-red-50 text-red-700 border border-red-100"),children:"ativa"===e.status?Fe.jsxs(Fe.Fragment,{children:[Fe.jsx(J,{size:12})," Ativa"]}):Fe.jsxs(Fe.Fragment,{children:[Fe.jsx(q,{size:12})," Cancelada"]})}),"ativa"===e.status&&Fe.jsx("button",{onClick:()=>_(e.id||e._id),className:"text-red-600 hover:text-red-800 text-xs font-semibold hover:underline",children:"Cancelar"})]})]},e.id||e._id))}),Fe.jsxs(Ir,{children:[Fe.jsx(Fr,{columns:["Paciente","Data Emissão","Tipo","Medicamentos","Status","Ações"]}),Fe.jsx(Br,{children:L.map(e=>Fe.jsxs(Mr,{children:[Fe.jsx(Ur,{children:Fe.jsxs("div",{className:"flex items-center gap-3",children:[Fe.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-50 flex items-center justify-center text-primary-600 font-bold text-xs",children:e.pacienteNome?e.pacienteNome.charAt(0).toUpperCase():"P"}),Fe.jsxs("div",{className:"flex flex-col",children:[Fe.jsx("span",{className:"font-medium text-slate-900 dark:text-gray-100",children:e.pacienteNome||"Paciente não identificado"}),Fe.jsxs("span",{className:"text-[11px] text-slate-400",children:["Código: ",e.id||e._id]})]})]})}),Fe.jsxs(Ur,{className:"text-sm text-slate-600 dark:text-gray-300",children:[R(e.createdAt),Fe.jsx("span",{className:"text-xs text-slate-400 block",children:z(e.createdAt)})]}),Fe.jsx(Ur,{children:Fe.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-medium "+("controlado"===e.tipo?"bg-orange-100 text-orange-700":"bg-blue-100 text-blue-700"),children:"controlado"===e.tipo?"Controlado":"Comum"})}),Fe.jsx(Ur,{className:"text-sm text-slate-600 dark:text-gray-300",children:e.medicamentos&&e.medicamentos.length>0?Fe.jsxs("div",{children:[Fe.jsx("span",{className:"font-medium",children:e.medicamentos[0].nome}),e.medicamentos.length>1&&Fe.jsxs("span",{className:"text-slate-400 text-xs ml-1",children:["+",e.medicamentos.length-1," outros"]})]}):Fe.jsx("span",{className:"text-slate-400",children:"-"})}),Fe.jsx(Ur,{children:Fe.jsx("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium "+("ativa"===e.status?"bg-emerald-50 text-emerald-700 border border-emerald-100":"bg-red-50 text-red-700 border border-red-100"),children:"ativa"===e.status?Fe.jsxs(Fe.Fragment,{children:[Fe.jsx(J,{size:12})," Ativa"]}):Fe.jsxs(Fe.Fragment,{children:[Fe.jsx(q,{size:12})," Cancelada"]})})}),Fe.jsx(Ur,{className:"text-right",children:"ativa"===e.status&&Fe.jsx("button",{onClick:()=>_(e.id||e._id),className:"text-red-600 hover:text-red-800 text-xs font-semibold hover:underline",children:"Cancelar"})})]},e.id||e._id))})]})]}):Fe.jsx(Tr,{icon:Y,title:"Nenhuma prescrição encontrada",description:"Comece emitindo uma nova prescrição.",actionLabel:"Nova Prescrição",onAction:()=>h(!0)})}),u&&Fe.jsx("div",{className:"fixed inset-0 bg-slate-900/70 flex items-center justify-center p-4 z-50",children:Fe.jsxs("div",{className:"bg-white rounded-3xl max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-2xl",children:[Fe.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-slate-100",children:[Fe.jsxs("div",{children:[Fe.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:"Cadastro"}),Fe.jsx("h2",{className:"text-2xl font-bold",children:"Nova Prescrição"})]}),Fe.jsx("button",{onClick:()=>h(!1),className:"p-2 hover:bg-slate-50 rounded-2xl",children:Fe.jsx(q,{size:24})})]}),Fe.jsxs("form",{onSubmit:async e=>{e.preventDefault();try{const e=JSON.parse(localStorage.getItem("user")||"{}"),t=e?.empresaId;await di({pacienteId:b,empresaId:t,tipo:g,medicamentos:v.filter(e=>""!==e.nome.trim())}),p.success(ar("create","Prescrição",{gender:"f"})),h(!1),f(""),j("comum"),y([{nome:"",dosagem:"",frequencia:"",duracao:"",observacoes:""}]),P({type:"success",message:"Prescrição cadastrada com sucesso."}),D()}catch(t){Rr(t,rr("create","prescrição"))}},className:"p-6 space-y-6",children:[Fe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium mb-2",children:"Paciente *"}),Fe.jsxs("select",{value:b,onChange:e=>f(e.target.value),className:"input",required:!0,children:[Fe.jsx("option",{value:"",children:"Selecione um paciente"}),d.map(e=>Fe.jsx("option",{value:e.id,children:e.nome},e.id))]})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium mb-2",children:"Tipo *"}),Fe.jsxs("select",{value:g,onChange:e=>j(e.target.value),className:"input",required:!0,children:[Fe.jsx("option",{value:"comum",children:"Comum"}),Fe.jsx("option",{value:"controlado",children:"Controlado"})]})]})]}),Fe.jsxs("div",{children:[Fe.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between mb-4",children:[Fe.jsxs("div",{children:[Fe.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:"Sessão"}),Fe.jsx("h3",{className:"text-lg font-semibold",children:"Medicamentos"})]}),Fe.jsxs("button",{type:"button",onClick:()=>{y([...v,{nome:"",dosagem:"",frequencia:"",duracao:"",observacoes:""}])},className:"btn btn-secondary flex items-center gap-2",children:[Fe.jsx(V,{size:18}),"Adicionar"]})]}),Fe.jsx("div",{className:"space-y-4",children:v.map((e,t)=>Fe.jsxs("div",{className:"p-4 border border-slate-100 rounded-2xl",children:[Fe.jsxs("div",{className:"flex justify-between items-start mb-3",children:[Fe.jsxs("h4",{className:"font-medium",children:["Medicamento ",t+1]}),v.length>1&&Fe.jsx("button",{type:"button",onClick:()=>(e=>{y(v.filter((t,s)=>s!==e))})(t),className:"text-red-600 hover:bg-red-50 p-1 rounded-xl",children:Fe.jsx(q,{size:18})})]}),Fe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[Fe.jsxs("div",{className:"md:col-span-2",children:[Fe.jsx("label",{className:"block text-sm font-medium mb-1",children:"Nome *"}),Fe.jsx("input",{type:"text",value:e.nome,onChange:e=>T(t,"nome",e.target.value),className:"input",required:!0})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium mb-1",children:"Dosagem *"}),Fe.jsx("input",{type:"text",value:e.dosagem,onChange:e=>T(t,"dosagem",e.target.value),className:"input",placeholder:"Ex: 500mg",required:!0})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium mb-1",children:"Frequência *"}),Fe.jsx("input",{type:"text",value:e.frequencia,onChange:e=>T(t,"frequencia",e.target.value),className:"input",placeholder:"Ex: 8/8h",required:!0})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium mb-1",children:"Duração *"}),Fe.jsx("input",{type:"text",value:e.duracao,onChange:e=>T(t,"duracao",e.target.value),className:"input",placeholder:"Ex: 7 dias",required:!0})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium mb-1",children:"Observações"}),Fe.jsx("input",{type:"text",value:e.observacoes,onChange:e=>T(t,"observacoes",e.target.value),className:"input"})]})]})]},t))})]}),Fe.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t",children:[Fe.jsx("button",{type:"button",onClick:()=>h(!1),className:"btn btn-secondary",children:"Cancelar"}),Fe.jsx("button",{type:"submit",className:"btn btn-primary",children:"Criar Prescrição"})]})]})]})}),Fe.jsxs("div",{className:"flex items-center justify-between gap-3",children:[Fe.jsxs("div",{className:"text-sm text-slate-600",children:["Página ",Fe.jsx("span",{className:"font-semibold",children:s})]}),Fe.jsxs("div",{className:"flex gap-2",children:[Fe.jsx("button",{className:"btn btn-secondary",disabled:s<=1,onClick:()=>a(e=>Math.max(1,e-1)),children:"Anterior"}),Fe.jsx("button",{className:"btn btn-secondary",disabled:s*l>=r&&r>0,onClick:()=>a(e=>e+1),children:"Próxima"})]})]})]})}function xi(){const{user:e}=Ya(),[t,s]=i.useState([]),[a,r]=i.useState(!0),[n,l]=i.useState(""),[o,d]=i.useState("todos"),[c,m]=i.useState(1),[x,u]=i.useState(0),[h,b]=i.useState(10);i.useEffect(()=>{f()},[c,e?.role]),i.useEffect(()=>_a(()=>{m(1),f()}),[e?.role]);const f=async()=>{try{r(!0);const t=za(e);let a=[],i=[];if(t){p.loading("Carregando dados de todas as empresas...",{id:"censo-mp-load-all"});const e=await La(),t=(Array.isArray(e)?e:[]).map(e=>e.id).filter(Boolean);if(0===t.length)return u(0),s([]),void p.dismiss("censo-mp-load-all");const r=await Promise.all(t.map(async e=>{const t=Da(e),[s,a]=await Promise.all([Sr("",t),oi({},t)]),r=Array.isArray(s)?s:s?.pacientes||s?.items||[],i=Array.isArray(a)?a:a?.prescricoes||a?.items||[];return{empresaId:e,pacientes:Array.isArray(r)?r:[],prescricoes:Array.isArray(i)?i:[]}}));a=r.flatMap(e=>(e.pacientes||[]).map(t=>({...t,__empresaId:e.empresaId}))),i=r.flatMap(e=>(e.prescricoes||[]).map(t=>({...t,__empresaId:e.empresaId}))),p.dismiss("censo-mp-load-all")}else{const[e,t]=await Promise.all([Sr(),oi()]);a=Array.isArray(e)?e:e?.pacientes||e?.items||[],i=Array.isArray(t)?t:t?.prescricoes||t?.items||[],a=Array.isArray(a)?a:[],i=Array.isArray(i)?i:[]}const n=a.map(e=>{const t=e.id||e._id,s=i.filter(e=>(e.pacienteId===t||e.pacienteId?._id===t)&&"ativa"===e.status);return{...e,id:t,hasPrescription:s.length>0,prescriptionCount:s.length,prescriptions:s}}).sort((e,t)=>new Date(t.updatedAt||0)-new Date(e.updatedAt||0));u(n.length);const l=(c-1)*h;s(n.slice(l,l+h))}catch(t){p.dismiss("censo-mp-load-all");const{handleApiError:e}=await Ea(async()=>{const{handleApiError:e}=await Promise.resolve().then(()=>zr);return{handleApiError:e}},void 0);e(t,rr("load","dados do censo"))}finally{r(!1)}},g=t.filter(e=>{const t=e.nome.toLowerCase().includes(n.toLowerCase())||e.cpf&&e.cpf.includes(n);return"todos"===o?t:"com_prescricao"===o?t&&e.hasPrescription:"sem_prescricao"===o?t&&!e.hasPrescription:t}),j={total:t.length,comPrescricao:t.filter(e=>e.hasPrescription).length,semPrescricao:t.filter(e=>!e.hasPrescription).length};return Fe.jsxs("div",{className:"space-y-8",children:[Fe.jsx(yr,{label:"Controle",title:"Censo M.P.",subtitle:"Mapa de Prescrições: Acompanhe quais residentes possuem prescrições ativas.",children:Fe.jsxs("div",{className:"flex flex-col sm:flex-row w-full lg:w-auto gap-3",children:[Fe.jsxs("button",{type:"button",onClick:()=>{try{const e=new Date,t="\n        body { font-family: Arial, sans-serif; padding: 20px; }\n        h1 { color: #2563eb; border-bottom: 2px solid #2563eb; padding-bottom: 10px; }\n        .meta { color: #6b7280; font-size: 12px; margin-top: 6px; }\n        table { width: 100%; border-collapse: collapse; margin-top: 16px; }\n        th, td { padding: 10px 12px; text-align: left; border-bottom: 1px solid #e5e7eb; vertical-align: top; }\n        th { background: #f9fafb; font-weight: 600; color: #374151; }\n        .badge { display: inline-block; padding: 2px 8px; border-radius: 999px; font-size: 12px; font-weight: 700; }\n        .coberto { background: #d1fae5; color: #065f46; }\n        .pendente { background: #fee2e2; color: #991b1b; }\n        @media print { body { padding: 0; } }\n      ",s=g.map(e=>{const t=e.hasPrescription?"coberto":"pendente",s=e.hasPrescription?"Coberto":"Pendente",a=(e.prescriptions||[]).slice(0,3).map(e=>e.medicamentos?.[0]?.nome).filter(Boolean).join(", ");return`\n            <tr>\n              <td>${Vr(e.nome||"-")}</td>\n              <td>${Vr(e.cpf||"-")}</td>\n              <td><span class="badge ${t}">${Vr(s)}</span></td>\n              <td>${Vr(e.prescriptionCount||0)}</td>\n              <td>${Vr(a||(e.hasPrescription?"Prescrição ativa":"-"))}</td>\n            </tr>\n          `}).join("");Gr({title:"Relatório - Censo MP",bodyHtml:`\n        <h1>Relatório - Censo M.P.</h1>\n        <div class="meta">Gerado em: ${Vr(e.toLocaleDateString("pt-BR"))} às ${Vr(e.toLocaleTimeString("pt-BR"))}</div>\n        <div class="meta">Registros: ${Vr(g.length)}</div>\n        <table>\n          <thead>\n            <tr>\n              <th>Residente</th>\n              <th>CPF</th>\n              <th>Status</th>\n              <th>Prescrições ativas</th>\n              <th>Detalhes</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${s}\n          </tbody>\n        </table>\n      `,styles:t}),p.success("Abrindo visualização para impressão/PDF")}catch(e){p.error("Erro ao gerar PDF")}},disabled:0===g.length,className:"btn btn-secondary flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",title:"Exportar para PDF",children:[Fe.jsx(G,{size:18})," Exportar PDF"]}),Fe.jsxs("button",{type:"button",onClick:f,className:"btn btn-secondary flex items-center justify-center gap-2",children:[Fe.jsx(E,{size:18})," Atualizar"]})]})}),Fe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[Fe.jsx(Nr,{icon:S,label:"Total",value:j.total,description:"Residentes cadastrados",color:"primary"}),Fe.jsx(Nr,{icon:J,label:"Cobertos",value:j.comPrescricao,description:"Com prescrição ativa",color:"emerald"}),Fe.jsx(Nr,{icon:F,label:"Pendentes",value:j.semPrescricao,description:"Sem prescrição ativa",color:"red"})]}),Fe.jsx(Dr,{searchTerm:n,onSearchChange:l,placeholder:"Buscar residente...",filters:[{label:"Todos",value:"todos"},{label:"Com Prescrição",value:"com_prescricao"},{label:"Sem Prescrição",value:"sem_prescricao"}],activeFilter:o,onFilterChange:d}),Fe.jsx($r,{title:"Residentes",children:a?Fe.jsx("div",{className:"flex justify-center py-12",children:Fe.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):g.length>0?Fe.jsxs(Fe.Fragment,{children:[Fe.jsx(Or,{children:g.map(e=>Fe.jsxs(qr,{children:[Fe.jsxs("div",{className:"flex items-start justify-between",children:[Fe.jsxs("div",{className:"flex items-center gap-3",children:[Fe.jsx("div",{className:"w-10 h-10 rounded-full bg-primary-50 flex items-center justify-center text-primary-600 font-bold text-sm",children:e.nome.charAt(0)}),Fe.jsxs("div",{children:[Fe.jsx("p",{className:"font-medium text-slate-900 dark:text-gray-100",children:e.nome}),Fe.jsxs("p",{className:"text-[10px] text-slate-400",children:["Código: ",e.id||e._id]}),Fe.jsxs("p",{className:"text-xs text-slate-500 dark:text-gray-400",children:["CPF: ",e.cpf||"N/A"]})]})]}),e.hasPrescription?Fe.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium bg-emerald-50 text-emerald-700 border border-emerald-100",children:[Fe.jsx(J,{size:12})," Coberto"]}):Fe.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium bg-red-50 text-red-700 border border-red-100",children:[Fe.jsx(F,{size:12})," Pendente"]})]}),Fe.jsxs("div",{className:"mt-3",children:[Fe.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[Fe.jsx(Z,{size:16,className:"text-slate-400"}),Fe.jsxs("span",{className:"text-sm font-medium text-slate-700 dark:text-gray-200",children:[e.prescriptionCount," prescrições"]})]}),e.hasPrescription?Fe.jsx("div",{className:"flex flex-wrap gap-1",children:e.prescriptions.map(e=>Fe.jsxs("span",{className:"text-xs text-slate-500 dark:text-gray-300 bg-slate-100 dark:bg-gray-800 px-2 py-1 rounded",children:[e.medicamentos?.[0]?.nome,e.medicamentos?.length>1&&" +"+(e.medicamentos.length-1)]},e.id))}):Fe.jsx("span",{className:"text-xs text-slate-400 dark:text-gray-500 italic",children:"Nenhuma prescrição ativa"})]})]},e.id||e._id))}),Fe.jsxs(Ir,{children:[Fe.jsx(Fr,{columns:["Residente","Status","Prescrições Ativas","Detalhes"]}),Fe.jsx(Br,{children:g.map(e=>Fe.jsxs(Mr,{children:[Fe.jsx(Ur,{children:Fe.jsxs("div",{className:"flex items-center gap-3",children:[Fe.jsx("div",{className:"w-10 h-10 rounded-full bg-primary-50 flex items-center justify-center text-primary-600 font-bold text-sm",children:e.nome.charAt(0)}),Fe.jsxs("div",{children:[Fe.jsx("p",{className:"font-medium text-slate-900 dark:text-gray-100",children:e.nome}),Fe.jsxs("p",{className:"text-[11px] text-slate-400",children:["Código: ",e.id||e._id]}),Fe.jsxs("p",{className:"text-xs text-slate-500 dark:text-gray-400",children:["CPF: ",e.cpf||"N/A"]})]})]})}),Fe.jsx(Ur,{children:e.hasPrescription?Fe.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium bg-emerald-50 text-emerald-700 border border-emerald-100",children:[Fe.jsx(J,{size:14})," Coberto"]}):Fe.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium bg-red-50 text-red-700 border border-red-100",children:[Fe.jsx(F,{size:14})," Pendente"]})}),Fe.jsx(Ur,{children:Fe.jsxs("div",{className:"flex items-center gap-2",children:[Fe.jsx(Z,{size:16,className:"text-slate-400"}),Fe.jsxs("span",{className:"text-sm font-medium text-slate-700 dark:text-gray-200",children:[e.prescriptionCount," prescrições"]})]})}),Fe.jsx(Ur,{children:e.hasPrescription?Fe.jsx("div",{className:"flex flex-col gap-1",children:e.prescriptions.map(e=>Fe.jsxs("span",{className:"text-xs text-slate-500 dark:text-gray-300 bg-slate-100 dark:bg-gray-800 px-2 py-1 rounded inline-block w-fit",children:[e.medicamentos?.[0]?.nome,e.medicamentos?.length>1&&" +"+(e.medicamentos.length-1)]},e.id))}):Fe.jsx("span",{className:"text-xs text-slate-400 dark:text-gray-500 italic",children:"Nenhuma prescrição ativa"})})]},e.id||e._id))})]})]}):Fe.jsx("div",{className:"p-8",children:Fe.jsx(Tr,{icon:S,title:"Nenhum residente encontrado",description:"Tente ajustar os filtros de busca."})})}),Fe.jsxs("div",{className:"flex items-center justify-between gap-3 mt-4",children:[Fe.jsxs("div",{className:"text-sm text-slate-600",children:["Página ",Fe.jsx("span",{className:"font-semibold",children:c})]}),Fe.jsxs("div",{className:"flex gap-2",children:[Fe.jsx("button",{className:"btn btn-secondary",disabled:c<=1,onClick:()=>m(e=>Math.max(1,e-1)),children:"Anterior"}),Fe.jsx("button",{className:"btn btn-secondary",disabled:c*h>=x&&x>0,onClick:()=>m(e=>e+1),children:"Próxima"})]})]})]})}const pi=async e=>Ma("/usuarios",{params:e}),ui=async e=>Ua("/usuarios",e),hi=async(e,t)=>Va(`/usuarios/${e}`,t),bi=async(e,t,s)=>Va(`/usuarios/${e}/senha`,{senhaAtual:t,novaSenha:s}),fi=async e=>Ga(`/usuarios/${e}`),gi=async()=>Ma("/usuarios/me/summary"),ji=async e=>Va("/usuarios/me",e);function vi({usuario:e,onClose:t}){const[s,a]=i.useState({nome:"",email:"",senha:"",telefone:"",especialidade:"",crm:"",crmUf:"",role:"atendente",permissoes:[],ativo:!0}),[r,n]=i.useState(!1);i.useEffect(()=>{e&&a({nome:e.nome||"",email:e.email||"",senha:"",telefone:e.telefone||"",especialidade:e.especialidade||"",crm:e.crm||"",crmUf:e.crmUf||"",role:e.role||"atendente",permissoes:e.permissoes||[],ativo:void 0===e.ativo||e.ativo})},[e]);return Fe.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:Fe.jsxs("div",{className:"bg-white rounded-3xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[Fe.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200",children:[Fe.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:e?"Editar Usuário":"Novo Usuário"}),Fe.jsx("button",{onClick:t,className:"p-2 hover:bg-slate-100 rounded-xl transition-colors",children:Fe.jsx(q,{size:24})})]}),Fe.jsxs("form",{onSubmit:async a=>{a.preventDefault(),n(!0);try{if(e?.id){const t={...s};t.senha||delete t.senha,await hi(e.id,t),p.success(ar("update","Usuário",{suffix:"!"}))}else{if(!s.senha||s.senha.length<6)return p.error(ir("minPassword")),void n(!1);await ui(s),p.success(ar("create","Usuário",{suffix:"!"}))}t()}catch(r){const{handleApiError:e}=await Ea(async()=>{const{handleApiError:e}=await Promise.resolve().then(()=>zr);return{handleApiError:e}},void 0);e(r,rr("save","usuário"))}finally{n(!1)}},className:"p-6 space-y-4",children:[Fe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Fe.jsxs("div",{className:"md:col-span-2",children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Nome Completo *"}),Fe.jsx("input",{type:"text",required:!0,className:"input",value:s.nome,onChange:e=>a({...s,nome:e.target.value})})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"E-mail *"}),Fe.jsx("input",{type:"email",required:!0,className:"input",value:s.email,onChange:e=>a({...s,email:e.target.value})})]}),Fe.jsxs("div",{children:[Fe.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Senha ",!e&&"*"]}),Fe.jsx("input",{type:"password",className:"input",placeholder:e?"Deixe em branco para manter":"Mínimo 6 caracteres",minLength:"6",value:s.senha,onChange:e=>a({...s,senha:e.target.value}),required:!e})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Telefone"}),Fe.jsx("input",{type:"tel",className:"input",value:s.telefone,onChange:e=>a({...s,telefone:e.target.value})})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Especialidade"}),Fe.jsxs("select",{className:"input",value:s.especialidade,onChange:e=>a({...s,especialidade:e.target.value}),children:[Fe.jsx("option",{value:"",children:"Selecione uma especialidade"}),Fe.jsx("option",{value:"Médico",children:"Médico"}),Fe.jsx("option",{value:"Enfermeiro",children:"Enfermeiro"}),Fe.jsx("option",{value:"Técnico de Enfermagem",children:"Técnico de Enfermagem"}),Fe.jsx("option",{value:"Fisioterapeuta",children:"Fisioterapeuta"}),Fe.jsx("option",{value:"Nutricionista",children:"Nutricionista"}),Fe.jsx("option",{value:"Assistente Social",children:"Assistente Social"}),Fe.jsx("option",{value:"Administrador",children:"Administrador"}),Fe.jsx("option",{value:"Auxiliar Administrativo",children:"Auxiliar Administrativo"}),Fe.jsx("option",{value:"Outro",children:"Outro"})]})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"CRM"}),Fe.jsx("input",{type:"text",className:"input",value:s.crm,onChange:e=>a({...s,crm:e.target.value})})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"UF do CRM"}),Fe.jsx("input",{type:"text",className:"input",maxLength:"2",placeholder:"Ex: BA",value:s.crmUf,onChange:e=>a({...s,crmUf:e.target.value.toUpperCase()})})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Função *"}),Fe.jsxs("select",{required:!0,className:"input",value:s.role,onChange:e=>a({...s,role:e.target.value}),children:[Fe.jsx("option",{value:"enfermeiro",children:"Enfermeiro"}),Fe.jsx("option",{value:"tecnico_enfermagem",children:"Técnico de Enfermagem"}),Fe.jsx("option",{value:"fisioterapeuta",children:"Fisioterapeuta"}),Fe.jsx("option",{value:"nutricionista",children:"Nutricionista"}),Fe.jsx("option",{value:"assistente_social",children:"Assistente Social"}),Fe.jsx("option",{value:"auxiliar_administrativo",children:"Auxiliar Administrativo"}),Fe.jsx("option",{value:"atendente",children:"Atendente"}),Fe.jsx("option",{value:"admin",children:"Administrador"}),Fe.jsx("option",{value:"superadmin",children:"Super Administrador"})]})]}),Fe.jsxs("div",{className:"md:col-span-2",children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Permissões de Acesso"}),Fe.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3 p-4 bg-slate-50 rounded-2xl border border-slate-200",children:[{id:"dashboard",label:"Dashboard"},{id:"agenda",label:"Agenda"},{id:"cronograma",label:"Cronograma"},{id:"prescricoes",label:"Prescrições"},{id:"pacientes",label:"Pacientes/Residentes"},{id:"estoque",label:"Estoque"},{id:"evolucao",label:"Evolução"},{id:"financeiro",label:"Financeiro"},{id:"usuarios",label:"Usuários"},{id:"empresas",label:"Empresas"},{id:"configuracoes",label:"Configurações"},{id:"relatorios",label:"Relatórios"}].map(e=>Fe.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-slate-100 p-2 rounded-lg transition-colors",children:[Fe.jsx("input",{type:"checkbox",className:"rounded text-primary-600 focus:ring-primary-500",checked:s.permissoes.includes(e.id),onChange:()=>{return t=e.id,void a(e=>{const s=e.permissoes.includes(t)?e.permissoes.filter(e=>e!==t):[...e.permissoes,t];return{...e,permissoes:s}});var t}}),Fe.jsx("span",{className:"text-sm text-slate-700",children:e.label})]},e.id))}),Fe.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Selecione os módulos que este usuário poderá acessar."})]}),Fe.jsx("div",{className:"md:col-span-2",children:Fe.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[Fe.jsx("input",{type:"checkbox",className:"rounded text-primary-600",checked:s.ativo,onChange:e=>a({...s,ativo:e.target.checked})}),Fe.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Usuário ativo"})]})})]}),Fe.jsxs("div",{className:"flex gap-3 pt-4 border-t border-slate-200",children:[Fe.jsx("button",{type:"button",onClick:t,className:"btn btn-secondary flex-1",disabled:r,children:"Cancelar"}),Fe.jsx("button",{type:"submit",className:"btn btn-primary flex-1",disabled:r,children:r?"Salvando...":"Salvar"})]})]})]})})}function yi({title:e="Acesso Negado",message:t="Você não tem permissão para acessar esta página.",messageClassName:s="text-slate-600"}){return Fe.jsxs("div",{className:"card text-center py-12",children:[Fe.jsx(ee,{size:48,className:"mx-auto text-red-500 mb-4"}),Fe.jsx("h2",{className:"text-2xl font-bold mb-2",children:e}),Fe.jsx("p",{className:s,children:t})]})}function Ni(){const{user:e}=Ya(),[t,s]=i.useState([]),[a,r]=i.useState(1),[n,l]=i.useState(0),[o,d]=i.useState(10),[c,m]=i.useState(!0),[x,u]=i.useState(!1),[h,b]=i.useState(null),[f,g]=i.useState("comfortable"),[j,v]=i.useState(null),[y,N]=i.useState(""),[w,C]=i.useState(null),k="admin"===e?.role||"superadmin"===e?.role;i.useEffect(()=>{k?A():p.error(ir("accessDenied"))},[k,a]);const A=async()=>{try{m(!0);const e=await pi({page:a,pageSize:o});if(Array.isArray(e))s(e),l(e.length);else{const t=Array.isArray(e.items)?e.items:e.usuarios||[];s(t),l(Number(e.total)||0),d(Number(e.pageSize)||10)}}catch(e){Rr(e,rr("load","usuários"))}finally{m(!1)}},P=e=>{b(e),u(!0)},R=async(t,s)=>{if(t===e.id)return void p.error(ir("cannotDeleteSelf"));const a=`Tem certeza que deseja excluir o usuário "${s}"?\n\nEsta ação não pode ser desfeita.`;if(window.confirm(a))try{C(t),await fi(t),p.success(ar("delete","Usuário")),v({type:"success",message:"Usuário excluído e lista atualizada."}),A()}catch(r){Rr(r,rr("delete","usuário"))}finally{C(null)}},z=t.filter(e=>e.nome.toLowerCase().includes(y.toLowerCase())||e.email.toLowerCase().includes(y.toLowerCase())||e.crm&&e.crm.includes(y)),D=e=>"superadmin"===e?"Super Admin":"admin"===e?"Administrador":"nutricionista"===e?"Nutricionista":"atendente"===e?"Atendente":"enfermeiro"===e?"Enfermeiro":"tecnico_enfermagem"===e?"Técnico de Enfermagem":"fisioterapeuta"===e?"Fisioterapeuta":"assistente_social"===e?"Assistente Social":"auxiliar_administrativo"===e?"Auxiliar Administrativo":"medico"===e?"Médico":"Usuário";return k?Fe.jsxs("div",{className:"space-y-8",children:[Fe.jsxs(yr,{label:"Administração",title:"Usuários",subtitle:"Gerencie o acesso ao sistema, cadastre novos profissionais e mantenha a equipe atualizada.",children:[Fe.jsxs("button",{type:"button",onClick:A,className:"btn btn-secondary flex items-center justify-center gap-2",children:[Fe.jsx(E,{size:18})," Atualizar"]}),Fe.jsxs("button",{onClick:()=>u(!0),className:"btn btn-primary flex items-center justify-center gap-2 shadow-lg shadow-primary-600/20",children:[Fe.jsx(V,{size:18})," Novo Usuário"]})]}),Fe.jsxs("div",{className:"flex items-center justify-between gap-3",children:[Fe.jsxs("div",{className:"text-sm text-slate-600",children:["Página ",Fe.jsx("span",{className:"font-semibold",children:a})]}),Fe.jsxs("div",{className:"flex gap-2",children:[Fe.jsx("button",{className:"btn btn-secondary",disabled:a<=1,onClick:()=>r(e=>Math.max(1,e-1)),children:"Anterior"}),Fe.jsx("button",{className:"btn btn-secondary",disabled:a*o>=n&&n>0,onClick:()=>r(e=>e+1),children:"Próxima"})]})]}),Fe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[Fe.jsx(Nr,{icon:S,label:"Total de Usuários",value:t.length,color:"primary"}),Fe.jsx(Nr,{icon:J,label:"Usuários Ativos",value:t.filter(e=>e.ativo).length,color:"emerald"}),Fe.jsx("div",{className:"hidden md:block"})]}),Fe.jsx(Dr,{searchTerm:y,onSearchChange:N,placeholder:"Buscar por nome, email ou CRM...",children:Fe.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500 ml-auto",children:[Fe.jsx("span",{children:"Densidade:"}),Fe.jsx("button",{type:"button",onClick:()=>g(e=>"comfortable"===e?"compact":"comfortable"),className:"px-3 py-1 rounded-full text-xs font-semibold transition-colors "+("comfortable"===f?"bg-white shadow-sm text-primary-700 ring-1 ring-slate-200":"bg-slate-100 text-slate-600 hover:bg-slate-200"),children:"comfortable"===f?"Confortável":"Compacta"})]})}),j&&Fe.jsxs("div",{className:"card border flex items-center gap-3 "+("success"===j.type?"border-emerald-200 bg-emerald-50":"border-amber-200 bg-amber-50"),children:[Fe.jsx(J,{className:"text-emerald-500",size:20}),Fe.jsx("p",{className:"text-sm text-slate-700",children:j.message}),Fe.jsx("button",{className:"ml-auto text-xs text-slate-500 hover:text-slate-700",onClick:()=>v(null),children:"Fechar"})]}),Fe.jsx($r,{title:"Usuários",children:c?Fe.jsx("div",{className:"flex justify-center py-12",children:Fe.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):z.length>0?Fe.jsxs(Fe.Fragment,{children:[Fe.jsx(Or,{children:z.map(t=>Fe.jsxs(qr,{children:[Fe.jsxs("div",{className:"flex items-start justify-between",children:[Fe.jsxs("div",{className:"flex items-center gap-3",children:[Fe.jsx("div",{className:"w-10 h-10 rounded-full bg-primary-100 flex items-center justify-center text-primary-700 font-bold text-sm",children:t.nome.charAt(0).toUpperCase()}),Fe.jsxs("div",{children:[Fe.jsx("p",{className:"font-medium text-slate-900 dark:text-gray-100",children:t.nome}),Fe.jsxs("p",{className:"text-[10px] text-slate-400",children:["Código: ",t.id]}),Fe.jsx("p",{className:"text-xs text-slate-500 dark:text-gray-400",children:t.email}),t.crm&&Fe.jsxs("span",{className:"text-xs text-slate-500 dark:text-gray-400",children:["CRM: ",t.crm]})]})]}),Fe.jsx("span",{className:"px-2.5 py-1 text-xs rounded-full font-medium border "+(t.ativo?"bg-emerald-50 text-emerald-700 border-emerald-100":"bg-red-50 text-red-700 border-red-100"),children:t.ativo?"Ativo":"Inativo"})]}),Fe.jsxs("div",{className:"flex items-center justify-between mt-3",children:[Fe.jsx("span",{className:"px-2.5 py-1 text-xs rounded-full font-medium border "+("admin"===t.role||"superadmin"===t.role?"bg-purple-50 text-purple-700 border-purple-100":"bg-slate-100 text-slate-700 border-slate-200"),children:D(t.role)}),Fe.jsxs("div",{className:"flex items-center gap-2",children:[Fe.jsx("button",{onClick:()=>P(t),className:"group relative p-2.5 text-slate-500 hover:text-white hover:bg-gradient-to-br from-primary-500 to-primary-600 rounded-lg transition-all duration-200 shadow-sm hover:shadow-md",title:"Editar usuário","aria-label":"Editar usuário",children:Fe.jsx(Q,{size:18})}),t.id!==e.id&&Fe.jsx("button",{onClick:()=>R(t.id,t.nome),disabled:w===t.id,className:"group relative p-2.5 text-slate-500 hover:text-white hover:bg-gradient-to-br from-red-500 to-red-600 rounded-lg transition-all duration-200 shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed",title:"Excluir usuário","aria-label":"Excluir usuário",children:w===t.id?Fe.jsx("div",{className:"animate-spin rounded-full h-[18px] w-[18px] border-2 border-white border-t-transparent"}):Fe.jsx(te,{size:18})})]})]})]},t.id))}),Fe.jsxs(Ir,{children:[Fe.jsx(Fr,{columns:["Profissional","Contato","CRM","Função","Status","Ações"]}),Fe.jsx(Br,{children:z.map(t=>Fe.jsxs(Mr,{children:[Fe.jsx(Ur,{className:"compact"===f?"py-3":"py-4",children:Fe.jsxs("div",{className:"flex items-center gap-3",children:[Fe.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-100 flex items-center justify-center text-primary-700 font-bold text-xs",children:t.nome.charAt(0).toUpperCase()}),Fe.jsxs("div",{className:"flex flex-col",children:[Fe.jsx("div",{className:"font-medium text-slate-900 dark:text-gray-100",children:t.nome}),Fe.jsxs("span",{className:"text-[11px] text-slate-400",children:["Código: ",t.id]})]})]})}),Fe.jsx(Ur,{className:("compact"===f?"py-3":"py-4")+" text-sm text-slate-600 dark:text-gray-300",children:t.email}),Fe.jsx(Ur,{className:("compact"===f?"py-3":"py-4")+" text-sm text-slate-600 dark:text-gray-300",children:t.crm?Fe.jsx("span",{className:"font-mono bg-slate-100 dark:bg-gray-800 px-2 py-1 rounded text-xs",children:t.crm}):Fe.jsx("span",{className:"text-slate-400",children:"-"})}),Fe.jsx(Ur,{className:"compact"===f?"py-3":"py-4",children:Fe.jsx("span",{className:"px-2.5 py-1 text-xs rounded-full font-medium border "+("admin"===t.role||"superadmin"===t.role?"bg-purple-50 text-purple-700 border-purple-100":"bg-slate-100 text-slate-700 border-slate-200"),children:D(t.role)})}),Fe.jsx(Ur,{className:"compact"===f?"py-3":"py-4",children:Fe.jsx("span",{className:"px-2.5 py-1 text-xs rounded-full font-medium border "+(t.ativo?"bg-emerald-50 text-emerald-700 border-emerald-100":"bg-red-50 text-red-700 border-red-100"),children:t.ativo?"Ativo":"Inativo"})}),Fe.jsx(Ur,{className:("compact"===f?"py-3":"py-4")+" text-right",children:Fe.jsxs("div",{className:"flex items-center justify-end gap-2",children:[Fe.jsx(Lr,{onClick:()=>P(t),icon:Q,tooltip:"Editar",ariaLabel:"Editar usuário",variant:"primary"}),t.id!==e.id&&Fe.jsx(Lr,{onClick:()=>R(t.id,t.nome),icon:te,tooltip:"Excluir",ariaLabel:"Excluir usuário",variant:"danger",disabled:w===t.id,loading:w===t.id})]})})]},t.id))})]})]}):Fe.jsx(Tr,{icon:U,title:"Nenhum usuário encontrado",description:y?"Tente buscar com outros termos.":"Comece adicionando novos usuários ao sistema.",actionLabel:y?null:"Adicionar usuário",onAction:y?null:()=>u(!0)})}),x&&Fe.jsx(vi,{usuario:h,onClose:()=>{u(!1),b(null),v({type:"success",message:"Dados atualizados após salvar usuário."}),A()}})]}):Fe.jsx(yi,{message:"Apenas administradores podem acessar esta página."})}const wi={getAll:async()=>Ma("/empresas"),getById:async e=>Ma(`/empresas/${e}`),create:async e=>Ua("/empresas",e),update:async(e,t)=>Va(`/empresas/${e}`,t),delete:async e=>Ga(`/empresas/${e}`),deleteForce:async e=>Ga(`/empresas/${e}?force=true`),trialStart:async(e,t)=>Ua(`/empresas/${e}/trial/start`,{dias:t}),trialExtend:async(e,t)=>Ua(`/empresas/${e}/trial/extend`,{dias:t}),trialEnd:async e=>Ua(`/empresas/${e}/trial/end`,{}),trialConvert:async(e,t)=>Ua(`/empresas/${e}/trial/convert`,{plano:t}),getMyCompany:async()=>Ma("/empresas/me"),updateMyCompany:async e=>Va("/empresas/me",e)},Si=Object.freeze(Object.defineProperty({__proto__:null,default:wi},Symbol.toStringTag,{value:"Module"}));function Ci(){const{user:e}=Ya(),t=r(),[s,a]=i.useState([]),[n,l]=i.useState(!0),[o,d]=i.useState(""),[c,m]=i.useState(!1),[x,h]=i.useState(null),[b,f]=i.useState({nome:"",cnpj:"",email:"",telefone:"",endereco:"",tipoSistema:"casa-repouso",plano:"basico",ativo:!0}),[g,j]=i.useState(null),v="superadmin"===e?.role;i.useEffect(()=>{v?y():l(!1)},[v]);const y=async()=>{try{l(!0);const e=await wi.getAll(),t=Array.isArray(e)?e:e.empresas||[];a(t)}catch(e){Rr(e,"Erro ao carregar lista de empresas")}finally{l(!1)}},N=(e=null)=>{e?(h(e),f({nome:e.nome||"",cnpj:e.cnpj||"",email:e.email||"",telefone:e.telefone||"",endereco:e.endereco||"",tipoSistema:e.tipoSistema||"casa-repouso",plano:e.plano||"basico",ativo:void 0===e.ativo||e.ativo})):(h(null),f({nome:"",cnpj:"",email:"",telefone:"",endereco:"",tipoSistema:"casa-repouso",plano:"basico",ativo:!0})),m(!0)},w=()=>{m(!1),h(null),f({nome:"",cnpj:"",email:"",telefone:"",endereco:"",tipoSistema:"casa-repouso",plano:"basico",ativo:!0})},C=async e=>{const t=s.find(t=>String(t.id)===String(e));if(!t)return;if(t.ativo){if(!window.confirm(`Inativar a empresa "${t.nome}"?\n\nRecomendado: a empresa ficará bloqueada para login e uso, mas os dados ficam preservados.\n\nPara excluir definitivamente, primeiro inative e depois exclua.`))return;try{j(e),await wi.update(e,{ativo:!1}),p.success("Empresa inativada com sucesso!"),await y()}catch(i){Rr(i,"Erro ao inativar empresa")}finally{j(null)}return}if(!window.confirm(`Excluir DEFINITIVAMENTE a empresa "${t.nome}"?\n\nIsso remove a empresa e dados relacionados (pacientes, usuários, prescrições, etc).\nEsta ação NÃO pode ser desfeita.`))return;const a=t.codigo||t.nome,r=window.prompt(`Digite "${a}" para confirmar a exclusão definitiva:`);if(r&&r.trim()===String(a))try{j(e),await wi.deleteForce(e),p.success("Empresa excluída definitivamente com sucesso!"),await y()}catch(i){Rr(i,"Erro ao excluir definitivamente")}finally{j(null)}else p.error("Confirmação inválida. Exclusão cancelada.")},k=s.filter(e=>e.nome?.toLowerCase().includes(o.toLowerCase())||e.cnpj?.toLowerCase().includes(o.toLowerCase())||e.email?.toLowerCase().includes(o.toLowerCase())||e.codigo?.toLowerCase().includes(o.toLowerCase())),A=e=>{const t=String(e||"").replace(/\D/g,"").slice(0,14);return t.length<=2?t:t.length<=5?t.replace(/(\d{2})(\d{0,3})/,"$1.$2"):t.length<=8?t.replace(/(\d{2})(\d{3})(\d{0,3})/,"$1.$2.$3"):t.length<=12?t.replace(/(\d{2})(\d{3})(\d{3})(\d{0,4})/,"$1.$2.$3/$4"):mr(t)},P=s.length,R=s.filter(e=>e.ativo).length,z=s.filter(e=>!e.ativo).length,D=e=>{if(!e?.emTeste)return!1;if(!e?.testeFim)return!1;const t=new Date(e.testeFim);return!Number.isNaN(t.getTime())&&t.getTime()<Date.now()},T=e=>{if(!e?.emTeste)return{label:"Sem trial",tone:"neutral"};const t=e?.testeFim?new Date(e.testeFim):null,s=t&&!Number.isNaN(t.getTime()),a=D(e);if(!s)return{label:a?"Trial expirado":"Em trial",tone:a?"danger":"warning"};const r=t.getTime()-Date.now(),i=Math.ceil(r/864e5);return a?{label:`Trial expirou em ${I(e.testeFim)}`,tone:"danger"}:{label:`Trial: ${i} dia(s)`,tone:"warning"}},_=s.filter(e=>e.ativo&&D(e)).length,L=e=>"profissional"===e?"Profissional":"empresa"===e?"Empresa":"Básico",$=e=>"fisioterapia"===e?"Fisioterapia":"petshop"===e?"Petshop":"Casa de Repouso",O=e=>{const t=e?.usuariosAtivos??(Array.isArray(e?.usuarios)?e.usuarios.length:null),s=e?.limiteUsuarios??null;return null===t&&null===s?"-":null!==s?`${t??0}/${s}`:`${t??0}`},I=e=>{if(!e)return"-";const t=new Date(e);return Number.isNaN(t.getTime())?"-":t.toLocaleDateString("pt-BR")};return v?Fe.jsxs("div",{className:"space-y-6",children:[Fe.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 p-6 md:p-8",children:[Fe.jsx("p",{className:"text-xs uppercase tracking-widest text-slate-400 font-semibold mb-2",children:"Institucional"}),Fe.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6",children:[Fe.jsxs("div",{children:[Fe.jsxs("div",{className:"flex items-center gap-3",children:[Fe.jsx("div",{className:"w-11 h-11 rounded-xl bg-primary-50 flex items-center justify-center",children:Fe.jsx(u,{className:"text-primary-600",size:22})}),Fe.jsxs("div",{children:[Fe.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-slate-900",children:"Gerenciamento de Empresas"}),Fe.jsx("p",{className:"text-slate-500 text-sm mt-1",children:"Super Administrador"})]})]}),Fe.jsx("p",{className:"text-slate-500 mt-3 max-w-2xl",children:"Controle completo das empresas cadastradas, planos, status e informações de contato."})]}),Fe.jsxs("div",{className:"flex flex-wrap gap-2",children:[Fe.jsx("button",{type:"button",onClick:()=>t("/backups"),className:"px-4 py-2 rounded-xl border border-slate-200 text-slate-600 text-sm font-semibold bg-white hover:bg-slate-50",children:Fe.jsxs("span",{className:"inline-flex items-center gap-2",children:[Fe.jsx(se,{size:16})," Backups"]})}),Fe.jsx("button",{type:"button",onClick:()=>t("/usuarios"),className:"px-4 py-2 rounded-xl border border-slate-200 text-slate-600 text-sm font-semibold bg-white hover:bg-slate-50",children:Fe.jsxs("span",{className:"inline-flex items-center gap-2",children:[Fe.jsx(S,{size:16})," Usuários"]})}),Fe.jsx("button",{onClick:()=>N(),className:"px-4 py-2 rounded-xl border border-primary-200 text-primary-700 text-sm font-semibold bg-primary-50 hover:bg-primary-100",children:Fe.jsxs("span",{className:"inline-flex items-center gap-2",children:[Fe.jsx(V,{size:16})," Nova Empresa"]})})]})]})]}),Fe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4",children:[Fe.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 p-5 relative overflow-hidden",children:[Fe.jsx("span",{className:"absolute right-4 top-4 text-[10px] px-2 py-1 rounded-full bg-slate-100 text-slate-500 font-semibold",children:"TOTAL"}),Fe.jsxs("div",{className:"flex items-center gap-4",children:[Fe.jsx("div",{className:"w-11 h-11 rounded-xl bg-slate-100 flex items-center justify-center",children:Fe.jsx(u,{className:"text-slate-500",size:20})}),Fe.jsxs("div",{children:[Fe.jsx("p",{className:"text-2xl font-bold text-slate-900",children:P}),Fe.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Total de empresas"})]})]})]}),Fe.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-emerald-200 p-5 relative overflow-hidden",children:[Fe.jsx("span",{className:"absolute right-4 top-4 text-[10px] px-2 py-1 rounded-full bg-emerald-50 text-emerald-600 font-semibold",children:"ATIVAS"}),Fe.jsxs("div",{className:"flex items-center gap-4",children:[Fe.jsx("div",{className:"w-11 h-11 rounded-xl bg-emerald-50 flex items-center justify-center",children:Fe.jsx(u,{className:"text-emerald-600",size:20})}),Fe.jsxs("div",{children:[Fe.jsx("p",{className:"text-2xl font-bold text-emerald-600",children:R}),Fe.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Empresas ativas"})]})]})]}),Fe.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-red-200 p-5 relative overflow-hidden",children:[Fe.jsx("span",{className:"absolute right-4 top-4 text-[10px] px-2 py-1 rounded-full bg-red-50 text-red-600 font-semibold",children:"BLOQUEADAS"}),Fe.jsxs("div",{className:"flex items-center gap-4",children:[Fe.jsx("div",{className:"w-11 h-11 rounded-xl bg-red-50 flex items-center justify-center",children:Fe.jsx(u,{className:"text-red-600",size:20})}),Fe.jsxs("div",{children:[Fe.jsx("p",{className:"text-2xl font-bold text-red-600",children:_}),Fe.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Empresas bloqueadas"})]})]})]}),Fe.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-amber-200 p-5 relative overflow-hidden",children:[Fe.jsx("span",{className:"absolute right-4 top-4 text-[10px] px-2 py-1 rounded-full bg-amber-50 text-amber-600 font-semibold",children:"INATIVAS"}),Fe.jsxs("div",{className:"flex items-center gap-4",children:[Fe.jsx("div",{className:"w-11 h-11 rounded-xl bg-amber-50 flex items-center justify-center",children:Fe.jsx(u,{className:"text-amber-600",size:20})}),Fe.jsxs("div",{children:[Fe.jsx("p",{className:"text-2xl font-bold text-amber-600",children:z}),Fe.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Empresas inativas"})]})]})]})]}),Fe.jsx("div",{className:"bg-white rounded-2xl shadow-sm p-5 border border-slate-200",children:Fe.jsxs("div",{className:"flex flex-col md:flex-row gap-3 md:items-center",children:[Fe.jsxs("div",{className:"relative flex-1",children:[Fe.jsx(U,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400",size:18}),Fe.jsx("input",{type:"text",placeholder:"Buscar por nome, CNPJ ou email...",value:o,onChange:e=>d(e.target.value),className:"w-full pl-11 pr-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition"})]}),Fe.jsxs("button",{onClick:y,disabled:n,className:"px-4 py-3 rounded-xl border border-slate-200 text-slate-600 text-sm font-semibold bg-white hover:bg-slate-50 disabled:opacity-50 flex items-center gap-2",children:[Fe.jsx(E,{size:16,className:n?"animate-spin":""}),"Atualizar"]})]})}),Fe.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden",children:n?Fe.jsx("div",{className:"flex justify-center items-center py-12",children:Fe.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-600 border-t-transparent"})}):k.length>0?Fe.jsxs(Fe.Fragment,{children:[Fe.jsx("div",{className:"hidden md:block overflow-x-auto",children:Fe.jsxs("table",{className:"w-full",children:[Fe.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:Fe.jsxs("tr",{children:[Fe.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider",children:"Código"}),Fe.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider",children:"Empresa"}),Fe.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider",children:"Tipo"}),Fe.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider",children:"CNPJ"}),Fe.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider",children:"Email/Telefone"}),Fe.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider",children:"Plano"}),Fe.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider",children:"Trial"}),Fe.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider",children:"Usuários"}),Fe.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider",children:"Status"}),Fe.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider",children:"Data Criação"}),Fe.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-slate-600 uppercase tracking-wider",children:"Ações"})]})}),Fe.jsx("tbody",{className:"divide-y divide-slate-200",children:k.map(e=>Fe.jsxs("tr",{className:"hover:bg-slate-50 transition",children:[Fe.jsx("td",{className:"px-6 py-4",children:Fe.jsx("span",{className:"inline-flex items-center px-3 py-1 text-xs rounded-full font-semibold bg-slate-100 text-slate-700 border border-slate-200",children:e.codigo||"-"})}),Fe.jsx("td",{className:"px-6 py-4",children:Fe.jsxs("div",{className:"flex items-center gap-3",children:[Fe.jsx("div",{className:"w-10 h-10 bg-primary-50 rounded-lg flex items-center justify-center",children:Fe.jsx(u,{className:"text-primary-600",size:20})}),Fe.jsxs("div",{children:[Fe.jsx("p",{className:"font-semibold text-slate-900",children:e.nome}),Fe.jsx("p",{className:"text-sm text-slate-500",children:e.endereco||"Sem endereço"})]})]})}),Fe.jsx("td",{className:"px-6 py-4",children:Fe.jsx("span",{className:"px-3 py-1 text-xs rounded-full font-semibold bg-primary-50 text-primary-700 border border-primary-100",children:$(e.tipoSistema)})}),Fe.jsx("td",{className:"px-6 py-4",children:Fe.jsx("span",{className:"text-rose-500 font-medium",children:e.cnpj?mr(e.cnpj):"-"})}),Fe.jsx("td",{className:"px-6 py-4",children:Fe.jsxs("div",{children:[Fe.jsx("p",{className:"text-slate-600",children:e.email||"-"}),Fe.jsx("p",{className:"text-sm text-slate-500",children:e.telefone||"-"})]})}),Fe.jsx("td",{className:"px-6 py-4",children:Fe.jsx("span",{className:"px-3 py-1 text-xs rounded-full font-semibold bg-blue-50 text-blue-700 border border-blue-100",children:L(e.plano)})}),Fe.jsx("td",{className:"px-6 py-4",children:(()=>{const t=T(e),s="danger"===t.tone?"bg-red-50 text-red-700 border-red-200":"warning"===t.tone?"bg-amber-50 text-amber-700 border-amber-200":"bg-slate-100 text-slate-700 border-slate-200";return Fe.jsx("span",{className:`px-3 py-1 text-xs rounded-full font-semibold border ${s}`,children:t.label})})()}),Fe.jsx("td",{className:"px-6 py-4",children:Fe.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 text-xs rounded-full font-semibold bg-slate-100 text-slate-600 border border-slate-200",children:[Fe.jsx(S,{size:12}),O(e)]})}),Fe.jsx("td",{className:"px-6 py-4",children:Fe.jsx("span",{className:"px-3 py-1 text-xs rounded-full font-medium border "+(e.ativo?"bg-emerald-100 text-emerald-700 border-emerald-200":"bg-red-100 text-red-700 border-red-200"),children:e.ativo?"Ativo":"Inativo"})}),Fe.jsx("td",{className:"px-6 py-4 text-slate-600",children:I(e.createdAt)}),Fe.jsx("td",{className:"px-6 py-4",children:Fe.jsxs("div",{className:"flex justify-end gap-2",children:[Fe.jsx("button",{onClick:()=>N(e),className:"p-2 text-primary-600 border border-primary-200 hover:bg-primary-600 hover:text-white rounded-lg transition",title:"Editar",children:Fe.jsx(Q,{size:18})}),Fe.jsx("button",{onClick:()=>C(e.id),disabled:g===e.id,className:"p-2 text-red-600 border border-red-200 hover:text-white hover:bg-red-600 rounded-lg transition disabled:opacity-50",title:e.ativo?"Inativar":"Excluir definitivamente",children:g===e.id?Fe.jsx("div",{className:"animate-spin rounded-full h-[18px] w-[18px] border-2 border-white border-t-transparent"}):Fe.jsx(te,{size:18})})]})})]},e.id))})]})}),Fe.jsx("div",{className:"md:hidden divide-y divide-slate-200",children:k.map(e=>Fe.jsxs("div",{className:"p-4 space-y-3",children:[Fe.jsxs("div",{className:"flex items-start justify-between",children:[Fe.jsxs("div",{className:"flex items-center gap-3",children:[Fe.jsx("div",{className:"w-10 h-10 bg-primary-50 rounded-lg flex items-center justify-center",children:Fe.jsx(u,{className:"text-primary-600",size:20})}),Fe.jsxs("div",{children:[Fe.jsx("p",{className:"font-semibold text-slate-900",children:e.nome}),Fe.jsx("p",{className:"text-xs text-slate-500 font-semibold",children:e.codigo||"-"}),Fe.jsx("p",{className:"text-xs text-rose-500 font-medium",children:e.cnpj?mr(e.cnpj):"Sem CNPJ"})]})]}),Fe.jsx("span",{className:"px-2.5 py-1 text-xs rounded-full font-medium border "+(e.ativo?"bg-emerald-100 text-emerald-700 border-emerald-200":"bg-red-100 text-red-700 border-red-200"),children:e.ativo?"Ativo":"Inativo"})]}),Fe.jsxs("div",{className:"space-y-1 text-sm",children:[Fe.jsx("p",{className:"text-slate-600",children:e.email||"Sem email"}),Fe.jsx("p",{className:"text-slate-600",children:e.telefone||"Sem telefone"}),Fe.jsxs("p",{className:"text-xs text-slate-500",children:["Criada em: ",I(e.createdAt)]})]}),Fe.jsxs("div",{className:"flex items-center gap-2",children:[Fe.jsx("span",{className:"px-2.5 py-1 text-xs rounded-full font-semibold bg-blue-50 text-blue-700 border border-blue-100",children:L(e.plano)}),(()=>{const t=T(e),s="danger"===t.tone?"bg-red-50 text-red-700 border-red-200":"warning"===t.tone?"bg-amber-50 text-amber-700 border-amber-200":"bg-slate-100 text-slate-700 border-slate-200";return Fe.jsx("span",{className:`px-2.5 py-1 text-xs rounded-full font-semibold border ${s}`,children:"neutral"===t.tone?"Sem trial":t.label})})(),Fe.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 text-xs rounded-full font-semibold bg-slate-100 text-slate-600 border border-slate-200",children:[Fe.jsx(S,{size:12}),O(e)]})]}),Fe.jsxs("div",{className:"text-xs text-slate-500",children:["Tipo: ",$(e.tipoSistema)]}),Fe.jsxs("div",{className:"flex gap-2 pt-2",children:[Fe.jsxs("button",{onClick:()=>N(e),className:"flex-1 px-4 py-2 text-primary-600 border border-primary-200 rounded-lg hover:bg-primary-50 transition font-medium flex items-center justify-center gap-2",children:[Fe.jsx(Q,{size:16}),"Editar"]}),Fe.jsx("button",{onClick:()=>C(e.id),disabled:g===e.id,className:"flex-1 px-4 py-2 text-red-600 border border-red-200 rounded-lg hover:bg-red-50 transition font-medium flex items-center justify-center gap-2 disabled:opacity-50",children:g===e.id?Fe.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-red-600 border-t-transparent"}):Fe.jsxs(Fe.Fragment,{children:[Fe.jsx(te,{size:16}),"Excluir"]})})]})]},e.id))})]}):Fe.jsxs("div",{className:"text-center py-12",children:[Fe.jsx(u,{className:"mx-auto text-slate-300 mb-4",size:48}),Fe.jsx("p",{className:"text-slate-600 font-medium",children:"Nenhuma empresa encontrada"}),Fe.jsx("p",{className:"text-slate-500 text-sm mt-1",children:o?"Tente ajustar sua busca":"Comece cadastrando uma nova empresa"}),!o&&Fe.jsxs("button",{onClick:()=>N(),className:"mt-4 btn btn-primary flex items-center gap-2 mx-auto",children:[Fe.jsx(V,{size:18}),"Nova Empresa"]})]})}),c&&Fe.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:Fe.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[Fe.jsxs("div",{className:"sticky top-0 bg-white border-b border-slate-200 px-6 py-4 flex items-center justify-between",children:[Fe.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:x?"Editar Empresa":"Nova Empresa"}),Fe.jsx("button",{onClick:w,className:"p-2 hover:bg-slate-100 rounded-lg transition",children:Fe.jsx(q,{size:20})})]}),Fe.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!b.nome.trim())return void p.error("Nome da empresa é obrigatório");const t=(b.cnpj||"").replace(/\D/g,"");if(!t||pr(t))try{const e={...b,cnpj:t||null};x?(await wi.update(x.id,e),p.success("Empresa atualizada com sucesso!")):(await wi.create(e),p.success("Empresa criada com sucesso!")),w(),y()}catch(s){Rr(s,"Erro ao salvar empresa")}else p.error("CNPJ inválido")},className:"p-6 space-y-6",children:[Fe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[Fe.jsxs("div",{className:"md:col-span-2",children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Nome da Empresa *"}),Fe.jsx("input",{type:"text",value:b.nome,onChange:e=>f({...b,nome:e.target.value}),className:"input w-full",required:!0})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"CNPJ"}),Fe.jsx("input",{type:"text",value:b.cnpj,onChange:e=>f({...b,cnpj:A(e.target.value)}),className:"input w-full",placeholder:"00.000.000/0000-00"})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Telefone"}),Fe.jsx("input",{type:"text",value:b.telefone,onChange:e=>f({...b,telefone:e.target.value}),className:"input w-full",placeholder:"(00) 00000-0000"})]}),Fe.jsxs("div",{className:"md:col-span-2",children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Email"}),Fe.jsx("input",{type:"email",value:b.email,onChange:e=>f({...b,email:e.target.value}),className:"input w-full",placeholder:"contato@empresa.com"})]}),Fe.jsxs("div",{className:"md:col-span-2",children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Endereço"}),Fe.jsx("input",{type:"text",value:b.endereco,onChange:e=>f({...b,endereco:e.target.value}),className:"input w-full",placeholder:"Rua, número, bairro, cidade - UF"})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Tipo de Sistema"}),Fe.jsxs("select",{value:b.tipoSistema,onChange:e=>f({...b,tipoSistema:e.target.value}),className:"input w-full",children:[Fe.jsx("option",{value:"casa-repouso",children:"Casa de Repouso"}),Fe.jsx("option",{value:"fisioterapia",children:"Fisioterapia"}),Fe.jsx("option",{value:"petshop",children:"Petshop"})]})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Plano"}),Fe.jsxs("select",{value:b.plano,onChange:e=>f({...b,plano:e.target.value}),className:"input w-full",children:[Fe.jsx("option",{value:"basico",children:"Básico"}),Fe.jsx("option",{value:"profissional",children:"Profissional"}),Fe.jsx("option",{value:"empresa",children:"Empresa"})]})]}),Fe.jsx("div",{className:"md:col-span-2",children:Fe.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[Fe.jsx("input",{type:"checkbox",checked:b.ativo,onChange:e=>f({...b,ativo:e.target.checked}),className:"w-5 h-5 text-primary-600 border-slate-300 rounded focus:ring-primary-500"}),Fe.jsx("span",{className:"text-sm font-semibold text-slate-700",children:"Empresa Ativa"})]})})]}),x&&Fe.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-4",children:[Fe.jsx("div",{className:"flex items-start justify-between gap-4",children:Fe.jsxs("div",{children:[Fe.jsx("p",{className:"text-sm font-semibold text-slate-900",children:"Período de teste (trial)"}),Fe.jsxs("p",{className:"text-xs text-slate-600 mt-1",children:["Status: ",T(x).label]}),Fe.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Início: ",I(x.testeInicio)," · Fim: ",I(x.testeFim)]})]})}),Fe.jsxs("div",{className:"flex flex-wrap gap-2 mt-3",children:[Fe.jsx("button",{type:"button",onClick:async()=>{const e=window.prompt("Quantos dias de trial? (ex.: 7)"),t=Number.parseInt(String(e||"").trim(),10);if(!Number.isFinite(t)||t<=0)p.error("Informe um número de dias válido.");else try{const e=await wi.trialStart(x.id,t);p.success("Trial iniciado com sucesso!"),h(e),await y()}catch(s){Rr(s,"Erro ao iniciar trial")}},className:"px-3 py-2 rounded-xl border border-amber-200 text-amber-800 text-sm font-semibold bg-amber-50 hover:bg-amber-100",children:"Iniciar trial"}),Fe.jsx("button",{type:"button",onClick:async()=>{const e=window.prompt("Prorrogar por quantos dias? (ex.: 7)"),t=Number.parseInt(String(e||"").trim(),10);if(!Number.isFinite(t)||t<=0)p.error("Informe um número de dias válido.");else try{const e=await wi.trialExtend(x.id,t);p.success("Trial prorrogado com sucesso!"),h(e),await y()}catch(s){Rr(s,"Erro ao prorrogar trial")}},className:"px-3 py-2 rounded-xl border border-amber-200 text-amber-800 text-sm font-semibold bg-white hover:bg-amber-50",children:"Prorrogar"}),Fe.jsx("button",{type:"button",onClick:async()=>{if(window.confirm("Encerrar o trial? A empresa continuará ativa, mas sem modo teste."))try{const e=await wi.trialEnd(x.id);p.success("Trial encerrado com sucesso!"),h(e),await y()}catch(e){Rr(e,"Erro ao encerrar trial")}},className:"px-3 py-2 rounded-xl border border-slate-200 text-slate-700 text-sm font-semibold bg-white hover:bg-slate-50",children:"Encerrar"}),Fe.jsx("button",{type:"button",onClick:async()=>{if(window.confirm(`Converter trial em plano "${L(b.plano)}" e ativar empresa?`))try{const e=await wi.trialConvert(x.id,b.plano);p.success("Trial convertido em plano com sucesso!"),h(e),await y()}catch(e){Rr(e,"Erro ao converter trial")}},className:"px-3 py-2 rounded-xl border border-emerald-200 text-emerald-800 text-sm font-semibold bg-emerald-50 hover:bg-emerald-100",children:"Converter em plano"})]}),Fe.jsx("p",{className:"text-[11px] text-slate-500 mt-3",children:"Dica: para excluir definitivamente, primeiro inative a empresa e depois use o botão Excluir na lista."})]}),Fe.jsxs("div",{className:"flex gap-3 pt-4 border-t border-slate-200",children:[Fe.jsx("button",{type:"button",onClick:w,className:"flex-1 btn btn-secondary",children:"Cancelar"}),Fe.jsx("button",{type:"submit",className:"flex-1 btn btn-primary",children:x?"Salvar Alterações":"Criar Empresa"})]})]})]})})]}):Fe.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:Fe.jsx(yi,{message:"Apenas Super Administradores podem acessar esta página.",messageClassName:"text-gray-600"})})}const ki=async e=>Ma(`/backups/empresas/${e}`),Ai=async(e,{sendEmail:t=!0}={})=>Ua(`/backups/empresas/${e}`,{sendEmail:t}),Ei=async(e,t)=>{const s=await Ia.get(`/backups/empresas/${e}/download/${encodeURIComponent(t)}`,{responseType:"blob"}),a=new Blob([s.data],{type:"application/gzip"}),r=window.URL.createObjectURL(a),i=document.createElement("a");i.href=r,i.download=t,document.body.appendChild(i),i.click(),i.remove(),window.URL.revokeObjectURL(r)};function Pi(e){const t=Number(e||0);if(!Number.isFinite(t)||t<=0)return"-";const s=["B","KB","MB","GB"],a=Math.min(Math.floor(Math.log(t)/Math.log(1024)),s.length-1);return`${(t/1024**a).toFixed(0===a?0:1)} ${s[a]}`}function Ri(){const{user:e}=Ya(),t="superadmin"===e?.role,s=r(),[a,n]=i.useState(!0),[l,o]=i.useState([]),[d,c]=i.useState(""),[m,x]=i.useState([]),[b,f]=i.useState(!1),[g,j]=i.useState(!0),v=i.useMemo(()=>l.find(e=>String(e.id)===String(d))||null,[l,d]),y=async e=>{if(!e)return void x([]);const t=await ki(e);x(Array.isArray(t?.items)?t.items:[])},N=async()=>{try{n(!0),await(async()=>{const e=await wi.getAll(),t=Array.isArray(e)?e:e.empresas||[];o(t),!d&&t.length>0&&c(t[0].id)})()}catch(e){Rr(e,"Erro ao carregar empresas")}finally{n(!1)}};i.useEffect(()=>{t&&N()},[t]),i.useEffect(()=>{t&&y(d).catch(e=>Rr(e,"Erro ao carregar backups"))},[d,t]);return t?Fe.jsxs("div",{className:"space-y-6",children:[Fe.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 p-6 md:p-8",children:[Fe.jsx("p",{className:"text-xs uppercase tracking-widest text-slate-400 font-semibold mb-2",children:"Institucional"}),Fe.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6",children:[Fe.jsxs("div",{children:[Fe.jsxs("div",{className:"flex items-center gap-3",children:[Fe.jsx("div",{className:"w-11 h-11 rounded-xl bg-primary-50 flex items-center justify-center",children:Fe.jsx(se,{className:"text-primary-600",size:22})}),Fe.jsxs("div",{children:[Fe.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-slate-900",children:"Backups"}),Fe.jsx("p",{className:"text-slate-500 text-sm mt-1",children:"Super Administrador"})]})]}),Fe.jsx("p",{className:"text-slate-500 mt-3 max-w-2xl",children:"Gere backups manuais e faça download. O envio por e-mail depende de configuração SMTP no backend."})]}),Fe.jsxs("div",{className:"flex flex-wrap gap-2",children:[Fe.jsx("button",{type:"button",onClick:()=>s("/empresas"),className:"px-4 py-2 rounded-xl border border-slate-200 text-slate-600 text-sm font-semibold bg-white hover:bg-slate-50",children:Fe.jsxs("span",{className:"inline-flex items-center gap-2",children:[Fe.jsx(u,{size:16})," Empresas"]})}),Fe.jsx("button",{type:"button",onClick:N,disabled:a,className:"px-4 py-2 rounded-xl border border-slate-200 text-slate-600 text-sm font-semibold bg-white hover:bg-slate-50 disabled:opacity-50",children:Fe.jsxs("span",{className:"inline-flex items-center gap-2",children:[Fe.jsx(E,{size:16,className:a?"animate-spin":""})," Atualizar"]})})]})]})]}),Fe.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 p-5",children:[Fe.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 lg:items-end",children:[Fe.jsxs("div",{className:"flex-1",children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-1",children:"Empresa"}),Fe.jsx("select",{value:d,onChange:e=>c(e.target.value),className:"w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition",children:l.map(e=>Fe.jsx("option",{value:e.id,children:(e.codigo?`${e.codigo} - `:"")+(e.nome||"Empresa")},e.id))})]}),Fe.jsxs("div",{className:"flex items-center gap-3",children:[Fe.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-slate-700",children:[Fe.jsx("input",{type:"checkbox",checked:g,onChange:e=>j(e.target.checked),className:"rounded border-slate-300 text-primary-600 focus:ring-primary-500"}),Fe.jsxs("span",{className:"inline-flex items-center gap-2",children:[Fe.jsx(h,{size:16})," Enviar por e-mail"]})]}),Fe.jsx("button",{type:"button",onClick:async()=>{if(d)try{f(!0);const e=await Ai(d,{sendEmail:g});p.success("Backup gerado com sucesso!"),"skipped"===e?.email?.status&&g&&p("Backup criado, mas e-mail não foi enviado (SMTP não configurado).",{icon:"ℹ️"}),await y(d)}catch(e){Rr(e,"Erro ao gerar backup")}finally{f(!1)}},disabled:!d||b,className:"px-4 py-3 rounded-xl border border-primary-200 text-primary-700 text-sm font-semibold bg-primary-50 hover:bg-primary-100 disabled:opacity-50",children:Fe.jsxs("span",{className:"inline-flex items-center gap-2",children:[b?Fe.jsx("span",{className:"w-4 h-4 border-2 border-primary-300 border-t-primary-700 rounded-full animate-spin"}):Fe.jsx(V,{size:16}),"Gerar backup"]})})]})]}),v&&Fe.jsxs("p",{className:"text-xs text-slate-500 mt-3",children:["Destinatário preferencial: ",v.email||"email da empresa não definido (fallback: admin)"]})]}),Fe.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden",children:[Fe.jsxs("div",{className:"px-6 py-4 border-b border-slate-200 bg-slate-50",children:[Fe.jsx("h2",{className:"text-sm font-semibold text-slate-700",children:"Backups disponíveis"}),Fe.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Armazenamento local em ","data/backups"]})]}),a?Fe.jsx("div",{className:"flex justify-center items-center py-12",children:Fe.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-600 border-t-transparent"})}):0===m.length?Fe.jsx("div",{className:"p-8 text-center text-slate-500",children:"Nenhum backup encontrado para esta empresa."}):Fe.jsx("div",{className:"overflow-x-auto",children:Fe.jsxs("table",{className:"w-full",children:[Fe.jsx("thead",{className:"bg-white border-b border-slate-200",children:Fe.jsxs("tr",{children:[Fe.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider",children:"Arquivo"}),Fe.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider",children:"Tamanho"}),Fe.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider",children:"Atualizado"}),Fe.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-slate-600 uppercase tracking-wider",children:"Ações"})]})}),Fe.jsx("tbody",{className:"divide-y divide-slate-200",children:m.map(e=>Fe.jsxs("tr",{className:"hover:bg-slate-50 transition",children:[Fe.jsx("td",{className:"px-6 py-4",children:Fe.jsx("span",{className:"text-sm font-medium text-slate-900",children:e.filename})}),Fe.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:Pi(e.size)}),Fe.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:new Date(e.updatedAt).toLocaleString("pt-BR")}),Fe.jsx("td",{className:"px-6 py-4 text-right",children:Fe.jsxs("button",{type:"button",onClick:()=>(async e=>{try{await Ei(d,e)}catch(t){Rr(t,"Erro ao baixar backup")}})(e.filename),className:"inline-flex items-center gap-2 px-3 py-2 rounded-xl border border-slate-200 text-slate-700 text-sm font-semibold bg-white hover:bg-slate-50",children:[Fe.jsx(P,{size:16})," Baixar"]})})]},e.filename))})]})})]})]}):Fe.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:Fe.jsx(yi,{message:"Apenas Super Administradores podem acessar esta página.",messageClassName:"text-gray-600"})})}function zi(){const{user:e}=Ya(),[t,s]=i.useState("perfil"),[a,r]=i.useState(null),[n,l]=i.useState(!0),[o,d]=i.useState(!1),[c,m]=i.useState(!1),[x,u]=i.useState(!1),[h,f]=i.useState({nome:e?.nome||"",email:e?.email||"",telefone:e?.telefone||"",especialidade:e?.especialidade||"",crm:e?.crm||"",crmUf:e?.crmUf||""}),[g,j]=i.useState({nome:"",cnpj:"",endereco:"",telefone:""}),[v,y]=i.useState("admin"===e?.role);i.useEffect(()=>{f({nome:e?.nome||"",email:e?.email||"",telefone:e?.telefone||"",especialidade:e?.especialidade||"",crm:e?.crm||"",crmUf:e?.crmUf||""})},[e]);const N=i.useCallback(async()=>{l(!0);try{const e=await gi();r(e)}catch(e){Rr(e,"Não foi possível carregar o resumo do perfil")}finally{l(!1)}},[]),w=i.useCallback(async()=>{if("admin"===e?.role){y(!0);try{const e=await wi.getMyCompany();j({nome:e?.nome||"",cnpj:e?.cnpj||"",endereco:e?.endereco||"",telefone:e?.telefone||""})}catch(t){Rr(t,"Não foi possível carregar os dados da empresa")}finally{y(!1)}}},[e?.role]);i.useEffect(()=>{N()},[N]),i.useEffect(()=>{"admin"===e?.role&&w()},[e?.role,w]);const S=i.useCallback(e=>{Ya.setState(t=>{const s={...t.user||{},...e};return localStorage.setItem("user",JSON.stringify(s)),{user:s}})},[]),C=[{id:"perfil",nome:"Perfil",icon:I},{id:"empresa",nome:"Empresa",icon:ae},{id:"seguranca",nome:"Segurança",icon:b},{id:"notificacoes",nome:"Notificações",icon:re}],k=a?.lastUpdate?new Date(a.lastUpdate).toLocaleDateString("pt-BR"):"Hoje",A=a?.securityScore?Math.round(100*a.securityScore):0;return Fe.jsxs("div",{className:"space-y-8",children:[Fe.jsx(yr,{label:"Central",title:"Configurações",subtitle:"Personalize o perfil, mantenha os dados da empresa atualizados e revise as preferências de segurança e comunicação em um só lugar."}),Fe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[Fe.jsxs("div",{className:"card bg-gradient-to-br from-primary-50 to-white",children:[Fe.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-primary-600",children:"Perfil"}),Fe.jsx("p",{className:"text-3xl font-semibold text-slate-900 mt-2",children:e?.nome||"Usuário"}),Fe.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Última atualização: ",k]})]}),Fe.jsxs("div",{className:"card",children:[Fe.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:"Segurança"}),Fe.jsx("p",{className:"text-3xl font-semibold text-slate-900 mt-2",children:n?"---":`${A}%`}),Fe.jsx("p",{className:"text-xs text-slate-500 mt-1",children:n?"Carregando resumo de segurança...":a?.pendingSecurityTasks?.length?"Complete as ações recomendadas para atingir 100%.":"Nenhuma pendência crítica identificada."}),a?.pendingSecurityTasks?.length>0&&Fe.jsx("ul",{className:"text-xs text-slate-500 mt-3 space-y-1 list-disc list-inside",children:a.pendingSecurityTasks.slice(0,2).map(e=>Fe.jsx("li",{children:e},e))})]}),Fe.jsxs("div",{className:"card",children:[Fe.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:"Plano"}),Fe.jsx("p",{className:"text-xl font-semibold text-slate-900 mt-2",children:a?.planLabel||"Profissional"}),Fe.jsx("p",{className:"text-xs text-slate-500 mt-1",children:a?.planDescription||"Suporte prioritário e integrações liberadas."})]})]}),Fe.jsx("div",{className:"flex flex-wrap gap-2 bg-white/70 border border-slate-100 rounded-2xl p-2",children:C.map(e=>{const a=e.icon;return Fe.jsxs("button",{onClick:()=>s(e.id),className:"flex items-center gap-2 px-4 py-2 rounded-xl text-sm transition-all "+(t===e.id?"bg-gradient-to-r from-primary-50 to-primary-100 text-primary-700 shadow-inner":"text-slate-500 hover:text-slate-900"),children:[Fe.jsx(a,{size:18}),Fe.jsx("span",{className:"hidden sm:inline",children:e.nome})]},e.id)})}),"perfil"===t&&Fe.jsxs("div",{className:"card",children:[Fe.jsxs("div",{className:"border-b border-slate-100 pb-4 mb-6",children:[Fe.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400 mb-1",children:"Perfil"}),Fe.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Dados Pessoais"})]}),Fe.jsxs("form",{onSubmit:async e=>{e.preventDefault(),d(!0);const t={nome:h.nome,email:h.email,telefone:h.telefone,especialidade:h.especialidade,crm:h.crm};try{const e=await ji(t);S(e?.usuario||t),p.success(ar("update","Perfil",{suffix:"!"})),N()}catch(s){Rr(s,"Erro ao atualizar perfil")}finally{d(!1)}},className:"space-y-4",children:[Fe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"Nome Completo"}),Fe.jsx("input",{type:"text",className:"input",value:h.nome,onChange:e=>f({...h,nome:e.target.value}),required:!0})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"E-mail"}),Fe.jsx("input",{type:"email",className:"input",value:h.email,onChange:e=>f({...h,email:e.target.value}),required:!0})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"Telefone"}),Fe.jsx("input",{type:"tel",className:"input",value:h.telefone,onChange:e=>f({...h,telefone:e.target.value})})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"Especialidade"}),Fe.jsx("input",{type:"text",className:"input",value:h.especialidade,onChange:e=>f({...h,especialidade:e.target.value})})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"CRM"}),Fe.jsx("input",{type:"text",className:"input",value:h.crm,onChange:e=>f({...h,crm:e.target.value})})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"UF do CRM"}),Fe.jsx("input",{type:"text",className:"input",maxLength:"2",value:h.crmUf,onChange:e=>f({...h,crmUf:e.target.value.toUpperCase()})})]})]}),Fe.jsxs("button",{type:"submit",className:"btn btn-primary flex items-center gap-2 disabled:opacity-60",disabled:o,children:[Fe.jsx(ie,{size:18}),o?"Salvando...":"Salvar Alterações"]})]})]}),"empresa"===t&&"admin"===e?.role&&Fe.jsxs("div",{className:"card",children:[Fe.jsxs("div",{className:"border-b border-slate-100 pb-4 mb-6",children:[Fe.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400 mb-1",children:"Organização"}),Fe.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Dados da Empresa"})]}),v&&Fe.jsx("p",{className:"text-sm text-slate-400 mb-4",children:"Carregando dados cadastrados..."}),Fe.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),"admin"===e?.role){m(!0);try{await wi.updateMyCompany(g),p.success("Dados da empresa atualizados!"),w()}catch(s){Rr(s,"Erro ao atualizar empresa")}finally{m(!1)}}},className:"space-y-4",children:[Fe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"Nome da Empresa"}),Fe.jsx("input",{type:"text",className:"input",value:g.nome,onChange:e=>j({...g,nome:e.target.value}),disabled:v,required:!0})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"CNPJ"}),Fe.jsx("input",{type:"text",className:"input",value:g.cnpj,onChange:e=>j({...g,cnpj:e.target.value}),disabled:v,required:!0})]}),Fe.jsxs("div",{className:"md:col-span-2",children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"Endereço"}),Fe.jsx("input",{type:"text",className:"input",value:g.endereco,onChange:e=>j({...g,endereco:e.target.value}),disabled:v})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"Telefone"}),Fe.jsx("input",{type:"tel",className:"input",value:g.telefone,onChange:e=>j({...g,telefone:e.target.value}),disabled:v})]})]}),Fe.jsxs("button",{type:"submit",className:"btn btn-primary flex items-center gap-2 disabled:opacity-60",disabled:c||v,children:[Fe.jsx(ie,{size:18}),c?"Salvando...":"Salvar Alterações"]})]})]}),"seguranca"===t&&Fe.jsxs("div",{className:"card",children:[Fe.jsxs("div",{className:"border-b border-slate-100 pb-4 mb-6",children:[Fe.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400 mb-1",children:"Segurança"}),Fe.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Alterar Senha"})]}),Fe.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),!e?.id)return void p.error("Usuário não identificado");const s=t.currentTarget,a=s.senhaAtual.value,r=s.novaSenha.value;if(r===s.confirmaSenha.value)try{u(!0),await bi(e.id,a,r),p.success("Senha alterada com sucesso!"),s.reset()}catch(i){Rr(i,"Erro ao alterar senha")}finally{u(!1)}else p.error(ir("passwordMismatch"))},className:"space-y-4 max-w-md",children:[Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"Senha Atual"}),Fe.jsx("input",{type:"password",name:"senhaAtual",required:!0,className:"input"})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"Nova Senha"}),Fe.jsx("input",{type:"password",name:"novaSenha",required:!0,minLength:"6",className:"input"})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"Confirmar Nova Senha"}),Fe.jsx("input",{type:"password",name:"confirmaSenha",required:!0,minLength:"6",className:"input"})]}),Fe.jsxs("button",{type:"submit",className:"btn btn-primary flex items-center gap-2 disabled:opacity-60",disabled:x,children:[Fe.jsx(b,{size:18}),x?"Atualizando...":"Alterar Senha"]})]})]}),"notificacoes"===t&&Fe.jsxs("div",{className:"card",children:[Fe.jsxs("div",{className:"border-b border-slate-100 pb-4 mb-6",children:[Fe.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400 mb-1",children:"Alertas"}),Fe.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Preferências de Notificações"})]}),Fe.jsxs("div",{className:"space-y-4",children:[Fe.jsxs("label",{className:"flex items-center gap-3 p-3 hover:bg-gray-50 rounded-lg cursor-pointer",children:[Fe.jsx("input",{type:"checkbox",defaultChecked:!0,className:"rounded text-primary-600"}),Fe.jsx("span",{className:"text-gray-700",children:"Receber e-mails sobre novas prescrições"})]}),Fe.jsxs("label",{className:"flex items-center gap-3 p-3 hover:bg-gray-50 rounded-lg cursor-pointer",children:[Fe.jsx("input",{type:"checkbox",defaultChecked:!0,className:"rounded text-primary-600"}),Fe.jsx("span",{className:"text-gray-700",children:"Notificar sobre novos pacientes"})]}),Fe.jsxs("label",{className:"flex items-center gap-3 p-3 hover:bg-gray-50 rounded-lg cursor-pointer",children:[Fe.jsx("input",{type:"checkbox",className:"rounded text-primary-600"}),Fe.jsx("span",{className:"text-gray-700",children:"Lembretes de consultas"})]}),Fe.jsxs("label",{className:"flex items-center gap-3 p-3 hover:bg-gray-50 rounded-lg cursor-pointer",children:[Fe.jsx("input",{type:"checkbox",className:"rounded text-primary-600"}),Fe.jsx("span",{className:"text-gray-700",children:"Atualizações do sistema"})]}),Fe.jsxs("button",{className:"btn btn-primary flex items-center gap-2 mt-6",children:[Fe.jsx(ie,{size:18}),"Salvar Preferências"]})]})]})]})}const Di=async(e={},t={})=>Ma("/agendamentos",{...t,params:e}),Ti=async e=>Ua("/agendamentos",e),_i=async(e,t)=>Va(`/agendamentos/${e}`,t),Li=async e=>Ga(`/agendamentos/${e}`);function $i(){const[e,t]=i.useState([]),[s,a]=i.useState(1),[r,n]=i.useState(0),[l,o]=i.useState(10),[d,c]=i.useState([]),[m,x]=i.useState(!0),[p,u]=i.useState(""),[h,b]=i.useState(!1),[f,g]=i.useState(null),[j,v]=i.useState(null),[y,N]=i.useState(null),[w,k]=i.useState(""),[A,E]=i.useState(null),[P,D]=i.useState(!1),[T,_]=i.useState({tipo:"Compromisso",titulo:"",data:"",horario:"",participante:"",pacienteId:"",local:"",descricao:""});i.useEffect(()=>{L(),$()},[s]);const L=async()=>{try{x(!0);const e=await Di({page:s,pageSize:l});Array.isArray(e)?(t(e),n(e.length)):(t(Array.isArray(e.items)?e.items:[]),n(Number(e.total)||0),o(Number(e.pageSize)||10))}catch(e){Rr(e,"Erro ao carregar agendamentos"),t([])}finally{x(!1)}},$=async()=>{try{const e=await Sr();c(Array.isArray(e)?e:[])}catch(e){c([])}},O=e=>{const t=e.dataHora?new Date(e.dataHora):new Date,s=t.toISOString().split("T")[0],a=t.toTimeString().split(" ")[0].substring(0,5),r=d.find(t=>t.id===e.pacienteId);_({tipo:e.tipo||"Compromisso",titulo:e.titulo||"",data:s,horario:a,participante:e.participante||r?.nome||"",pacienteId:e.pacienteId||"",local:e.local||"",descricao:e.observacoes||""}),r&&(E(r),k(r.nome)),g(e.id||e._id),b(!0)},M=async(e,t)=>{if(window.confirm(`Deseja realmente excluir "${t}"?`))try{v(e),await Li(e),le.success("Agendamento excluído com sucesso!"),L()}catch(s){Rr(s,"Erro ao excluir agendamento")}finally{v(null)}},U=()=>{_({tipo:"Compromisso",titulo:"",data:"",horario:"",participante:"",pacienteId:"",local:"",descricao:""}),g(null),k(""),E(null),D(!1)},H=(e="Compromisso")=>{U(),_(t=>({...t,tipo:e})),b(!0)},Q=e=>{switch(e){case"Consulta":return Fe.jsx(oe,{size:18});case"Reunião":return Fe.jsx(S,{size:18});case"Exame":return Fe.jsx(C,{size:18});default:return Fe.jsx(R,{size:18})}},W=e=>{if(!e)return"Data não informada";try{const t=new Date(e);return isNaN(t.getTime())?"Data inválida":t.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"})}catch(t){return"Data inválida"}},K=e=>{if(!e)return"--:--";try{const t=new Date(e);return isNaN(t.getTime())?"--:--":t.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}catch(t){return"--:--"}},Y=e.filter(e=>e.titulo.toLowerCase().includes(p.toLowerCase())||e.participante?.toLowerCase().includes(p.toLowerCase())),X={total:e.length,confirmados:e.filter(e=>"confirmado"===e.status).length,pendentes:e.filter(e=>"agendado"===e.status).length,hoje:e.filter(e=>{const t=new Date(e.dataHora),s=new Date;return t.getDate()===s.getDate()&&t.getMonth()===s.getMonth()&&t.getFullYear()===s.getFullYear()}).length},Z=async(e,t,s)=>{if(t!==s)try{N(e),await _i(e,{status:s}),le.success("Status atualizado com sucesso!"),L()}catch(a){le.error("Erro ao atualizar status")}finally{N(null)}};return Fe.jsxs("div",{className:"space-y-8",children:[Fe.jsx(yr,{label:"Institucional",title:"Agenda",subtitle:"Gerencie consultas, reuniões e compromissos da instituição de forma centralizada.",children:Fe.jsxs("div",{className:"flex flex-col sm:flex-row w-full lg:w-auto gap-3",children:[Fe.jsxs("button",{onClick:()=>H("Reunião"),className:"btn btn-secondary flex items-center justify-center gap-2",children:[Fe.jsx(S,{size:18})," Nova Reunião"]}),Fe.jsxs("button",{type:"button",onClick:()=>{try{const e=new Date,t="\n        body { font-family: Arial, sans-serif; padding: 20px; }\n        h1 { color: #2563eb; border-bottom: 2px solid #2563eb; padding-bottom: 10px; }\n        .meta { color: #6b7280; font-size: 12px; margin-top: 6px; }\n        table { width: 100%; border-collapse: collapse; margin-top: 16px; }\n        th, td { padding: 10px 12px; text-align: left; border-bottom: 1px solid #e5e7eb; vertical-align: top; }\n        th { background: #f9fafb; font-weight: 600; color: #374151; }\n        .badge { display: inline-block; padding: 2px 8px; border-radius: 999px; font-size: 12px; font-weight: 600; }\n        .confirmado { background: #d1fae5; color: #065f46; }\n        .agendado { background: #fef3c7; color: #92400e; }\n        .realizado { background: #e0f2fe; color: #075985; }\n        @media print { body { padding: 0; } }\n      ",s=Y.map(e=>{e.id||e._id;const t=d.find(t=>(t.id||t._id)===e.pacienteId),s=e.participante||t?.nome||"-",a=(e.status||"agendado").toLowerCase(),r="confirmado"===a?"confirmado":"realizado"===a?"realizado":"agendado";return`\n            <tr>\n              <td>${Vr(W(e.dataHora))} ${Vr(K(e.dataHora))}</td>\n              <td>${Vr(e.tipo||"-")}</td>\n              <td>${Vr(e.titulo||"-")}</td>\n              <td>${Vr(s)}</td>\n              <td>${Vr(e.local||"-")}</td>\n              <td><span class="badge ${r}">${Vr(e.status||"Agendado")}</span></td>\n            </tr>\n          `}).join("");Gr({title:"Relatório - Agenda",bodyHtml:`\n        <h1>Relatório - Agenda</h1>\n        <div class="meta">Gerado em: ${Vr(e.toLocaleDateString("pt-BR"))} às ${Vr(e.toLocaleTimeString("pt-BR"))}</div>\n        <div class="meta">Registros: ${Vr(Y.length)}</div>\n        <table>\n          <thead>\n            <tr>\n              <th>Data/Hora</th>\n              <th>Tipo</th>\n              <th>Título</th>\n              <th>Participante/Paciente</th>\n              <th>Local</th>\n              <th>Status</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${s}\n          </tbody>\n        </table>\n      `,styles:t}),le.success("Abrindo visualização para impressão/PDF")}catch(e){le.error("Erro ao gerar PDF")}},disabled:0===Y.length,className:"btn btn-secondary flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",title:"Exportar para PDF",children:[Fe.jsx(G,{size:18})," Exportar PDF"]}),Fe.jsxs("button",{onClick:()=>H("Compromisso"),className:"btn btn-primary flex items-center justify-center gap-2 shadow-lg shadow-primary-600/20",children:[Fe.jsx(V,{size:18})," Novo Compromisso"]})]})}),Fe.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6",children:[Fe.jsx(Nr,{icon:R,label:"Total",value:X.total,description:"Agendamentos futuros",color:"primary"}),Fe.jsx(Nr,{icon:J,label:"Confirmados",value:X.confirmados,description:"Confirmados",color:"emerald"}),Fe.jsx(Nr,{icon:F,label:"Pendentes",value:X.pendentes,description:"Aguardando confirmação",color:"orange"}),Fe.jsx(Nr,{icon:z,label:"Hoje",value:X.hoje,description:"Eventos para hoje",color:"purple"})]}),Fe.jsx(Dr,{searchTerm:p,onSearchChange:u,placeholder:"Buscar por título ou participante..."}),Fe.jsx($r,{title:"Agendamentos",children:m?Fe.jsx("div",{className:"flex justify-center py-12",children:Fe.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):Y.length>0?Fe.jsxs(Fe.Fragment,{children:[Fe.jsx(Or,{children:Y.map(e=>Fe.jsxs(qr,{children:[Fe.jsxs("div",{className:"flex items-start justify-between",children:[Fe.jsxs("div",{className:"flex items-center gap-3",children:[Fe.jsx("div",{className:"p-2 rounded-lg "+("Consulta"===e.tipo?"bg-blue-50 text-blue-600":"Reunião"===e.tipo?"bg-purple-50 text-purple-600":"Exame"===e.tipo?"bg-amber-50 text-amber-600":"bg-primary-50 text-primary-600"),children:Q(e.tipo)}),Fe.jsxs("div",{children:[Fe.jsx("p",{className:"font-semibold text-slate-900 dark:text-gray-100",children:e.titulo}),Fe.jsx("p",{className:"text-xs text-slate-500 dark:text-gray-400",children:e.tipo}),Fe.jsxs("p",{className:"text-[10px] text-slate-400 mt-0.5",children:["Código: ",e.id||e._id]})]})]}),Fe.jsxs("select",{value:e.status,onChange:t=>Z(e.id||e._id,e.status,t.target.value),disabled:y===(e.id||e._id),className:"text-xs font-bold px-2 py-1 rounded-full border-none focus:ring-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed "+("agendado"===e.status?"bg-primary-50 text-primary-700":"confirmado"===e.status?"bg-emerald-50 text-emerald-700":"cancelado"===e.status?"bg-red-50 text-red-700":"bg-slate-100 text-slate-700"),children:[Fe.jsx("option",{value:"agendado",children:"Agendado"}),Fe.jsx("option",{value:"confirmado",children:"Confirmado"}),Fe.jsx("option",{value:"cancelado",children:"Cancelado"}),Fe.jsx("option",{value:"concluido",children:"Concluído"})]})]}),Fe.jsxs("div",{className:"mt-3 space-y-2 text-sm",children:[Fe.jsxs("div",{className:"flex items-center gap-2 text-slate-600 dark:text-gray-300",children:[Fe.jsx(z,{size:14}),Fe.jsxs("span",{children:[W(e.dataHora)," às ",K(e.dataHora)]})]}),e.participante?Fe.jsxs("div",{className:"flex items-center gap-2 text-slate-600 dark:text-gray-300",children:[Fe.jsx(I,{size:14}),Fe.jsx("span",{children:e.participante})]}):Fe.jsxs("div",{className:"flex items-center gap-2 text-slate-400 dark:text-gray-500",children:[Fe.jsx(I,{size:14}),Fe.jsx("span",{className:"italic",children:"Sem participante"})]}),e.local&&Fe.jsxs("div",{className:"flex items-center gap-2 text-slate-600 dark:text-gray-300",children:[Fe.jsx(B,{size:14}),Fe.jsx("span",{children:e.local})]})]}),Fe.jsxs("div",{className:"flex items-center justify-end gap-2 mt-3",children:[Fe.jsx(Lr,{onClick:()=>O(e),icon:ne,variant:"primary",tooltip:"Editar",title:"Editar agendamento",ariaLabel:"Editar agendamento"}),Fe.jsx(Lr,{onClick:()=>M(e.id||e._id,e.titulo),icon:te,variant:"danger",tooltip:"Excluir",title:"Excluir agendamento",ariaLabel:"Excluir agendamento",disabled:j===(e.id||e._id),loading:j===(e.id||e._id)})]})]},e.id||e._id))}),Fe.jsxs(Ir,{children:[Fe.jsx(Fr,{columns:["Tipo","Título","Data/Hora","Participante","Local","Status","Ações"]}),Fe.jsx(Br,{children:Y.map(e=>Fe.jsxs(Mr,{children:[Fe.jsx(Ur,{children:Fe.jsxs("div",{className:"flex items-center gap-2 text-slate-700 dark:text-gray-200 font-medium",children:[Fe.jsx("div",{className:"p-2 rounded-lg "+("Consulta"===e.tipo?"bg-blue-50 text-blue-600":"Reunião"===e.tipo?"bg-purple-50 text-purple-600":"Exame"===e.tipo?"bg-amber-50 text-amber-600":"bg-primary-50 text-primary-600"),children:Q(e.tipo)}),Fe.jsx("span",{className:"text-sm",children:e.tipo})]})}),Fe.jsx(Ur,{children:Fe.jsxs("div",{className:"flex flex-col",children:[Fe.jsx("span",{className:"font-semibold text-slate-900 dark:text-gray-100",children:e.titulo}),Fe.jsxs("span",{className:"text-[11px] text-slate-400",children:["Código: ",e.id||e._id]})]})}),Fe.jsx(Ur,{children:Fe.jsxs("div",{className:"flex flex-col",children:[Fe.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-gray-200",children:W(e.dataHora)}),Fe.jsx("span",{className:"text-xs text-slate-500 dark:text-gray-400",children:K(e.dataHora)})]})}),Fe.jsx(Ur,{children:e.participante?Fe.jsxs("div",{className:"flex items-center gap-2",children:[Fe.jsx("div",{className:"w-6 h-6 rounded-full bg-slate-100 dark:bg-gray-700 flex items-center justify-center text-slate-500 dark:text-gray-300 text-xs font-bold",children:e.participante.charAt(0).toUpperCase()}),Fe.jsx("span",{className:"text-sm text-slate-600 dark:text-gray-300",children:e.participante})]}):Fe.jsx("span",{className:"text-slate-400 dark:text-gray-500 text-sm italic",children:"Sem participante"})}),Fe.jsx(Ur,{children:e.local?Fe.jsxs("div",{className:"flex items-center gap-2 text-slate-600 dark:text-gray-300",children:[Fe.jsx(B,{size:14,className:"text-slate-400"}),Fe.jsx("span",{className:"text-sm",children:e.local})]}):Fe.jsx("span",{className:"text-slate-400 dark:text-gray-500 text-sm",children:"-"})}),Fe.jsx(Ur,{children:Fe.jsxs("select",{value:e.status,onChange:t=>Z(e.id||e._id,e.status,t.target.value),disabled:y===(e.id||e._id),className:"text-xs font-bold px-3 py-1 rounded-full border-none focus:ring-2 focus:ring-primary-500 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed "+("agendado"===e.status?"bg-primary-50 text-primary-700 ring-1 ring-primary-100":"confirmado"===e.status?"bg-emerald-50 text-emerald-700 ring-1 ring-emerald-100":"cancelado"===e.status?"bg-red-50 text-red-700 ring-1 ring-red-100":"bg-slate-100 text-slate-700 ring-1 ring-slate-200"),children:[Fe.jsx("option",{value:"agendado",children:"Agendado"}),Fe.jsx("option",{value:"confirmado",children:"Confirmado"}),Fe.jsx("option",{value:"cancelado",children:"Cancelado"}),Fe.jsx("option",{value:"concluido",children:"Concluído"})]})}),Fe.jsx(Ur,{className:"text-right",children:Fe.jsxs("div",{className:"flex items-center justify-end gap-2",children:[Fe.jsx(Lr,{onClick:()=>O(e),icon:ne,variant:"primary",tooltip:"Editar",title:"Editar agendamento",ariaLabel:"Editar agendamento"}),Fe.jsx(Lr,{onClick:()=>M(e.id||e._id,e.titulo),icon:te,variant:"danger",tooltip:"Excluir",title:"Excluir agendamento",ariaLabel:"Excluir agendamento",disabled:j===(e.id||e._id),loading:j===(e.id||e._id)})]})})]},e.id||e._id))})]})]}):Fe.jsx("div",{className:"p-8",children:Fe.jsx(Tr,{icon:R,title:"Nenhum agendamento encontrado",description:"Nenhum agendamento encontrado."})})}),h&&Fe.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/60 backdrop-blur-sm p-4",children:Fe.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] flex flex-col overflow-hidden animate-in fade-in zoom-in duration-200",children:[Fe.jsxs("div",{className:"px-6 py-5 border-b border-slate-100 dark:border-gray-700 flex justify-between items-start bg-slate-50/50 dark:bg-gray-700/50",children:[Fe.jsxs("div",{children:[Fe.jsx("h3",{className:"font-bold text-xl text-slate-800 dark:text-gray-100",children:f?"Editar Agendamento":"Novo Agendamento"}),Fe.jsx("p",{className:"text-sm text-slate-500 dark:text-gray-400 mt-1",children:"Preencha os dados do compromisso."})]}),Fe.jsx("button",{onClick:()=>b(!1),className:"text-slate-400 hover:text-slate-600 dark:hover:text-gray-300 p-1 hover:bg-slate-100 dark:hover:bg-gray-600 rounded-lg transition",children:Fe.jsx(q,{size:24})})]}),Fe.jsxs("form",{className:"overflow-y-auto p-6 space-y-5 custom-scrollbar",onSubmit:async e=>{e.preventDefault();try{const e=JSON.parse(localStorage.getItem("user")||"{}"),t=e?.empresaId||"",s=T.data&&T.horario?new Date(`${T.data}T${T.horario}:00`).toISOString():"";let a=T.pacienteId;if(a&&""!==a||!A||!A.id||(a=A.id),!a)return void le.error("Selecione um paciente da lista!");if(!t)return void le.error("Empresa não encontrada no usuário logado!");if(!T.titulo)return void le.error("Título é obrigatório!");if(!s)return void le.error("Data e horário obrigatórios!");const r={titulo:T.titulo,tipo:T.tipo,pacienteId:a,empresaId:t,local:T.local,observacoes:T.descricao,dataHora:s};f?(await _i(f,r),le.success("Agendamento atualizado com sucesso!")):(await Ti(r),le.success("Agendamento criado com sucesso!")),b(!1),U(),L()}catch(t){Rr(t,"Erro ao salvar agendamento")}},children:[Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-gray-300 mb-1.5",children:"Tipo"}),Fe.jsxs("select",{className:"input w-full",value:T.tipo,onChange:e=>_({...T,tipo:e.target.value}),children:[Fe.jsx("option",{children:"Compromisso"}),Fe.jsx("option",{children:"Reunião"}),Fe.jsx("option",{children:"Consulta"}),Fe.jsx("option",{children:"Exame"}),Fe.jsx("option",{children:"Outro"})]})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-gray-300 mb-1.5",children:"Título *"}),Fe.jsx("input",{type:"text",required:!0,className:"input w-full",placeholder:"Título do compromisso",value:T.titulo,onChange:e=>_({...T,titulo:e.target.value})})]}),Fe.jsxs("div",{className:"grid grid-cols-2 gap-5",children:[Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-gray-300 mb-1.5",children:"Data *"}),Fe.jsx("input",{type:"date",required:!0,className:"input w-full",value:T.data,onChange:e=>_({...T,data:e.target.value})})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-gray-300 mb-1.5",children:"Horário *"}),Fe.jsx("input",{type:"time",required:!0,className:"input w-full",value:T.horario,onChange:e=>_({...T,horario:e.target.value})})]})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-gray-300 mb-1.5",children:"Paciente/Residente *"}),Fe.jsxs("div",{className:"relative",children:[Fe.jsx(I,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 z-10",size:18}),Fe.jsx("input",{type:"text",className:"input w-full pl-10 pr-10",placeholder:"Buscar residente cadastrado...",value:w,onChange:e=>{k(e.target.value),D(!0),""===e.target.value&&(E(null),_({...T,pacienteId:"",participante:""}))},onFocus:()=>D(!0),onBlur:()=>{setTimeout(()=>D(!1),200)},required:!0}),A&&Fe.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 flex items-center",children:Fe.jsx(J,{size:18,className:"text-green-500"})}),P&&w&&Fe.jsx("div",{className:"absolute left-0 right-0 top-full mt-1 bg-white dark:bg-gray-800 border border-slate-200 dark:border-gray-600 rounded-lg shadow-xl z-20 max-h-72 overflow-y-auto",children:0===d.length?Fe.jsxs("div",{className:"px-4 py-6 text-center",children:[Fe.jsx(F,{className:"mx-auto mb-2 text-slate-400",size:24}),Fe.jsx("p",{className:"text-sm text-slate-500 dark:text-gray-400",children:"Nenhum residente cadastrado"})]}):Fe.jsxs(Fe.Fragment,{children:[d.filter(e=>e.nome.toLowerCase().includes(w.toLowerCase())||e.cpf?.includes(w)).map(e=>Fe.jsx("div",{className:"px-4 py-3 cursor-pointer hover:bg-primary-50 dark:hover:bg-gray-700 transition-colors border-b border-slate-100 dark:border-gray-700 last:border-0 "+(A?.id===e.id?"bg-primary-100 dark:bg-gray-700":""),onClick:()=>{E(e),_({...T,pacienteId:e.id,participante:e.nome}),k(e.nome),D(!1)},children:Fe.jsxs("div",{className:"flex items-center gap-3",children:[Fe.jsx("div",{className:"w-10 h-10 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center text-primary-600 dark:text-primary-300 font-bold text-sm flex-shrink-0",children:e.nome.split(" ").map(e=>e[0]).join("").substring(0,2).toUpperCase()}),Fe.jsxs("div",{className:"flex-1 min-w-0",children:[Fe.jsx("p",{className:"font-medium text-slate-700 dark:text-gray-200 truncate",children:e.nome}),Fe.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.cpf&&Fe.jsxs("span",{className:"text-xs text-slate-500 dark:text-gray-400",children:["CPF: ",e.cpf]}),e.idade&&Fe.jsxs("span",{className:"text-xs text-slate-500 dark:text-gray-400",children:["• ",e.idade," anos"]})]})]})]})},e.id)),0===d.filter(e=>e.nome.toLowerCase().includes(w.toLowerCase())||e.cpf?.includes(w)).length&&Fe.jsxs("div",{className:"px-4 py-6 text-center",children:[Fe.jsx(F,{className:"mx-auto mb-2 text-slate-400",size:24}),Fe.jsx("p",{className:"text-sm text-slate-500 dark:text-gray-400 mb-1",children:"Nenhum residente encontrado"}),Fe.jsx("p",{className:"text-xs text-slate-400 dark:text-gray-500",children:"Tente buscar por nome ou CPF"})]})]})})]}),A&&Fe.jsx("div",{className:"mt-2 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:Fe.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[Fe.jsx(J,{size:16,className:"text-green-600 dark:text-green-400 flex-shrink-0"}),Fe.jsxs("span",{className:"font-medium text-green-700 dark:text-green-300",children:["Residente selecionado: ",A.nome]})]})})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-gray-300 mb-1.5",children:"Local"}),Fe.jsxs("div",{className:"relative",children:[Fe.jsx(B,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:18}),Fe.jsx("input",{type:"text",className:"input w-full pl-10",placeholder:"Local do evento",value:T.local,onChange:e=>_({...T,local:e.target.value})})]})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-gray-300 mb-1.5",children:"Descrição"}),Fe.jsx("textarea",{className:"input w-full min-h-[100px] py-3",placeholder:"Detalhes adicionais...",value:T.descricao,onChange:e=>_({...T,descricao:e.target.value})})]}),Fe.jsxs("div",{className:"pt-4 flex gap-3 border-t border-slate-100 dark:border-gray-700 mt-2",children:[Fe.jsx("button",{type:"button",onClick:()=>b(!1),className:"btn btn-secondary flex-1 py-2.5",children:"Cancelar"}),Fe.jsx("button",{type:"submit",className:"btn btn-primary flex-1 py-2.5 shadow-lg shadow-primary-500/20",children:f?"Salvar Alterações":"Agendar"})]})]})]})}),Fe.jsxs("div",{className:"flex items-center justify-between gap-3",children:[Fe.jsxs("div",{className:"text-sm text-slate-600",children:["Página ",Fe.jsx("span",{className:"font-semibold",children:s})]}),Fe.jsxs("div",{className:"flex gap-2",children:[Fe.jsx("button",{className:"btn btn-secondary",disabled:s<=1,onClick:()=>a(e=>Math.max(1,e-1)),children:"Anterior"}),Fe.jsx("button",{className:"btn btn-secondary",disabled:s*l>=r&&r>0,onClick:()=>a(e=>e+1),children:"Próxima"})]})]})]})}function Oi(){const{user:e}=Ya(),[t,s]=i.useState("todos"),[a,r]=i.useState(""),[n,l]=i.useState(1),[o,d]=i.useState(10),[c,m]=i.useState(!0),[x,u]=i.useState(!1),[h,b]=i.useState([]);i.useEffect(()=>{f()},[e?.role]),i.useEffect(()=>_a(()=>{l(1),f()}),[e?.role]),i.useEffect(()=>{l(1)},[t,a,o]);const f=async()=>{try{m(!0);const t=new Date,s=new Date;s.setDate(t.getDate()+30);const a={dataInicio:t.toISOString(),dataFim:s.toISOString()},r=(e,t)=>{const s=t?`${t.codigo?`${t.codigo} - `:""}${t.nome||"Empresa"}`:null;return(Array.isArray(e)?e:[]).map(e=>{const t=e.dataHora||e.dataHoraInicio||e.dataHoraFim||e.createdAt,a=t?new Date(t):new Date,r=!isNaN(a.getTime());return{id:e.id||e._id,type:"Consulta"===e.tipo?"consultas":"Exame"===e.tipo?"exames":"outros",originalType:e.tipo,title:e.titulo,subtitle:e.participante||"Sem participante",date:r?a:new Date,status:e.status,details:e.local,source:"agendamento",empresaLabel:s}})},i=(e,t)=>{const s=t?`${t.codigo?`${t.codigo} - `:""}${t.nome||"Empresa"}`:null;return(Array.isArray(e)?e:[]).map(e=>{const t=e.dataEmissao||e.createdAt||(new Date).toISOString(),a=new Date(t),r=!isNaN(a.getTime());return{id:e.id||e._id,type:"medicacoes",originalType:"Medicação",title:`Prescrição: ${e.medicamentos?.[0]?.nome||"Medicamentos diversos"}`,subtitle:e.pacienteNome||e.pacienteId?.nome||"Paciente não identificado",date:r?a:new Date,status:e.status,details:`${e.medicamentos?.length||0} ${1===e.medicamentos?.length?"medicamento":"medicamentos"}`,source:"prescricao",empresaLabel:s}})};if(za(e)){p.loading("Carregando cronograma de todas as empresas...",{id:"cronograma-load-all"});const e=await La(),t=await Promise.all(e.map(async e=>{const t=Da(e.id),[s,r]=await Promise.all([Di(a,t),oi({status:"ativa"},t)]),i=r||{};return{empresa:e,agendamentosList:Array.isArray(s)?s:Array.isArray(s?.items)?s.items:[],listaPrescricoes:Array.isArray(i)?i:Array.isArray(i?.items)?i.items:Array.isArray(i?.prescricoes)?i.prescricoes:[]}})),s=t.flatMap(e=>[...r(e.agendamentosList,e.empresa),...i(e.listaPrescricoes,e.empresa)]).sort((e,t)=>new Date(t.date)-new Date(e.date));return b(s),void p.dismiss("cronograma-load-all")}const[n,l]=await Promise.all([Di(a),oi({status:"ativa"})]),o=Array.isArray(n)?n:Array.isArray(n?.items)?n.items:[],d=r(o,null),c=l||{},x=Array.isArray(c)?c:Array.isArray(c?.items)?c.items:Array.isArray(c?.prescricoes)?c.prescricoes:[],u=i(x,null),h=[...d,...u].sort((e,t)=>new Date(t.date)-new Date(e.date));b(h)}catch(t){p.dismiss("cronograma-load-all");const{handleApiError:e}=await Ea(async()=>{const{handleApiError:e}=await Promise.resolve().then(()=>zr);return{handleApiError:e}},void 0);e(t,rr("load","cronograma"))}finally{m(!1)}},g=i.useMemo(()=>{const e=String(a||"").trim().toLowerCase();return h.filter(s=>{if(!("todos"===t||s.type===t||"consultas"===t&&"outros"===s.type))return!1;if(!e)return!0;const a=String(s.title||"").toLowerCase(),r=String(s.subtitle||"").toLowerCase();return a.includes(e)||r.includes(e)})},[h,t,a]),j=g.length,v=Math.max(1,Math.ceil(j/o));i.useEffect(()=>{l(e=>Math.min(e,v))},[v]);const y=i.useMemo(()=>{const e=(n-1)*o;return g.slice(e,e+o)},[g,n,o]),N=[{id:"todos",label:"Todos",icon:R},{id:"medicacoes",label:"Medicações",icon:Z},{id:"consultas",label:"Consultas",icon:oe},{id:"exames",label:"Exames",icon:C}],w={total:h.length,consultas:h.filter(e=>"consultas"===e.type).length,exames:h.filter(e=>"exames"===e.type).length,medicacoes:h.filter(e=>"medicacoes"===e.type).length};return Fe.jsxs("div",{className:"space-y-8",children:[Fe.jsx(yr,{label:"Rotina",title:"Cronograma",subtitle:"Acompanhe a linha do tempo de medicações, consultas e exames dos residentes.",children:Fe.jsxs("div",{className:"flex flex-col sm:flex-row w-full lg:w-auto gap-3",children:[Fe.jsxs("button",{type:"button",onClick:()=>u(!x),className:"btn btn-secondary flex items-center justify-center gap-2 "+(x?"bg-slate-100":""),children:[Fe.jsx(de,{size:18}),Fe.jsx("span",{className:"hidden sm:inline",children:"Legendas"})]}),Fe.jsxs("button",{type:"button",onClick:()=>{try{const e=new Date,t="\n        body { font-family: Arial, sans-serif; padding: 20px; }\n        h1 { color: #2563eb; border-bottom: 2px solid #2563eb; padding-bottom: 10px; }\n        .meta { color: #6b7280; font-size: 12px; margin-top: 6px; }\n        table { width: 100%; border-collapse: collapse; margin-top: 16px; }\n        th, td { padding: 10px 12px; text-align: left; border-bottom: 1px solid #e5e7eb; vertical-align: top; }\n        th { background: #f9fafb; font-weight: 600; color: #374151; }\n        .badge { display: inline-block; padding: 2px 8px; border-radius: 999px; font-size: 12px; font-weight: 600; }\n        .medicacoes { background: #ede9fe; color: #5b21b6; }\n        .consultas { background: #dbeafe; color: #1d4ed8; }\n        .exames { background: #fef3c7; color: #92400e; }\n        .outros { background: #f1f5f9; color: #334155; }\n        @media print { body { padding: 0; } }\n      ",s=g.map(e=>{const t=e.type||"outros",s=e.date?new Date(e.date):null,a=s&&!isNaN(s.getTime())?s.toLocaleDateString("pt-BR"):"-",r=s&&!isNaN(s.getTime())?s.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}):"--:--";return`\n            <tr>\n              <td>${Vr(a)} ${Vr(r)}</td>\n              <td><span class="badge ${Vr(t)}">${Vr(e.originalType||e.type||"-")}</span></td>\n              <td>${Vr(e.title||"-")}</td>\n              <td>${Vr(e.subtitle||"-")}</td>\n              <td>${Vr(e.details||"-")}</td>\n            </tr>\n          `}).join("");Gr({title:"Relatório - Cronograma",bodyHtml:`\n        <h1>Relatório - Cronograma</h1>\n        <div class="meta">Gerado em: ${Vr(e.toLocaleDateString("pt-BR"))} às ${Vr(e.toLocaleTimeString("pt-BR"))}</div>\n        <div class="meta">Registros: ${Vr(g.length)}</div>\n        <table>\n          <thead>\n            <tr>\n              <th>Data/Hora</th>\n              <th>Tipo</th>\n              <th>Título</th>\n              <th>Participante</th>\n              <th>Detalhes</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${s}\n          </tbody>\n        </table>\n      `,styles:t}),p.success("Abrindo visualização para impressão/PDF")}catch(e){p.error("Erro ao gerar PDF")}},disabled:0===g.length,className:"btn btn-secondary flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",title:"Exportar para PDF",children:[Fe.jsx(G,{size:18})," Exportar PDF"]})]})}),Fe.jsxs("div",{className:"flex items-center justify-between gap-3",children:[Fe.jsxs("div",{className:"text-sm text-slate-600",children:["Página ",Fe.jsx("span",{className:"font-semibold",children:n})," de ",Fe.jsx("span",{className:"font-semibold",children:v})]}),Fe.jsxs("div",{className:"flex gap-2",children:[Fe.jsx("button",{className:"btn btn-secondary",disabled:n<=1,onClick:()=>l(e=>Math.max(1,e-1)),children:"Anterior"}),Fe.jsx("button",{className:"btn btn-secondary",disabled:n>=v,onClick:()=>l(e=>Math.min(v,e+1)),children:"Próxima"})]})]}),Fe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[Fe.jsx(Nr,{icon:R,label:"Total",value:w.total,description:"Eventos agendados",color:"primary"}),Fe.jsx(Nr,{icon:oe,label:"Consultas",value:w.consultas,description:"Consultas médicas",color:"blue"}),Fe.jsx(Nr,{icon:Z,label:"Medicações",value:w.medicacoes,description:"Prescrições ativas",color:"purple"}),Fe.jsx(Nr,{icon:C,label:"Exames",value:w.exames,description:"Exames marcados",color:"orange"})]}),Fe.jsxs("div",{className:"card p-4 flex flex-col md:flex-row gap-4 items-center justify-between",children:[Fe.jsx("div",{className:"flex p-1 bg-slate-100 rounded-xl w-full md:w-auto overflow-x-auto",children:N.map(e=>{const a=e.icon,r=t===e.id;return Fe.jsxs("button",{onClick:()=>s(e.id),className:`\n                  flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-bold transition-all whitespace-nowrap\n                  ${r?"bg-white text-primary-600 shadow-sm":"text-slate-500 hover:text-slate-700 hover:bg-slate-200/50"}\n                `,children:[Fe.jsx(a,{size:16}),e.label]},e.id)})}),Fe.jsxs("div",{className:"relative w-full md:w-96",children:[Fe.jsx(U,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:20}),Fe.jsx("input",{type:"text",placeholder:"Buscar por título ou participante...",className:"w-full pl-10 pr-4 py-2 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition",value:a,onChange:e=>r(e.target.value)})]})]}),x&&Fe.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3 p-4 bg-slate-50 rounded-2xl border border-slate-100 animate-in slide-in-from-top-2",children:[Fe.jsxs("div",{className:"flex items-center gap-2",children:[Fe.jsx("div",{className:"w-2 h-2 bg-slate-400 rounded-full"}),Fe.jsx("span",{className:"text-xs text-slate-600",children:"Agendado"})]}),Fe.jsxs("div",{className:"flex items-center gap-2",children:[Fe.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),Fe.jsx("span",{className:"text-xs text-slate-600",children:"Próximo (3 dias)"})]}),Fe.jsxs("div",{className:"flex items-center gap-2",children:[Fe.jsx("div",{className:"w-2 h-2 bg-amber-500 rounded-full"}),Fe.jsx("span",{className:"text-xs text-slate-600",children:"Amanhã"})]}),Fe.jsxs("div",{className:"flex items-center gap-2",children:[Fe.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),Fe.jsx("span",{className:"text-xs text-slate-600",children:"Hoje/Atrasado"})]}),Fe.jsxs("div",{className:"flex items-center gap-2",children:[Fe.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full"}),Fe.jsx("span",{className:"text-xs text-slate-600",children:"Realizado"})]})]}),Fe.jsx("div",{className:"space-y-4",children:c?Fe.jsx("div",{className:"flex justify-center py-12",children:Fe.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):0===g.length?Fe.jsxs("div",{className:"card text-center py-16",children:[Fe.jsx("div",{className:"w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-4",children:Fe.jsx(R,{size:32,className:"text-slate-300"})}),Fe.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Nenhum item encontrado"}),Fe.jsx("p",{className:"text-slate-500 max-w-xs mx-auto mt-1",children:"Não há agendamentos ou prescrições para os filtros selecionados."})]}):Fe.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:y.map(e=>{const t=((e,t,s)=>{if("concluido"===t||"realizado"===t)return{label:"Realizado",color:"bg-emerald-100 text-emerald-700 border-emerald-200",dot:"bg-emerald-500"};if("medicacoes"===s)return{label:"Em Uso",color:"bg-primary-100 text-primary-700 border-primary-200",dot:"bg-primary-500"};const a=new Date;a.setHours(0,0,0,0);const r=new Date(e);r.setHours(0,0,0,0);const i=r-a,n=Math.ceil(i/864e5);return n<0?{label:"Atrasado",color:"bg-red-100 text-red-700 border-red-200",dot:"bg-red-500"}:0===n?{label:"Hoje",color:"bg-red-100 text-red-700 border-red-200",dot:"bg-red-500"}:1===n?{label:"Amanhã",color:"bg-amber-100 text-amber-800 border-amber-200",dot:"bg-amber-500"}:n<=3?{label:"Próximo",color:"bg-blue-100 text-blue-700 border-blue-200",dot:"bg-blue-500"}:{label:"Agendado",color:"bg-slate-100 text-slate-700 border-slate-200",dot:"bg-slate-400"}})(e.date,e.status,e.type),s=e.date&&!isNaN(e.date.getTime());return Fe.jsxs("div",{className:"group bg-white p-4 rounded-2xl border border-slate-100 shadow-sm hover:shadow-md transition-all duration-200 flex flex-col",children:[Fe.jsxs("div",{className:"flex items-center justify-between mb-3",children:[Fe.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-slate-50 rounded-lg border border-slate-100",children:[Fe.jsx("span",{className:"text-xl font-bold text-slate-800 leading-none",children:s?e.date.getDate():"NaN"}),Fe.jsx("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:s?e.date.toLocaleDateString("pt-BR",{month:"short"}):""})]}),Fe.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[10px] font-bold border ${t.color}`,children:[Fe.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${t.dot}`}),t.label]})]}),Fe.jsx("div",{className:"mb-2",children:Fe.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wider "+("medicacoes"===e.type?"bg-purple-50 text-purple-700":"consultas"===e.type?"bg-blue-50 text-blue-700":"bg-slate-100 text-slate-600"),children:["medicacoes"===e.type?Fe.jsx(Z,{size:10}):"consultas"===e.type?Fe.jsx(oe,{size:10}):Fe.jsx(C,{size:10}),e.originalType]})}),Fe.jsx("h4",{className:"text-base font-bold text-slate-900 mb-3 line-clamp-2 group-hover:text-primary-700 transition-colors min-h-[3rem]",children:e.title}),Fe.jsxs("div",{className:"space-y-2 mt-auto",children:[Fe.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[Fe.jsx(I,{size:14,className:"text-slate-400 shrink-0"}),Fe.jsx("span",{className:"truncate",children:e.subtitle})]}),Fe.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[Fe.jsx(z,{size:14,className:"text-slate-400 shrink-0"}),Fe.jsx("span",{children:s?e.date.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}):"Invalid Date"})]}),e.details&&Fe.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[Fe.jsx(B,{size:14,className:"text-slate-400 shrink-0"}),Fe.jsx("span",{className:"truncate",children:e.details})]}),e.empresaLabel&&Fe.jsxs("div",{className:"text-[11px] text-slate-400 truncate",title:e.empresaLabel,children:["Empresa: ",e.empresaLabel]}),Fe.jsxs("div",{className:"text-[11px] text-slate-400",children:["Código: ",e.id]})]})]},`${e.source}-${e.id}`)})})})]})}const qi=async(e={},t={})=>Ma("/estoque/medicamentos",{...t,params:e}),Ii=async e=>Ua("/estoque/medicamentos",e),Fi=async e=>Ua("/estoque/medicamentos/movimentacao",e),Bi=async(e={},t={})=>Ma("/estoque/alimentos",{...t,params:e}),Mi=async e=>Ua("/estoque/alimentos",e),Ui=async e=>Ua("/estoque/alimentos/movimentacao",e),Vi=async(e={})=>Ma("/estoque/stats",e),Gi=async(e="",t={})=>Ma(e?`/estoque/movimentacoes?tipo=${e}`:"/estoque/movimentacoes",t);function Hi(e,t=";"){return Array.isArray(e)&&0!==e.length?e.map(e=>function(e,t=";"){if(null==e)return"";const s=String(e);return s.includes('"')||s.includes("\n")||s.includes("\r")||s.includes(t)?`"${s.replaceAll('"','""')}"`:s}(e,t)).join(t):""}function Ji({filename:e,lines:t,delimiter:s=";",includeBom:a=!0}={}){if(!e)throw new Error("Nome do arquivo é obrigatório");const r=function(e,t=";"){return Array.isArray(e)?e.map(e=>Hi(e,t)).join("\n"):""}(t,s),i=new Blob([a?"\ufeff":"",r],{type:"text/csv;charset=utf-8;"}),n=URL.createObjectURL(i),l=document.createElement("a");l.setAttribute("href",n),l.setAttribute("download",e),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(n)}function Qi(){const[e,t]=i.useState("medicamentos"),[s,a]=i.useState(null),[r,n]=i.useState([]),[l,o]=i.useState(1),[d,c]=i.useState(0),[m,x]=i.useState(10),[u,h]=i.useState(null),[b,f]=i.useState([]),[g,j]=i.useState(!1),[v,y]=i.useState(!1),[N,w]=i.useState(""),[S,C]=i.useState({}),[k,A]=i.useState({quantidade:"",motivo:"",observacao:""});i.useEffect(()=>{E(),P()},[e,l]);const E=async()=>{y(!0);try{const t={page:l,pageSize:m},s="medicamentos"===e?await qi(t):await Bi(t);if(Array.isArray(s))n(s),c(s.length);else{const e=Array.isArray(s.items)?s.items:s.medicamentos||s.alimentos||[];n(e),c(Number(s.total)||0),x(Number(s.pageSize)||10)}}catch(t){const{handleApiError:e}=await Ea(async()=>{const{handleApiError:e}=await Promise.resolve().then(()=>zr);return{handleApiError:e}},void 0);e(t,rr("load","itens"))}finally{y(!1)}},P=async()=>{try{const e=await Vi();h(e)}catch(e){}},z=async t=>{t.preventDefault();try{"medicamentos"===e?await Ii(S):await Mi(S),p.success("Cadastrado com sucesso!"),_(),E()}catch(s){const{handleApiError:e}=await Ea(async()=>{const{handleApiError:e}=await Promise.resolve().then(()=>zr);return{handleApiError:e}},void 0);e(s,rr("create","item"))}},D=async t=>{t.preventDefault();try{const t={...k,tipo:s,["medicamentos"===e?"medicamentoId":"alimentoId"]:k.itemId};"medicamentos"===e?await Fi(t):await Ui(t),p.success("Movimentação registrada!"),_(),E()}catch(a){const{handleApiError:e}=await Ea(async()=>{const{handleApiError:e}=await Promise.resolve().then(()=>zr);return{handleApiError:e}},void 0);e(a,rr("save","movimentação"))}},_=()=>{a(null),C({}),A({quantidade:"",motivo:"",observacao:""})},L=r.filter(e=>e.nome.toLowerCase().includes(N.toLowerCase())),$={total:r.length,baixoEstoque:r.filter(e=>e.quantidade<=(e.quantidadeMinima||0)).length,vencendo:r.filter(e=>{if(!e.validade)return!1;const t=new Date(e.validade)-new Date,s=Math.ceil(t/864e5);return s>0&&s<=30}).length,categorias:new Set(r.map(e=>e.categoria||"Geral")).size};return Fe.jsxs("div",{className:"space-y-8",children:[Fe.jsx(yr,{label:"Logística",title:"Controle de Estoque",subtitle:"Gerencie o inventário de medicamentos e alimentos, registre entradas e saídas.",children:Fe.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[Fe.jsxs("div",{className:"flex items-center gap-2",children:[Fe.jsxs("button",{onClick:()=>{try{const t="medicamentos"===e?"Medicamentos":"Alimentos",s=new Date,a="\n        body { font-family: Arial, sans-serif; padding: 20px; }\n        h1 { color: #2563eb; border-bottom: 2px solid #2563eb; padding-bottom: 10px; }\n        .stats { display: flex; gap: 20px; margin: 20px 0; flex-wrap: wrap; }\n        .stat-card { border: 1px solid #e5e7eb; padding: 15px; border-radius: 8px; flex: 1; min-width: 180px; }\n        .stat-label { color: #6b7280; font-size: 12px; text-transform: uppercase; }\n        .stat-value { font-size: 24px; font-weight: bold; margin: 8px 0; }\n        table { width: 100%; border-collapse: collapse; margin-top: 20px; }\n        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #e5e7eb; }\n        th { background: #f9fafb; font-weight: 600; color: #374151; }\n        .baixo-estoque { color: #dc2626; font-weight: 600; }\n        .ok { color: #059669; }\n        @media print { body { padding: 0; } }\n      ",r=L.map(e=>{const t=e.quantidade<=(e.quantidadeMinima||0),s=e.validade?new Date(e.validade).toLocaleDateString("pt-BR"):"-";return`\n            <tr>\n              <td>${Vr(e.nome)}</td>\n              <td>${Vr(e.categoria||"Geral")}</td>\n              <td class="${t?"baixo-estoque":"ok"}">${Vr(e.quantidade)} ${Vr(e.unidade||"")}</td>\n              <td>${Vr(e.quantidadeMinima||"-")}</td>\n              <td>${Vr(s)}</td>\n              <td>${t?'<span class="baixo-estoque">⚠️ Baixo</span>':'<span class="ok">✓ OK</span>'}</td>\n            </tr>\n          `}).join("");Gr({title:`Relatório de Estoque - ${t} - Prescrimed`,styles:a,bodyHtml:`\n        <h1>Relatório de Estoque - ${Vr(t)}</h1>\n        <p>Gerado em: ${Vr(s.toLocaleDateString("pt-BR"))} às ${Vr(s.toLocaleTimeString("pt-BR"))}</p>\n\n        <div class="stats">\n          <div class="stat-card">\n            <div class="stat-label">Total de Itens</div>\n            <div class="stat-value">${Vr($.total)}</div>\n          </div>\n          <div class="stat-card">\n            <div class="stat-label">Baixo Estoque</div>\n            <div class="stat-value" style="color: #dc2626">${Vr($.baixoEstoque)}</div>\n          </div>\n          <div class="stat-card">\n            <div class="stat-label">Vencendo (30 dias)</div>\n            <div class="stat-value" style="color: #d97706">${Vr($.vencendo)}</div>\n          </div>\n          <div class="stat-card">\n            <div class="stat-label">Categorias</div>\n            <div class="stat-value">${Vr($.categorias)}</div>\n          </div>\n        </div>\n        \n        <table>\n          <thead>\n            <tr>\n              <th>Nome</th>\n              <th>Categoria</th>\n              <th>Quantidade</th>\n              <th>Qtd. Mínima</th>\n              <th>Validade</th>\n              <th>Status</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${r}\n          </tbody>\n        </table>\n      `}),p.success("Abrindo visualização para impressão/PDF")}catch(t){p.error("Erro ao gerar PDF")}},disabled:0===L.length,className:"group relative px-3 py-2.5 bg-white border-2 border-red-500 text-red-600 hover:bg-red-500 hover:text-white rounded-lg transition-all duration-200 shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",title:"Exportar para PDF","aria-label":"Exportar relatório em PDF",children:[Fe.jsx(G,{size:18}),Fe.jsx("span",{className:"hidden lg:inline font-medium text-sm",children:"PDF"}),Fe.jsx("span",{className:"absolute -top-8 left-1/2 -translate-x-1/2 px-2 py-1 text-xs font-medium text-white bg-slate-800 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap",children:"Exportar PDF"})]}),Fe.jsxs("button",{onClick:()=>{try{const t="medicamentos"===e?"Medicamentos":"Alimentos",s=["Nome","Categoria","Quantidade","Unidade","Qtd. Mínima","Validade","Lote","Fabricante"],a=L.map(e=>[e.nome,e.categoria||"Geral",e.quantidade,e.unidade||"",e.quantidadeMinima||"",e.validade?new Date(e.validade).toLocaleDateString("pt-BR"):"",e.lote||"",e.fabricante||""]),r=[[`RELATÓRIO DE ESTOQUE - ${t.toUpperCase()}`],["Gerado em:",(new Date).toLocaleString("pt-BR")],[],["RESUMO"],["Total de Itens",$.total],["Baixo Estoque",$.baixoEstoque],["Vencendo (30 dias)",$.vencendo],["Categorias Diferentes",$.categorias],[],["ITENS DO ESTOQUE"],s,...a];Ji({filename:`estoque_${e}_${(new Date).toISOString().split("T")[0]}.csv`,lines:r}),p.success("Arquivo Excel exportado com sucesso")}catch(t){p.error("Erro ao exportar para Excel")}},disabled:0===L.length,className:"group relative px-3 py-2.5 bg-white border-2 border-emerald-500 text-emerald-600 hover:bg-emerald-500 hover:text-white rounded-lg transition-all duration-200 shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",title:"Exportar para Excel","aria-label":"Exportar relatório em Excel",children:[Fe.jsx(ce,{size:18}),Fe.jsx("span",{className:"hidden lg:inline font-medium text-sm",children:"Excel"}),Fe.jsx("span",{className:"absolute -top-8 left-1/2 -translate-x-1/2 px-2 py-1 text-xs font-medium text-white bg-slate-800 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap",children:"Exportar Excel"})]})]}),Fe.jsx("div",{className:"hidden md:block w-px h-8 bg-slate-200"}),Fe.jsxs("button",{onClick:async()=>{try{const e=await Gi();f(e.movimentacoes||[]),j(!0)}catch(e){const{handleApiError:t}=await Ea(async()=>{const{handleApiError:e}=await Promise.resolve().then(()=>zr);return{handleApiError:e}},void 0);t(e,rr("load","histórico"))}},className:"btn bg-slate-50 text-slate-700 hover:bg-slate-100 border-slate-200 flex items-center gap-2 px-3 py-2.5 rounded-lg font-semibold transition-all text-sm",children:[Fe.jsx(me,{size:18})," ",Fe.jsx("span",{className:"hidden sm:inline",children:"Histórico"})]}),Fe.jsxs("button",{onClick:()=>a("entrada"),className:"btn bg-emerald-50 text-emerald-700 hover:bg-emerald-100 border-emerald-200 flex items-center gap-2 px-3 py-2.5 rounded-lg font-semibold transition-all text-sm",children:[Fe.jsx(xe,{size:18})," ",Fe.jsx("span",{className:"hidden sm:inline",children:"Entrada"})]}),Fe.jsxs("button",{onClick:()=>a("saida"),className:"btn bg-red-50 text-red-700 hover:bg-red-100 border-red-200 flex items-center gap-2 px-3 py-2.5 rounded-lg font-semibold transition-all text-sm",children:[Fe.jsx(pe,{size:18})," ",Fe.jsx("span",{className:"hidden sm:inline",children:"Saída"})]}),Fe.jsxs("button",{onClick:()=>a("cadastrar"),className:"btn bg-primary-600 text-white hover:bg-primary-700 shadow-lg shadow-primary-600/20 flex items-center gap-2 px-3 py-2.5 rounded-lg font-semibold transition-all text-sm",children:[Fe.jsx(V,{size:18})," ",Fe.jsx("span",{className:"hidden sm:inline",children:"Novo"})]})]})}),Fe.jsxs("div",{className:"flex items-center justify-between gap-3",children:[Fe.jsxs("div",{className:"text-sm text-slate-600",children:["Página ",Fe.jsx("span",{className:"font-semibold",children:l})]}),Fe.jsxs("div",{className:"flex gap-2",children:[Fe.jsx("button",{className:"btn btn-secondary",disabled:l<=1,onClick:()=>o(e=>Math.max(1,e-1)),children:"Anterior"}),Fe.jsx("button",{className:"btn btn-secondary",disabled:l*m>=d&&d>0,onClick:()=>o(e=>e+1),children:"Próxima"})]})]}),u&&Fe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[Fe.jsx(Nr,{icon:T,label:"Total de Itens",value:u.totalItens||0,description:`${u.totalMedicamentos??0} med. + ${u.totalAlimentos??0} alim.`,color:"primary"}),Fe.jsx(Nr,{icon:O,label:"Baixo Estoque",value:u.baixoEstoque||0,description:"Itens precisando reposição",color:"red"}),Fe.jsx(Nr,{icon:R,label:"Vencendo",value:u.vencendo||0,description:"Nos próximos 30 dias",color:"amber"}),Fe.jsx(Nr,{icon:me,label:"Movimentações",value:u.movimentacoesRecentes||0,description:"Últimos 30 dias",color:"emerald"})]}),Fe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[Fe.jsx(Nr,{icon:T,label:"Total",value:$.total,description:"Itens cadastrados",color:"primary"}),Fe.jsx(Nr,{icon:O,label:"Baixo Estoque",value:$.baixoEstoque,description:"Itens precisando reposição",color:"red"}),Fe.jsx(Nr,{icon:R,label:"Vencendo",value:$.vencendo,description:"Nos próximos 30 dias",color:"orange"}),Fe.jsx(Nr,{icon:me,label:"Categorias",value:$.categorias,description:"Tipos de itens",color:"purple"})]}),Fe.jsx(Dr,{searchTerm:N,onSearchChange:w,placeholder:`Buscar ${e}...`,children:Fe.jsxs("div",{className:"flex bg-slate-100 p-1 rounded-xl w-full md:w-auto",children:[Fe.jsxs("button",{onClick:()=>t("medicamentos"),className:"flex items-center gap-2 px-6 py-2.5 rounded-lg text-sm font-bold transition-all "+("medicamentos"===e?"bg-white text-primary-600 shadow-sm":"text-slate-500 hover:text-slate-700"),children:[Fe.jsx(Z,{size:16})," Medicamentos"]}),Fe.jsxs("button",{onClick:()=>t("alimentos"),className:"flex items-center gap-2 px-6 py-2.5 rounded-lg text-sm font-bold transition-all "+("alimentos"===e?"bg-white text-green-600 shadow-sm":"text-slate-500 hover:text-slate-700"),children:[Fe.jsx(ue,{size:16})," Alimentos"]})]})}),Fe.jsx($r,{title:"Estoque de "+("medicamentos"===e?"Medicamentos":"Alimentos"),children:v?Fe.jsx("div",{className:"flex justify-center py-12",children:Fe.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):L.length>0?Fe.jsxs(Fe.Fragment,{children:[Fe.jsx(Or,{children:L.map(t=>{const s=t.quantidade<=t.quantidadeMinima;return Fe.jsxs(qr,{children:[Fe.jsxs("div",{className:"flex items-start justify-between",children:[Fe.jsxs("div",{className:"flex items-center gap-3",children:[Fe.jsx("div",{className:"p-2 rounded-lg "+("medicamentos"===e?"bg-primary-50 text-primary-600":"bg-green-50 text-green-600"),children:"medicamentos"===e?Fe.jsx(Z,{size:18}):Fe.jsx(ue,{size:18})}),Fe.jsxs("div",{children:[Fe.jsx("p",{className:"font-bold text-slate-800 dark:text-gray-100",children:t.nome}),Fe.jsxs("p",{className:"text-[10px] text-slate-400",children:["Código: ",t.id||t._id]}),Fe.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-slate-500 dark:text-gray-400",children:[t.lote&&Fe.jsxs("span",{children:["Lote: ",t.lote]}),t.categoria&&Fe.jsxs("span",{children:["Cat: ",t.categoria]})]})]})]}),s?Fe.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-red-50 text-red-700 text-xs font-bold border border-red-100",children:[Fe.jsx(O,{size:12})," Baixo"]}):Fe.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-emerald-50 text-emerald-700 text-xs font-bold border border-emerald-100",children:[Fe.jsx(J,{size:12})," OK"]})]}),Fe.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-2 text-sm",children:[Fe.jsxs("div",{children:[Fe.jsx("span",{className:"text-slate-500 dark:text-gray-400 text-xs block",children:"Qtd."}),Fe.jsx("span",{className:"font-bold "+(s?"text-red-600":"text-slate-700 dark:text-gray-200"),children:t.quantidade})]}),Fe.jsxs("div",{children:[Fe.jsx("span",{className:"text-slate-500 dark:text-gray-400 text-xs block",children:"Unidade"}),Fe.jsx("span",{className:"text-slate-600 dark:text-gray-300 font-medium",children:t.unidade})]}),Fe.jsxs("div",{children:[Fe.jsx("span",{className:"text-slate-500 dark:text-gray-400 text-xs block",children:"Validade"}),Fe.jsx("span",{className:"text-slate-600 dark:text-gray-300 font-medium",children:t.validade?new Date(t.validade).toLocaleDateString("pt-BR"):"-"})]})]}),Fe.jsx("div",{className:"mt-3 flex justify-end",children:Fe.jsx("button",{className:"text-slate-400 hover:text-primary-600 font-medium text-sm transition",children:"Detalhes"})})]},t._id)})}),Fe.jsxs(Ir,{children:[Fe.jsx(Fr,{columns:["Item","Quantidade","Unidade","Validade","Status","Ações"]}),Fe.jsx(Br,{children:L.map(t=>{const s=t.quantidade<=t.quantidadeMinima;return Fe.jsxs(Mr,{children:[Fe.jsx(Ur,{children:Fe.jsxs("div",{className:"flex items-center gap-3",children:[Fe.jsx("div",{className:"p-2 rounded-lg "+("medicamentos"===e?"bg-primary-50 text-primary-600":"bg-green-50 text-green-600"),children:"medicamentos"===e?Fe.jsx(Z,{size:18}):Fe.jsx(ue,{size:18})}),Fe.jsxs("div",{children:[Fe.jsx("span",{className:"font-bold text-slate-800 dark:text-gray-100 block",children:t.nome}),Fe.jsxs("span",{className:"text-[11px] text-slate-400 block",children:["Código: ",t.id||t._id]}),t.lote&&Fe.jsxs("span",{className:"text-xs text-slate-500 dark:text-gray-400",children:["Lote: ",t.lote]}),t.categoria&&Fe.jsxs("span",{className:"text-xs text-slate-500 dark:text-gray-400",children:["Cat: ",t.categoria]})]})]})}),Fe.jsx(Ur,{children:Fe.jsx("span",{className:"font-bold text-lg "+(s?"text-red-600":"text-slate-700 dark:text-gray-200"),children:t.quantidade})}),Fe.jsx(Ur,{children:Fe.jsx("span",{className:"text-sm text-slate-500 dark:text-gray-400 bg-slate-100 dark:bg-gray-800 px-2 py-1 rounded-md font-medium",children:t.unidade})}),Fe.jsx(Ur,{className:"text-sm text-slate-600 dark:text-gray-300",children:t.validade?new Date(t.validade).toLocaleDateString("pt-BR"):"-"}),Fe.jsx(Ur,{children:s?Fe.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-red-50 text-red-700 text-xs font-bold border border-red-100",children:[Fe.jsx(O,{size:12})," Baixo Estoque"]}):Fe.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-emerald-50 text-emerald-700 text-xs font-bold border border-emerald-100",children:[Fe.jsx(J,{size:12})," Normal"]})}),Fe.jsx(Ur,{className:"text-right",children:Fe.jsx("button",{className:"text-slate-400 hover:text-primary-600 font-medium text-sm transition",children:"Detalhes"})})]},t._id)})})]})]}):Fe.jsx("div",{className:"p-8",children:Fe.jsx(Tr,{icon:T,title:"Nenhum item encontrado",description:"Nenhum item encontrado no estoque."})})}),(()=>{if(!s)return null;const t="medicamentos"===e,a="entrada"===s||"saida"===s;return Fe.jsx("div",{className:"fixed inset-0 bg-slate-900/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:Fe.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[Fe.jsxs("div",{className:"p-6 border-b border-slate-100 flex justify-between items-center sticky top-0 bg-white z-[51]",children:[Fe.jsxs("h3",{className:"text-xl font-bold text-slate-800 flex items-center gap-2",children:["cadastrar"===s&&Fe.jsx(V,{className:"text-primary-600"}),"entrada"===s&&Fe.jsx(xe,{className:"text-emerald-600"}),"saida"===s&&Fe.jsx(pe,{className:"text-red-600"}),"cadastrar"===s?"Novo "+(t?"Medicamento":"Alimento"):"entrada"===s?"Registrar Entrada":"Registrar Saída"]}),Fe.jsx("button",{onClick:_,className:"p-2 hover:bg-slate-100 rounded-full transition-colors",children:Fe.jsx(q,{size:20,className:"text-slate-400"})})]}),Fe.jsx("div",{className:"p-6",children:a?Fe.jsxs("form",{onSubmit:D,className:"space-y-4",children:[Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Selecione o Item"}),Fe.jsxs("select",{required:!0,className:"w-full p-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none",onChange:e=>A({...k,itemId:e.target.value}),value:k.itemId||"",children:[Fe.jsx("option",{value:"",children:"Selecione..."}),r.map(e=>Fe.jsxs("option",{value:e._id,children:[e.nome," (Atual: ",e.quantidade," ",e.unidade,")"]},e._id))]})]}),Fe.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Quantidade"}),Fe.jsx("input",{required:!0,type:"number",min:"1",className:"w-full p-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary-500 outline-none",value:k.quantidade,onChange:e=>A({...k,quantidade:e.target.value})})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Motivo"}),Fe.jsxs("select",{required:!0,className:"w-full p-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary-500 outline-none",onChange:e=>A({...k,motivo:e.target.value}),value:k.motivo||"",children:[Fe.jsx("option",{value:"",children:"Selecione..."}),"entrada"===s?Fe.jsxs(Fe.Fragment,{children:[Fe.jsx("option",{value:"Compra",children:"Compra"}),Fe.jsx("option",{value:"Doação",children:"Doação"}),Fe.jsx("option",{value:"Ajuste",children:"Ajuste de Estoque"})]}):Fe.jsxs(Fe.Fragment,{children:[Fe.jsx("option",{value:"Uso",children:"Uso/Consumo"}),Fe.jsx("option",{value:"Vencimento",children:"Vencimento/Descarte"}),Fe.jsx("option",{value:"Ajuste",children:"Ajuste de Estoque"})]})]})]})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Observação (Opcional)"}),Fe.jsx("textarea",{className:"w-full p-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary-500 outline-none",rows:"3",value:k.observacao,onChange:e=>A({...k,observacao:e.target.value})})]}),Fe.jsxs("div",{className:"pt-4 flex justify-end gap-3",children:[Fe.jsx("button",{type:"button",onClick:_,className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg font-medium",children:"Cancelar"}),Fe.jsxs("button",{type:"submit",className:"px-6 py-2 rounded-lg font-bold text-white shadow-lg transition-all transform hover:-translate-y-0.5 "+("entrada"===s?"bg-emerald-600 hover:bg-emerald-700 shadow-emerald-600/20":"bg-red-600 hover:bg-red-700 shadow-red-600/20"),children:["Confirmar ","entrada"===s?"Entrada":"Saída"]})]})]}):Fe.jsxs("form",{onSubmit:z,className:"space-y-4",children:[Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Nome do Item"}),Fe.jsx("input",{required:!0,type:"text",className:"w-full p-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary-500 outline-none",onChange:e=>C({...S,nome:e.target.value})})]}),Fe.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Unidade"}),Fe.jsxs("select",{required:!0,className:"w-full p-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary-500 outline-none",onChange:e=>C({...S,unidade:e.target.value}),defaultValue:"",children:[Fe.jsx("option",{value:"",disabled:!0,children:"Selecione"}),t?Fe.jsxs(Fe.Fragment,{children:[Fe.jsx("option",{value:"comprimido",children:"Comprimido"}),Fe.jsx("option",{value:"caixa",children:"Caixa"}),Fe.jsx("option",{value:"frasco",children:"Frasco"}),Fe.jsx("option",{value:"ml",children:"ml"}),Fe.jsx("option",{value:"ampola",children:"Ampola"})]}):Fe.jsxs(Fe.Fragment,{children:[Fe.jsx("option",{value:"kg",children:"Kg"}),Fe.jsx("option",{value:"litro",children:"Litro"}),Fe.jsx("option",{value:"unidade",children:"Unidade"}),Fe.jsx("option",{value:"pacote",children:"Pacote"}),Fe.jsx("option",{value:"lata",children:"Lata"})]})]})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Qtd. Inicial"}),Fe.jsx("input",{type:"number",className:"w-full p-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary-500 outline-none",onChange:e=>C({...S,quantidade:e.target.value})})]})]}),Fe.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Qtd. Mínima (Alerta)"}),Fe.jsx("input",{type:"number",className:"w-full p-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary-500 outline-none",onChange:e=>C({...S,quantidadeMinima:e.target.value})})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Validade"}),Fe.jsx("input",{type:"date",className:"w-full p-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary-500 outline-none",onChange:e=>C({...S,validade:e.target.value})})]})]}),t?Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Lote"}),Fe.jsx("input",{type:"text",className:"w-full p-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary-500 outline-none",onChange:e=>C({...S,lote:e.target.value})})]}):Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Categoria"}),Fe.jsxs("select",{className:"w-full p-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary-500 outline-none",onChange:e=>C({...S,categoria:e.target.value}),children:[Fe.jsx("option",{value:"Geral",children:"Geral"}),Fe.jsx("option",{value:"Perecível",children:"Perecível"}),Fe.jsx("option",{value:"Não Perecível",children:"Não Perecível"}),Fe.jsx("option",{value:"Bebida",children:"Bebida"})]})]}),Fe.jsxs("div",{className:"pt-4 flex justify-end gap-3",children:[Fe.jsx("button",{type:"button",onClick:_,className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg font-medium",children:"Cancelar"}),Fe.jsx("button",{type:"submit",className:"px-6 py-2 bg-primary-600 text-white rounded-lg font-bold hover:bg-primary-700 shadow-lg shadow-primary-600/20 transition-all transform hover:-translate-y-0.5",children:"Salvar Cadastro"})]})]})})]})})})(),g&&Fe.jsx("div",{className:"fixed inset-0 bg-slate-900/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4",children:Fe.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col",children:[Fe.jsxs("div",{className:"p-6 border-b border-slate-100 flex justify-between items-center",children:[Fe.jsxs("div",{children:[Fe.jsxs("h3",{className:"text-xl font-bold text-slate-800 flex items-center gap-2",children:[Fe.jsx(me,{className:"text-primary-600"}),"Histórico de Movimentações"]}),Fe.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Últimas 50 movimentações registradas"})]}),Fe.jsx("button",{onClick:()=>j(!1),className:"p-2 hover:bg-slate-100 rounded-full transition-colors",children:Fe.jsx(q,{size:20,className:"text-slate-400"})})]}),Fe.jsx("div",{className:"p-6 overflow-y-auto flex-1",children:b.length>0?Fe.jsx("div",{className:"overflow-x-auto",children:Fe.jsxs("table",{className:"w-full",children:[Fe.jsx("thead",{className:"bg-slate-50 border-b border-slate-100",children:Fe.jsxs("tr",{children:[Fe.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-slate-500 uppercase",children:"Data"}),Fe.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-slate-500 uppercase",children:"Tipo"}),Fe.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-slate-500 uppercase",children:"Item"}),Fe.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-slate-500 uppercase",children:"Qtd"}),Fe.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-slate-500 uppercase",children:"Motivo"}),Fe.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-slate-500 uppercase",children:"Usuário"})]})}),Fe.jsx("tbody",{className:"divide-y divide-slate-100",children:b.map(e=>Fe.jsxs("tr",{className:"hover:bg-slate-50/50 transition",children:[Fe.jsx("td",{className:"px-4 py-3 text-sm text-slate-600 whitespace-nowrap",children:new Date(e.data).toLocaleString("pt-BR")}),Fe.jsx("td",{className:"px-4 py-3",children:Fe.jsx("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-bold "+("entrada"===e.tipo?"bg-emerald-50 text-emerald-700":"bg-red-50 text-red-700"),children:"entrada"===e.tipo?Fe.jsxs(Fe.Fragment,{children:[Fe.jsx(xe,{size:12})," Entrada"]}):Fe.jsxs(Fe.Fragment,{children:[Fe.jsx(pe,{size:12})," Saída"]})})}),Fe.jsxs("td",{className:"px-4 py-3 text-sm font-medium text-slate-900",children:[e.itemNome,Fe.jsxs("span",{className:"ml-2 text-xs text-slate-500",children:["(",e.itemTipo,")"]})]}),Fe.jsxs("td",{className:"px-4 py-3 text-sm font-bold text-slate-700",children:["entrada"===e.tipo?"+":"-",e.quantidade]}),Fe.jsx("td",{className:"px-4 py-3 text-sm text-slate-600",children:e.motivo}),Fe.jsx("td",{className:"px-4 py-3 text-sm text-slate-600",children:e.usuarioNome})]},e._id))})]})}):Fe.jsxs("div",{className:"text-center py-12",children:[Fe.jsx(me,{size:48,className:"mx-auto text-slate-300 mb-3"}),Fe.jsx("p",{className:"text-slate-500",children:"Nenhuma movimentação encontrada"})]})})]})})]})}const Wi=async(e={},t={})=>Ma("/enfermagem",{...t,params:e}),Ki=async(e,t={})=>Ua("/enfermagem",e,t),Yi=async(e,t={})=>Ga(`/enfermagem/${e}`,t),Xi=async(e={})=>Ma("/enfermagem/stats/dashboard",e);function Zi(){const{user:e}=Ya(),[t,s]=i.useState([]),[a,r]=i.useState(1),[n,l]=i.useState(0),[o,d]=i.useState(10),[c,m]=i.useState([]),[x,u]=i.useState(!0),[h,b]=i.useState(""),[f,g]=i.useState(!1),[j,v]=i.useState(null),[y,N]=i.useState(null),[w,k]=i.useState([]),[A,P]=i.useState([]),[R,z]=i.useState({registrosHoje:0,pacientesComRegistro:0,riscoQueda:0,alertasCriticos:0}),[D,T]=i.useState({pacienteId:"",tipo:"evolucao",titulo:"",descricao:"",estadoGeral:"bom",riscoQueda:"",riscoLesao:"",alerta:!1,prioridade:"baixa",observacoes:"",pa:"",fc:"",fr:"",temp:"",sato2:"",glicemia:""}),[L,$]=i.useState({});i.useEffect(()=>{B(),M(),U(),H()},[a,e?.role]),i.useEffect(()=>_a(()=>{r(1),B(),M(),U(),H()}),[e?.role]);const B=async()=>{try{u(!0);if(za(e)){p.loading("Carregando evolução de todas as empresas...",{id:"evolucao-load-all"});const e=await La(),t=Math.max(a*o,o),r=await Promise.all((e||[]).map(async e=>{const s=Da(e.id),a=await Wi({page:1,pageSize:t},s),r=Array.isArray(a)?a:Array.isArray(a?.items)?a.items:[];return{empresa:e,items:r,total:Array.isArray(a)?a.length:Number(a?.total)||r.length}})),i=r.flatMap(({empresa:e,items:t})=>{const s=e?`${e.codigo?`${e.codigo} - `:""}${e.nome||"Empresa"}`:null;return(t||[]).map(t=>({...t,__empresaId:e?.id,empresaLabel:s}))}).sort((e,t)=>new Date(t.createdAt||0)-new Date(e.createdAt||0)),n=r.reduce((e,t)=>e+(Number(t.total)||0),0),d=(a-1)*o,c=i.slice(d,d+o);return s(c),l(n),void p.dismiss("evolucao-load-all")}const t=await Wi({page:a,pageSize:o});Array.isArray(t)?(s(t),l(t.length)):(s(Array.isArray(t.items)?t.items:[]),l(Number(t.total)||0),d(Number(t.pageSize)||10))}catch(t){p.dismiss("evolucao-load-all");const{handleApiError:e}=await Ea(async()=>{const{handleApiError:e}=await Promise.resolve().then(()=>zr);return{handleApiError:e}},void 0);e(t,rr("load","registros"))}finally{u(!1)}},M=async()=>{try{if(za(e)){const e=await La(),t=(await Promise.all((e||[]).map(async e=>{const t=Da(e.id),s=await Sr("",t),a=Array.isArray(s)?s:s?.pacientes||s?.items||[];return{empresa:e,pacientes:Array.isArray(a)?a:[]}}))).flatMap(({empresa:e,pacientes:t})=>{const s=e?`${e.codigo?`${e.codigo} - `:""}${e.nome||"Empresa"}`:null;return(t||[]).map(t=>({...t,__empresaId:e?.id,empresaLabel:s}))});return void m(t)}const t=await Sr(),s=Array.isArray(t)?t:t.pacientes||[];m(s)}catch(t){}},U=async()=>{try{if(za(e)){const e=await La(),t=(await Promise.all((e||[]).map(async e=>{const t=Da(e.id);return await Xi(t)||{}}))).reduce((e,t)=>({registrosHoje:(e.registrosHoje||0)+(Number(t.registrosHoje)||0),pacientesComRegistro:(e.pacientesComRegistro||0)+(Number(t.pacientesComRegistro)||0),riscoQueda:(e.riscoQueda||0)+(Number(t.riscoQueda)||0),alertasCriticos:(e.alertasCriticos||0)+(Number(t.alertasCriticos)||0)}),{registrosHoje:0,pacientesComRegistro:0,riscoQueda:0,alertasCriticos:0});return void z(t)}const t=await Xi();z(t)}catch(t){}},H=async()=>{try{if(za(e)){const e=await La(),t=(await Promise.all((e||[]).map(async e=>{const t=Da(e.id),[s,a]=await Promise.all([qi({},t),Bi({},t)]);return{empresa:e,medicamentos:Array.isArray(s)?s:s?.items||[],alimentos:Array.isArray(a)?a:a?.items||[]}}))).flatMap(({empresa:e,medicamentos:t,alimentos:s})=>{const a=e?`${e.codigo?`${e.codigo} - `:""}${e.nome||"Empresa"}`:null,r=t=>(Array.isArray(t)?t:[]).map(t=>({...t,__empresaId:e?.id,empresaLabel:a}));return[...r(t),...r(s)]});return void k(t)}const t=await qi(),s=await Bi();k([...t||[],...s||[]])}catch(t){}},J=async(s,a)=>{if(confirm(`Deseja realmente excluir o registro "${a}"?`))try{N(s);if(za(e)){const e=t.find(e=>String(e.id||e._id)===String(s)),a=e?.__empresaId||e?.empresaId;a?await Yi(s,Da(a)):await Yi(s)}else await Yi(s);p.success(ar("delete","Registro")),B(),U()}catch(r){const{handleApiError:e}=await Ea(async()=>{const{handleApiError:e}=await Promise.resolve().then(()=>zr);return{handleApiError:e}},void 0);e(r,rr("delete","registro"))}finally{N(null)}},Q=()=>{T({pacienteId:"",tipo:"evolucao",titulo:"",descricao:"",estadoGeral:"bom",riscoQueda:"",riscoLesao:"",alerta:!1,prioridade:"baixa",observacoes:"",pa:"",fc:"",fr:"",temp:"",sato2:"",glicemia:""}),$({}),v(null),P([])},W=e=>{if(!e)return"N/A";return new Date(e).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})},K=e=>({evolucao:"Evolução",sinais_vitais:"Sinais Vitais",administracao_medicamento:"Medicamento",curativo:"Curativo",intercorrencia:"Intercorrência",admissao:"Admissão",alta:"Alta",transferencia:"Transferência",outro:"Outro"}[e]||e),Y=e=>{const t={bom:"bg-emerald-50 text-emerald-700 border-emerald-100",regular:"bg-yellow-50 text-yellow-700 border-yellow-100",grave:"bg-orange-50 text-orange-700 border-orange-100",critico:"bg-red-50 text-red-700 border-red-100"};return t[e]||t.bom},X=e=>{const t={baixa:"bg-slate-100 text-slate-700",media:"bg-blue-50 text-blue-700",alta:"bg-orange-50 text-orange-700",urgente:"bg-red-50 text-red-700"};return t[e]||t.baixa},Z=t.filter(e=>{const t=h.toLowerCase();return e.titulo?.toLowerCase().includes(t)||e.paciente?.nome?.toLowerCase().includes(t)||e.descricao?.toLowerCase().includes(t)});return Fe.jsxs("div",{className:"flex flex-col gap-8 min-h-screen",children:[Fe.jsxs("div",{className:"sticky top-0 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur-md pb-2 pt-4",children:[Fe.jsx(yr,{label:"ANÁLISE",title:"Evolução de Prescrições",subtitle:"Anotações diárias, evolução clínica e acompanhamento de cuidados.",children:Fe.jsxs("div",{className:"flex flex-col sm:flex-row w-full lg:w-auto gap-3",children:[Fe.jsxs("button",{type:"button",onClick:B,className:"btn btn-secondary flex items-center justify-center gap-2",children:[Fe.jsx(E,{size:18})," Atualizar"]}),Fe.jsxs("button",{type:"button",onClick:()=>{try{const e=new Date,t="\n        body { font-family: Arial, sans-serif; padding: 20px; }\n        h1 { color: #2563eb; border-bottom: 2px solid #2563eb; padding-bottom: 10px; }\n        .meta { color: #6b7280; font-size: 12px; margin-top: 6px; }\n        .card { border: 1px solid #e5e7eb; border-radius: 10px; padding: 12px 14px; margin-top: 12px; }\n        .row { display: flex; gap: 12px; flex-wrap: wrap; color: #374151; font-size: 12px; margin-bottom: 6px; }\n        .label { color: #6b7280; }\n        .text { white-space: pre-wrap; color: #111827; margin-top: 6px; }\n        @media print { body { padding: 0; } }\n      ";Gr({title:"Relatório - Registros de Enfermagem",bodyHtml:`\n        <h1>Relatório - Registros de Enfermagem</h1>\n        <div class="meta">Gerado em: ${Vr(e.toLocaleDateString("pt-BR"))} às ${Vr(e.toLocaleTimeString("pt-BR"))}</div>\n        <div class="meta">Registros: ${Vr(Z.length)}</div>\n        ${Z.map(e=>{const t=e.createdAt?new Date(e.createdAt).toLocaleDateString("pt-BR"):"-",s=e.createdAt?new Date(e.createdAt).toLocaleTimeString("pt-BR"):"",a=e.paciente?.nome||"Paciente não identificado",r=e.tipo||"-",i=e.titulo||"-",n=e.descricao||"-",l=e.prioridade||"-",o=e.estadoGeral||"-",d=e.alerta?"Sim":"Não";return`\n              <div class="card">\n                <div class="row">\n                  <div><span class="label">Data:</span> ${Vr(t)} ${s?`(${Vr(s)})`:""}</div>\n                  <div><span class="label">Paciente:</span> ${Vr(a)}</div>\n                </div>\n                <div class="row">\n                  <div><span class="label">Tipo:</span> ${Vr(r)}</div>\n                  <div><span class="label">Prioridade:</span> ${Vr(l)}</div>\n                  <div><span class="label">Estado geral:</span> ${Vr(o)}</div>\n                  <div><span class="label">Alerta:</span> ${Vr(d)}</div>\n                </div>\n                <div class="text"><strong>${Vr(i)}</strong>\n\n${Vr(n)}</div>\n              </div>\n            `}).join("")}\n      `,styles:t}),p.success("Abrindo visualização para impressão/PDF")}catch(e){p.error("Erro ao gerar PDF")}},disabled:0===Z.length,className:"btn btn-secondary flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",title:"Exportar para PDF",children:[Fe.jsx(G,{size:18})," Exportar PDF"]}),Fe.jsxs("button",{type:"button",onClick:()=>{Q(),g(!0)},className:"btn btn-primary flex items-center justify-center gap-2 shadow-lg shadow-primary-600/20",children:[Fe.jsx(V,{size:18})," Novo Registro"]})]})}),Fe.jsxs("div",{className:"flex items-center justify-between gap-3 px-2",children:[Fe.jsxs("div",{className:"text-sm text-slate-600",children:["Página ",Fe.jsx("span",{className:"font-semibold",children:a})]}),Fe.jsxs("div",{className:"flex gap-2",children:[Fe.jsx("button",{className:"btn btn-secondary",disabled:a<=1,onClick:()=>r(e=>Math.max(1,e-1)),children:"Anterior"}),Fe.jsx("button",{className:"btn btn-secondary",disabled:a*o>=n&&n>0,onClick:()=>r(e=>e+1),children:"Próxima"})]})]}),Fe.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6 mt-4",children:[Fe.jsx(Nr,{icon:C,label:"Hoje",value:R.registrosHoje,description:"Registros realizados",color:"primary"}),Fe.jsx(Nr,{icon:S,label:"Cobertura",value:R.pacientesComRegistro,description:"Pacientes evoluídos",color:"emerald"}),Fe.jsx(Nr,{icon:he,label:"Risco",value:R.riscoQueda,description:"Alto risco de queda",color:"orange"}),Fe.jsx(Nr,{icon:O,label:"Crítico",value:R.alertasCriticos,description:"Alertas pendentes",color:"red"})]}),Fe.jsx("div",{className:"mt-4",children:Fe.jsx(Dr,{searchTerm:h,onSearchChange:b,placeholder:"Buscar por título, residente ou descrição..."})})]}),Fe.jsx($r,{title:"Evolução Clínica",children:x?Fe.jsxs("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[Fe.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-200 border-t-primary-600"}),Fe.jsx("p",{className:"text-sm text-slate-600 dark:text-gray-400",children:"Carregando registros..."})]}):Z.length>0?Fe.jsxs(Fe.Fragment,{children:[Fe.jsx(Or,{children:Z.map(t=>Fe.jsxs(qr,{children:[Fe.jsxs("div",{className:"flex items-start justify-between",children:[Fe.jsxs("div",{className:"flex-1",children:[Fe.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[Fe.jsx("span",{className:`text-xs font-bold px-2 py-0.5 rounded ${X(t.prioridade)}`,children:K(t.tipo)}),t.alerta&&Fe.jsx(O,{size:14,className:"text-red-500"})]}),Fe.jsx("p",{className:"font-semibold text-slate-900 dark:text-gray-100",children:t.titulo}),Fe.jsxs("p",{className:"text-[10px] text-slate-400",children:["Código: ",t.id||t._id]}),Fe.jsxs("p",{className:"text-sm text-slate-600 dark:text-gray-300 mt-1",children:[Fe.jsx(I,{size:14,className:"inline mr-1"}),t.paciente?.nome||"Paciente não identificado"]}),t.empresaLabel&&Fe.jsxs("p",{className:"text-xs text-slate-400 dark:text-gray-500 mt-0.5 truncate",title:t.empresaLabel,children:["Empresa: ",t.empresaLabel]}),Fe.jsx("p",{className:"text-xs text-slate-500 dark:text-gray-400 mt-1",children:W(t.createdAt)})]}),Fe.jsx("span",{className:`text-xs font-medium px-2.5 py-1 rounded-full border ${Y(t.estadoGeral)}`,children:t.estadoGeral})]}),Fe.jsx("p",{className:"text-sm text-slate-600 dark:text-gray-300 mt-3 line-clamp-2",children:t.descricao}),Fe.jsx("div",{className:"flex items-center justify-end gap-2 mt-3",children:Fe.jsx(Lr,{onClick:()=>J(t.id,t.titulo),icon:te,variant:"danger",tooltip:"Excluir (somente Super Admin)",title:"Excluir registro",ariaLabel:"Excluir registro",disabled:y===t.id||"superadmin"!==e?.role,loading:y===t.id})})]},t.id))}),Fe.jsx("div",{className:"hidden md:grid grid-cols-1 lg:grid-cols-2 gap-4 p-2 md:p-4",children:Z.map(t=>Fe.jsxs("div",{className:"rounded-xl border border-slate-200 dark:border-gray-800 bg-white dark:bg-gray-900 p-4 shadow-sm hover:shadow-md transition-shadow",children:[Fe.jsxs("div",{className:"flex items-start justify-between",children:[Fe.jsxs("div",{className:"flex items-center gap-2",children:[Fe.jsx("span",{className:`text-xs font-bold px-2.5 py-1 rounded-full ${X(t.prioridade)}`,children:K(t.tipo)}),t.alerta&&Fe.jsx(O,{size:16,className:"text-red-500",title:"Alerta ativo"})]}),Fe.jsxs("div",{className:"flex items-center gap-3",children:[Fe.jsx("span",{className:"text-xs text-slate-500 dark:text-gray-400",children:W(t.createdAt)}),Fe.jsx("span",{className:`text-xs font-medium px-2.5 py-1 rounded-full border ${Y(t.estadoGeral)}`,children:t.estadoGeral})]})]}),Fe.jsxs("div",{className:"mt-3",children:[Fe.jsx("p",{className:"font-semibold text-slate-900 dark:text-gray-100",children:t.titulo}),Fe.jsxs("p",{className:"text-[11px] text-slate-400",children:["Código: ",t.id||t._id]}),Fe.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[Fe.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-50 flex items-center justify-center text-primary-600 font-bold text-sm",children:t.paciente?.nome?.charAt(0)||"?"}),Fe.jsx("span",{className:"text-sm text-slate-700 dark:text-gray-300",children:t.paciente?.nome||"Paciente não identificado"})]}),Fe.jsx("p",{className:"text-sm text-slate-600 dark:text-gray-300 mt-2 line-clamp-3",children:t.descricao})]}),Fe.jsx("div",{className:"mt-4 flex items-center justify-end gap-2",children:Fe.jsx(Lr,{onClick:()=>J(t.id,t.titulo),icon:te,variant:"danger",tooltip:"Excluir (somente Super Admin)",title:"Excluir registro",ariaLabel:"Excluir registro",disabled:y===t.id||"superadmin"!==e?.role,loading:y===t.id})})]},t.id))})]}):Fe.jsxs("div",{className:"p-12 flex flex-col items-center gap-6",children:[Fe.jsx(Tr,{icon:C,title:"Nenhum registro encontrado",description:"Comece criando um novo registro de enfermagem."}),Fe.jsxs("button",{className:"btn btn-primary flex items-center gap-2 shadow-lg shadow-primary-600/20",onClick:()=>{Q(),g(!0)},children:[Fe.jsx(V,{size:18})," Novo Registro"]})]})}),f&&Fe.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:Fe.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col overflow-hidden animate-in fade-in zoom-in duration-200",children:[Fe.jsxs("div",{className:"px-6 py-5 border-b border-slate-200 dark:border-gray-700 flex justify-between items-start bg-gradient-to-r from-primary-50 to-primary-100/50 dark:from-gray-700 dark:to-gray-700/50 shrink-0",children:[Fe.jsxs("div",{children:[Fe.jsx("h3",{className:"font-bold text-xl text-slate-800 dark:text-gray-100",children:j?"Editar Registro":"Novo Registro de Enfermagem"}),Fe.jsx("p",{className:"text-sm text-slate-600 dark:text-gray-300 mt-1",children:"Preencha os dados do registro clínico."})]}),Fe.jsx("button",{onClick:()=>g(!1),className:"text-slate-400 hover:text-slate-600 dark:hover:text-gray-200 p-1 hover:bg-slate-100 dark:hover:bg-gray-700 rounded-lg transition",children:Fe.jsx(q,{size:24})})]}),Fe.jsx("div",{className:"overflow-y-auto p-6 custom-scrollbar",children:Fe.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),(()=>{const e={};return D.pacienteId||(e.pacienteId="Selecione um residente"),D.titulo.trim()||(e.titulo="Título é obrigatório"),D.descricao.trim()||(e.descricao="Descrição é obrigatória"),$(e),0===Object.keys(e).length})())try{let t=null;(D.pa||D.fc||D.fr||D.temp||D.sato2||D.glicemia)&&(t={pa:D.pa||null,fc:D.fc||null,fr:D.fr||null,temp:D.temp||null,sato2:D.sato2||null,glicemia:D.glicemia||null});const s={pacienteId:D.pacienteId,tipo:D.tipo,titulo:D.titulo.trim(),descricao:D.descricao.trim(),estadoGeral:D.estadoGeral,riscoQueda:D.riscoQueda||null,riscoLesao:D.riscoLesao||null,alerta:D.alerta,prioridade:D.prioridade,observacoes:D.observacoes.trim()||null,sinaisVitais:t};if(j){const{handleApiError:e}=await Ea(async()=>{const{handleApiError:e}=await Promise.resolve().then(()=>zr);return{handleApiError:e}},void 0);return e({response:{data:{code:"history_immutable"}}},"Edição de histórico de evolução não é permitida"),v(null),void g(!1)}if(za(e)){const e=c.find(e=>String(e.id||e._id)===String(s.pacienteId)),t=e?.__empresaId||e?.empresaId;if(!t)return void p.error("Selecione um residente com empresa válida (ou escolha uma empresa no topo)");await Ki(s,Da(t))}else await Ki(s);p.success(ar("create","Registro"));g(!1),Q(),B(),U()}catch(s){const{handleApiError:e}=await Ea(async()=>{const{handleApiError:e}=await Promise.resolve().then(()=>zr);return{handleApiError:e}},void 0);e(s,rr("save","registro"))}},className:"space-y-6",children:[Fe.jsxs("div",{className:"bg-slate-50 dark:bg-gray-700/50 rounded-xl p-5",children:[Fe.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[Fe.jsx(C,{className:"text-primary-600",size:20}),Fe.jsx("h4",{className:"font-bold text-slate-800 dark:text-gray-100",children:"Informações Básicas"})]}),Fe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-gray-200 mb-1.5",children:"Residente *"}),0===c.length?Fe.jsxs("div",{className:"flex flex-col gap-2",children:[Fe.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 text-yellow-800 rounded-lg p-3 text-sm flex items-center gap-2",children:[Fe.jsx(F,{size:16,className:"text-yellow-500"}),"Nenhum residente cadastrado. Cadastre um residente para registrar uma evolução."]}),Fe.jsx("button",{type:"button",className:"btn btn-primary w-fit",onClick:()=>window.location.hash="#/pacientes",children:"Cadastrar Residente"})]}):Fe.jsxs(Fe.Fragment,{children:[Fe.jsxs("select",{className:"input w-full "+(L.pacienteId?"border-red-300":""),value:D.pacienteId,onChange:e=>T({...D,pacienteId:e.target.value}),children:[Fe.jsx("option",{value:"",children:"Selecione um residente"}),c.map(e=>Fe.jsx("option",{value:e.id,children:e.nome},e.id))]}),L.pacienteId&&Fe.jsxs("p",{className:"text-xs text-red-600 mt-1 flex items-center gap-1",children:[Fe.jsx(F,{size:12})," ",L.pacienteId]})]})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-gray-200 mb-1.5",children:"Tipo de Registro"}),Fe.jsxs("select",{className:"input w-full",value:D.tipo,onChange:e=>T({...D,tipo:e.target.value}),children:[Fe.jsx("option",{value:"evolucao",children:"Evolução"}),Fe.jsx("option",{value:"sinais_vitais",children:"Sinais Vitais"}),Fe.jsx("option",{value:"administracao_medicamento",children:"Administração de Medicamento"}),Fe.jsx("option",{value:"curativo",children:"Curativo"}),Fe.jsx("option",{value:"intercorrencia",children:"Intercorrência"}),Fe.jsx("option",{value:"admissao",children:"Admissão"}),Fe.jsx("option",{value:"alta",children:"Alta"}),Fe.jsx("option",{value:"transferencia",children:"Transferência"}),Fe.jsx("option",{value:"outro",children:"Outro"})]})]})]}),Fe.jsxs("div",{className:"mt-4",children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-gray-200 mb-1.5",children:"Título *"}),Fe.jsx("input",{type:"text",className:"input w-full "+(L.titulo?"border-red-300":""),placeholder:"Ex: Evolução diária, Verificação de PA...",value:D.titulo,onChange:e=>T({...D,titulo:e.target.value})}),L.titulo&&Fe.jsxs("p",{className:"text-xs text-red-600 mt-1 flex items-center gap-1",children:[Fe.jsx(F,{size:12})," ",L.titulo]})]}),Fe.jsxs("div",{className:"mt-4",children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-gray-200 mb-1.5",children:"Descrição *"}),Fe.jsx("textarea",{className:"input w-full min-h-[100px] "+(L.descricao?"border-red-300":""),placeholder:"Descreva a evolução clínica, sinais e sintomas, procedimentos realizados...",value:D.descricao,onChange:e=>T({...D,descricao:e.target.value})}),L.descricao&&Fe.jsxs("p",{className:"text-xs text-red-600 mt-1 flex items-center gap-1",children:[Fe.jsx(F,{size:12})," ",L.descricao]})]})]}),Fe.jsxs("div",{className:"bg-blue-50 dark:bg-gray-700/50 rounded-xl p-5",children:[Fe.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[Fe.jsx(_,{className:"text-blue-600",size:20}),Fe.jsx("h4",{className:"font-bold text-slate-800 dark:text-gray-100",children:"Sinais Vitais"}),Fe.jsx("span",{className:"text-xs text-slate-500 dark:text-gray-400",children:"(Opcional)"})]}),Fe.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[Fe.jsxs("div",{children:[Fe.jsxs("label",{className:"flex items-center gap-1 text-sm font-medium text-slate-700 dark:text-gray-200 mb-1.5",children:[Fe.jsx(be,{size:14})," PA (mmHg)"]}),Fe.jsx("input",{type:"text",className:"input w-full",placeholder:"120/80",value:D.pa,onChange:e=>T({...D,pa:e.target.value})})]}),Fe.jsxs("div",{children:[Fe.jsxs("label",{className:"flex items-center gap-1 text-sm font-medium text-slate-700 dark:text-gray-200 mb-1.5",children:[Fe.jsx(_,{size:14})," FC (bpm)"]}),Fe.jsx("input",{type:"number",className:"input w-full",placeholder:"72",value:D.fc,onChange:e=>T({...D,fc:e.target.value})})]}),Fe.jsxs("div",{children:[Fe.jsxs("label",{className:"flex items-center gap-1 text-sm font-medium text-slate-700 dark:text-gray-200 mb-1.5",children:[Fe.jsx(fe,{size:14})," FR (irpm)"]}),Fe.jsx("input",{type:"number",className:"input w-full",placeholder:"16",value:D.fr,onChange:e=>T({...D,fr:e.target.value})})]}),Fe.jsxs("div",{children:[Fe.jsxs("label",{className:"flex items-center gap-1 text-sm font-medium text-slate-700 dark:text-gray-200 mb-1.5",children:[Fe.jsx(ge,{size:14})," Temp (°C)"]}),Fe.jsx("input",{type:"number",step:"0.1",className:"input w-full",placeholder:"36.5",value:D.temp,onChange:e=>T({...D,temp:e.target.value})})]}),Fe.jsxs("div",{children:[Fe.jsxs("label",{className:"flex items-center gap-1 text-sm font-medium text-slate-700 dark:text-gray-200 mb-1.5",children:[Fe.jsx(_,{size:14})," SatO2 (%)"]}),Fe.jsx("input",{type:"number",className:"input w-full",placeholder:"98",value:D.sato2,onChange:e=>T({...D,sato2:e.target.value})})]}),Fe.jsxs("div",{children:[Fe.jsxs("label",{className:"flex items-center gap-1 text-sm font-medium text-slate-700 dark:text-gray-200 mb-1.5",children:[Fe.jsx(je,{size:14})," Glicemia (mg/dL)"]}),Fe.jsx("input",{type:"number",className:"input w-full",placeholder:"90",value:D.glicemia,onChange:e=>T({...D,glicemia:e.target.value})})]})]})]}),Fe.jsxs("div",{className:"bg-orange-50 dark:bg-gray-700/50 rounded-xl p-5",children:[Fe.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[Fe.jsx(he,{className:"text-orange-600",size:20}),Fe.jsx("h4",{className:"font-bold text-slate-800 dark:text-gray-100",children:"Avaliação e Riscos"})]}),Fe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-gray-200 mb-1.5",children:"Estado Geral"}),Fe.jsxs("select",{className:"input w-full",value:D.estadoGeral,onChange:e=>T({...D,estadoGeral:e.target.value}),children:[Fe.jsx("option",{value:"bom",children:"Bom"}),Fe.jsx("option",{value:"regular",children:"Regular"}),Fe.jsx("option",{value:"grave",children:"Grave"}),Fe.jsx("option",{value:"critico",children:"Crítico"})]})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-gray-200 mb-1.5",children:"Prioridade"}),Fe.jsxs("select",{className:"input w-full",value:D.prioridade,onChange:e=>T({...D,prioridade:e.target.value}),children:[Fe.jsx("option",{value:"baixa",children:"Baixa"}),Fe.jsx("option",{value:"media",children:"Média"}),Fe.jsx("option",{value:"alta",children:"Alta"}),Fe.jsx("option",{value:"urgente",children:"Urgente"})]})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-gray-200 mb-1.5",children:"Risco de Queda"}),Fe.jsxs("select",{className:"input w-full",value:D.riscoQueda,onChange:e=>T({...D,riscoQueda:e.target.value}),children:[Fe.jsx("option",{value:"",children:"Não avaliado"}),Fe.jsx("option",{value:"baixo",children:"Baixo"}),Fe.jsx("option",{value:"medio",children:"Médio"}),Fe.jsx("option",{value:"alto",children:"Alto"})]})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-gray-200 mb-1.5",children:"Risco de Lesão"}),Fe.jsxs("select",{className:"input w-full",value:D.riscoLesao,onChange:e=>T({...D,riscoLesao:e.target.value}),children:[Fe.jsx("option",{value:"",children:"Não avaliado"}),Fe.jsx("option",{value:"baixo",children:"Baixo"}),Fe.jsx("option",{value:"medio",children:"Médio"}),Fe.jsx("option",{value:"alto",children:"Alto"})]})]}),Fe.jsx("div",{className:"md:col-span-2",children:Fe.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[Fe.jsx("input",{type:"checkbox",className:"w-5 h-5 text-primary-600 rounded focus:ring-2 focus:ring-primary-500",checked:D.alerta,onChange:e=>T({...D,alerta:e.target.checked})}),Fe.jsxs("span",{className:"text-sm font-medium text-slate-700 dark:text-gray-200 flex items-center gap-2",children:[Fe.jsx(O,{size:16,className:"text-red-500"}),"Marcar como alerta (requer atenção especial)"]})]})})]})]}),Fe.jsxs("div",{className:"bg-green-50 dark:bg-gray-700/50 rounded-xl p-5",children:[Fe.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[Fe.jsx(C,{className:"text-green-600",size:20}),Fe.jsx("h4",{className:"font-bold text-slate-800 dark:text-gray-100",children:"Itens do Estoque Utilizados"}),Fe.jsx("span",{className:"text-xs text-slate-500 dark:text-gray-400",children:"(Opcional)"})]}),Fe.jsxs("div",{className:"space-y-4",children:[Fe.jsxs("select",{className:"input w-full",onChange:e=>{const t=e.target.value,s=w.find(e=>e.id===t);s&&!A.some(e=>e.id===t)&&P([...A,{id:s.id,nome:s.nome,quantidade:1}]),e.target.value=""},value:"",children:[Fe.jsx("option",{value:"",children:"Adicionar item do estoque..."}),w.map(e=>Fe.jsx("option",{value:e.id,children:e.nome},e.id))]}),Fe.jsx("div",{className:"flex flex-col gap-2",children:0===A.length?Fe.jsx("span",{className:"text-xs text-slate-400",children:"Nenhum item selecionado"}):A.map((e,t)=>Fe.jsxs("div",{className:"flex items-center gap-2 bg-white dark:bg-gray-800 p-3 rounded-lg",children:[Fe.jsx("span",{className:"font-medium flex-1",children:e.nome}),Fe.jsx("input",{type:"number",min:1,className:"input w-20",value:e.quantidade,onChange:e=>{const s=parseInt(e.target.value)||1;P(A.map((e,a)=>a===t?{...e,quantidade:s}:e))}}),Fe.jsx("button",{type:"button",className:"btn btn-danger btn-sm",onClick:()=>P(A.filter((e,s)=>s!==t)),children:Fe.jsx(te,{size:14})})]},e.id))})]})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-gray-200 mb-1.5",children:"Observações Adicionais"}),Fe.jsx("textarea",{className:"input w-full min-h-[80px]",placeholder:"Informações complementares, condutas tomadas...",value:D.observacoes,onChange:e=>T({...D,observacoes:e.target.value})})]}),Fe.jsxs("div",{className:"pt-4 flex gap-3 border-t border-slate-200 dark:border-gray-700",children:[Fe.jsx("button",{type:"button",onClick:()=>g(!1),className:"btn btn-secondary flex-1 py-2.5",children:"Cancelar"}),Fe.jsx("button",{type:"submit",className:"btn btn-primary flex-1 py-2.5 shadow-lg shadow-primary-500/20",disabled:0===c.length,children:j?"Salvar Alterações":"Criar Registro"})]})]})})]})})]})}const en=async(e={})=>{const t=Ba({tipo:e.tipo,status:e.status,dataInicio:e.dataInicio,dataFim:e.dataFim,page:e.page,pageSize:e.pageSize});return Ma(`/financeiro${t}`)},tn=async()=>{const e=await Ma("/financeiro/stats");return e?.data||e},sn=async e=>Ua("/financeiro",e),an=async(e,t)=>Va(`/financeiro/${e}`,t),rn=async e=>Ga(`/financeiro/${e}`);function nn({transacao:e,onClose:t}){const[s,a]=i.useState({descricao:"",valor:"",tipo:"receita",categoria:"",data:(new Date).toISOString().split("T")[0],status:"pendente",observacoes:""}),[r,n]=i.useState(!1);i.useEffect(()=>{e&&a({...e,data:new Date(e.data).toISOString().split("T")[0]})},[e]);return Fe.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:Fe.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden animate-in fade-in zoom-in duration-200",children:[Fe.jsxs("div",{className:"px-6 py-4 border-b border-slate-100 flex items-center justify-between bg-slate-50/50",children:[Fe.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:e?"Editar Transação":"Nova Transação"}),Fe.jsx("button",{onClick:t,className:"text-slate-400 hover:text-slate-600 transition",children:Fe.jsx(q,{size:20})})]}),Fe.jsxs("form",{onSubmit:async a=>{a.preventDefault(),n(!0);try{e?(await an(e._id,s),p.success(ar("update","Transação",{gender:"f"}))):(await sn(s),p.success(ar("create","Transação",{gender:"f"}))),t()}catch(r){Rr(r,rr("save","transação"))}finally{n(!1)}},className:"p-6 space-y-4",children:[Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Descrição"}),Fe.jsx("input",{type:"text",required:!0,value:s.descricao,onChange:e=>a({...s,descricao:e.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition",placeholder:"Ex: Consulta Particular"})]}),Fe.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Valor (R$)"}),Fe.jsxs("div",{className:"relative",children:[Fe.jsx(L,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),Fe.jsx("input",{type:"number",step:"0.01",required:!0,value:s.valor,onChange:e=>a({...s,valor:e.target.value}),className:"w-full pl-9 pr-3 py-2 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition",placeholder:"0,00"})]})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Data"}),Fe.jsx("input",{type:"date",required:!0,value:s.data,onChange:e=>a({...s,data:e.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition"})]})]}),Fe.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Tipo"}),Fe.jsxs("select",{value:s.tipo,onChange:e=>a({...s,tipo:e.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition",children:[Fe.jsx("option",{value:"receita",children:"Receita"}),Fe.jsx("option",{value:"despesa",children:"Despesa"})]})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Status"}),Fe.jsxs("select",{value:s.status,onChange:e=>a({...s,status:e.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition",children:[Fe.jsx("option",{value:"pendente",children:"Pendente"}),Fe.jsx("option",{value:"pago",children:"Pago"})]})]})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Categoria"}),Fe.jsxs("select",{value:s.categoria,onChange:e=>a({...s,categoria:e.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition",children:[Fe.jsx("option",{value:"",children:"Selecione..."}),"receita"===s.tipo?Fe.jsxs(Fe.Fragment,{children:[Fe.jsx("option",{value:"Consulta",children:"Consulta"}),Fe.jsx("option",{value:"Procedimento",children:"Procedimento"}),Fe.jsx("option",{value:"Convênio",children:"Convênio"}),Fe.jsx("option",{value:"Outros",children:"Outros"})]}):Fe.jsxs(Fe.Fragment,{children:[Fe.jsx("option",{value:"Aluguel",children:"Aluguel"}),Fe.jsx("option",{value:"Salários",children:"Salários"}),Fe.jsx("option",{value:"Insumos",children:"Insumos"}),Fe.jsx("option",{value:"Manutenção",children:"Manutenção"}),Fe.jsx("option",{value:"Impostos",children:"Impostos"}),Fe.jsx("option",{value:"Outros",children:"Outros"})]})]})]}),Fe.jsxs("div",{children:[Fe.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Observações"}),Fe.jsx("textarea",{rows:"3",value:s.observacoes,onChange:e=>a({...s,observacoes:e.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition resize-none"})]}),Fe.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[Fe.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100 rounded-xl transition",children:"Cancelar"}),Fe.jsxs("button",{type:"submit",disabled:r,className:"px-4 py-2 text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 rounded-xl transition flex items-center gap-2 disabled:opacity-50",children:[Fe.jsx(ie,{size:18}),r?"Salvando...":"Salvar"]})]})]})]})})}const ln=e=>{const t=Number(e),s=isNaN(t)?0:t;return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2,maximumFractionDigits:2}).format(s)};function on(){const[e,t]=i.useState([]),[s,a]=i.useState(1),[r,n]=i.useState(0),[l,o]=i.useState(10),[d,c]=i.useState({receitas:0,despesas:0,saldo:0,receitasPendentes:0,despesasPendentes:0}),[m,x]=i.useState(!0),[u,h]=i.useState(!1),[b,f]=i.useState(null),[g,j]=i.useState(null),[v,y]=i.useState({tipo:"",status:"",search:""});i.useEffect(()=>{N()},[s]);const N=async()=>{try{x(!0);const[e,a]=await Promise.all([en({page:s,pageSize:l}),tn()]);Array.isArray(e)?(t(e),n(e.length)):(t(Array.isArray(e.items)?e.items:[]),n(Number(e.total)||0),o(Number(e.pageSize)||10)),c({receitas:Number(a?.receitas)||0,despesas:Number(a?.despesas)||0,saldo:Number(a?.saldo)||0,receitasPendentes:Number(a?.receitasPendentes)||0,despesasPendentes:Number(a?.despesasPendentes)||0})}catch(e){Rr(e,rr("load","dados financeiros"))}finally{x(!1)}},w=e=>{f(e),h(!0)},S=async(e,t)=>{const s=`Tem certeza que deseja excluir a transação "${t}"?\n\nEsta ação não pode ser desfeita.`;if(window.confirm(s))try{j(e),await rn(e),p.success("Transação excluída com sucesso"),N()}catch(a){Rr(a,rr("delete","transação"))}finally{j(null)}},C=e.filter(e=>{const t=e.descricao.toLowerCase().includes(v.search.toLowerCase())||e.categoria.toLowerCase().includes(v.search.toLowerCase()),s=!v.tipo||e.tipo===v.tipo,a=!v.status||e.status===v.status;return t&&s&&a});return Fe.jsxs("div",{className:"space-y-8",children:[Fe.jsx(yr,{label:"Administrativo",title:"Financeiro",subtitle:"Gestão completa de receitas, despesas e fluxo de caixa.",children:Fe.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[Fe.jsxs("div",{className:"flex items-center gap-2",children:[Fe.jsxs("button",{onClick:()=>{try{const e=new Date,t="\n        body { font-family: Arial, sans-serif; padding: 20px; }\n        h1 { color: #2563eb; border-bottom: 2px solid #2563eb; padding-bottom: 10px; }\n        .stats { display: flex; gap: 20px; margin: 20px 0; flex-wrap: wrap; }\n        .stat-card { border: 1px solid #e5e7eb; padding: 15px; border-radius: 8px; flex: 1; min-width: 200px; }\n        .stat-label { color: #6b7280; font-size: 12px; text-transform: uppercase; }\n        .stat-value { font-size: 24px; font-weight: bold; margin: 8px 0; }\n        table { width: 100%; border-collapse: collapse; margin-top: 20px; }\n        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #e5e7eb; }\n        th { background: #f9fafb; font-weight: 600; color: #374151; }\n        .receita { color: #059669; }\n        .despesa { color: #dc2626; }\n        .pago { color: #059669; background: #d1fae5; padding: 4px 8px; border-radius: 4px; }\n        .pendente { color: #d97706; background: #fef3c7; padding: 4px 8px; border-radius: 4px; }\n        @media print { body { padding: 0; } }\n      ",s=C.map(e=>{const t="receita"===e.tipo?"receita":"despesa",s="pago"===e.status?"pago":"pendente";return`\n            <tr>\n              <td>${Vr(new Date(e.data).toLocaleDateString("pt-BR"))}</td>\n              <td>${Vr(e.descricao)}</td>\n              <td>${Vr(e.categoria)}</td>\n              <td class="${t}">${"receita"===t?"Receita":"Despesa"}</td>\n              <td class="${t}">${"despesa"===t?"-":"+"}${Vr(ln(e.valor))}</td>\n              <td><span class="${s}">${"pago"===s?"Pago":"Pendente"}</span></td>\n            </tr>\n          `}).join("");Gr({title:"Relatório Financeiro - Prescrimed",styles:t,bodyHtml:`\n        <h1>Relatório Financeiro</h1>\n        <p>Gerado em: ${Vr(e.toLocaleDateString("pt-BR"))} às ${Vr(e.toLocaleTimeString("pt-BR"))}</p>\n        \n        <div class="stats">\n          <div class="stat-card">\n            <div class="stat-label">Saldo Atual</div>\n            <div class="stat-value">${Vr(ln(d.saldo))}</div>\n          </div>\n          <div class="stat-card">\n            <div class="stat-label">Receitas</div>\n            <div class="stat-value" style="color: #059669">${Vr(ln(d.receitas))}</div>\n          </div>\n          <div class="stat-card">\n            <div class="stat-label">Despesas</div>\n            <div class="stat-value" style="color: #dc2626">${Vr(ln(d.despesas))}</div>\n          </div>\n        </div>\n        \n        <table>\n          <thead>\n            <tr>\n              <th>Data</th>\n              <th>Descrição</th>\n              <th>Categoria</th>\n              <th>Tipo</th>\n              <th>Valor</th>\n              <th>Status</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${s}\n          </tbody>\n        </table>\n      `}),p.success("Abrindo visualização para impressão/PDF")}catch(e){p.error("Erro ao gerar PDF")}},disabled:0===C.length,className:"group relative px-4 py-2.5 bg-white border-2 border-red-500 text-red-600 hover:bg-red-500 hover:text-white rounded-lg transition-all duration-200 shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",title:"Exportar para PDF","aria-label":"Exportar relatório em PDF",children:[Fe.jsx(G,{size:18}),Fe.jsx("span",{className:"hidden sm:inline font-medium",children:"PDF"}),Fe.jsx("span",{className:"absolute -top-8 left-1/2 -translate-x-1/2 px-2 py-1 text-xs font-medium text-white bg-slate-800 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap",children:"Exportar PDF"})]}),Fe.jsxs("button",{onClick:()=>{try{const e=["Data","Descrição","Categoria","Tipo","Valor","Status"],t=C.map(e=>[new Date(e.data).toLocaleDateString("pt-BR"),e.descricao,e.categoria,"receita"===e.tipo?"Receita":"Despesa",`${"despesa"===e.tipo?"-":""}${e.valor}`,"pago"===e.status?"Pago":"Pendente"]),s=[["RELATÓRIO FINANCEIRO"],["Gerado em:",(new Date).toLocaleString("pt-BR")],[],["RESUMO"],["Saldo Atual",d.saldo],["Receitas",d.receitas],["Despesas",d.despesas],["Receitas Pendentes",d.receitasPendentes],["Despesas Pendentes",d.despesasPendentes],[],["TRANSAÇÕES"],e,...t];Ji({filename:`financeiro_${(new Date).toISOString().split("T")[0]}.csv`,lines:s}),p.success("Arquivo Excel exportado com sucesso")}catch(e){p.error("Erro ao exportar para Excel")}},disabled:0===C.length,className:"group relative px-4 py-2.5 bg-white border-2 border-emerald-500 text-emerald-600 hover:bg-emerald-500 hover:text-white rounded-lg transition-all duration-200 shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",title:"Exportar para Excel","aria-label":"Exportar relatório em Excel",children:[Fe.jsx(ce,{size:18}),Fe.jsx("span",{className:"hidden sm:inline font-medium",children:"Excel"}),Fe.jsx("span",{className:"absolute -top-8 left-1/2 -translate-x-1/2 px-2 py-1 text-xs font-medium text-white bg-slate-800 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap",children:"Exportar Excel"})]})]}),Fe.jsx("div",{className:"hidden md:block w-px h-8 bg-slate-200"}),Fe.jsxs("button",{onClick:()=>h(!0),className:"btn btn-primary flex items-center justify-center gap-2 shadow-lg shadow-primary-500/20",children:[Fe.jsx(V,{size:20})," ",Fe.jsx("span",{className:"hidden sm:inline",children:"Nova Transação"}),Fe.jsx("span",{className:"sm:hidden",children:"Nova"})]})]})}),Fe.jsxs("div",{className:"flex items-center justify-between gap-3",children:[Fe.jsxs("div",{className:"text-sm text-slate-600",children:["Página ",Fe.jsx("span",{className:"font-semibold",children:s})]}),Fe.jsxs("div",{className:"flex gap-2",children:[Fe.jsx("button",{className:"btn btn-secondary",disabled:s<=1,onClick:()=>a(e=>Math.max(1,e-1)),children:"Anterior"}),Fe.jsx("button",{className:"btn btn-secondary",disabled:s*l>=r&&r>0,onClick:()=>a(e=>e+1),children:"Próxima"})]})]}),Fe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[Fe.jsx(Nr,{icon:L,label:"Saldo Atual",value:ln(d.saldo),description:"Balanço geral do mês",color:d.saldo>=0?"primary":"red"}),Fe.jsx(Nr,{icon:A,label:"Receitas",value:ln(d.receitas),description:Fe.jsxs("span",{className:"flex items-center gap-1",children:[Fe.jsxs("span",{className:"text-xs font-medium text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded-full",children:["+",ln(d.receitasPendentes)]}),Fe.jsx("span",{className:"text-xs text-slate-400",children:"a receber"})]}),color:"emerald"}),Fe.jsx(Nr,{icon:ve,label:"Despesas",value:ln(d.despesas),description:Fe.jsxs("span",{className:"flex items-center gap-1",children:[Fe.jsxs("span",{className:"text-xs font-medium text-amber-600 bg-amber-50 px-2 py-0.5 rounded-full",children:["+",ln(d.despesasPendentes)]}),Fe.jsx("span",{className:"text-xs text-slate-400",children:"a pagar"})]}),color:"red"}),Fe.jsx(Nr,{icon:z,label:"Previsão",value:ln(d.saldo+d.receitasPendentes-d.despesasPendentes),description:"Saldo projetado",color:"purple"})]}),Fe.jsx(Dr,{searchTerm:v.search,onSearchChange:e=>y({...v,search:e}),placeholder:"Buscar transações...",children:Fe.jsxs("div",{className:"flex gap-3 w-full md:w-auto overflow-x-auto pb-2 md:pb-0",children:[Fe.jsxs("select",{value:v.tipo,onChange:e=>y({...v,tipo:e.target.value}),className:"px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl text-sm text-slate-600 focus:outline-none focus:border-primary-500",children:[Fe.jsx("option",{value:"",children:"Todos os tipos"}),Fe.jsx("option",{value:"receita",children:"Receitas"}),Fe.jsx("option",{value:"despesa",children:"Despesas"})]}),Fe.jsxs("select",{value:v.status,onChange:e=>y({...v,status:e.target.value}),className:"px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl text-sm text-slate-600 focus:outline-none focus:border-primary-500",children:[Fe.jsx("option",{value:"",children:"Todos os status"}),Fe.jsx("option",{value:"pago",children:"Pago"}),Fe.jsx("option",{value:"pendente",children:"Pendente"})]})]})}),Fe.jsx($r,{title:"Transações",actions:Fe.jsxs("button",{onClick:()=>h(!0),className:"btn btn-primary flex items-center gap-2",children:[Fe.jsx(V,{size:18})," Nova"]}),children:m?Fe.jsx("div",{className:"flex justify-center py-12",children:Fe.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):C.length>0?Fe.jsxs(Fe.Fragment,{children:[Fe.jsx(Or,{children:C.map(e=>Fe.jsxs(qr,{children:[Fe.jsxs("div",{className:"flex items-start justify-between",children:[Fe.jsxs("div",{className:"flex items-center gap-3",children:[Fe.jsx("div",{className:"p-2 rounded-lg "+("receita"===e.tipo?"bg-emerald-100 text-emerald-600":"bg-red-100 text-red-600"),children:"receita"===e.tipo?Fe.jsx(ye,{size:18}):Fe.jsx(Ne,{size:18})}),Fe.jsxs("div",{children:[Fe.jsx("p",{className:"font-medium text-slate-900 dark:text-gray-100",children:e.descricao}),Fe.jsxs("p",{className:"text-[10px] text-slate-400",children:["Código: ",e.id||e._id]}),Fe.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[Fe.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-slate-100 dark:bg-gray-800 text-slate-600 dark:text-gray-300",children:e.categoria}),Fe.jsxs("span",{className:"flex items-center gap-1 text-xs text-slate-600 dark:text-gray-300",children:[Fe.jsx(R,{size:12})," ",new Date(e.data).toLocaleDateString("pt-BR")]})]})]})]}),Fe.jsxs("div",{className:"text-sm font-semibold "+("receita"===e.tipo?"text-emerald-600":"text-red-600"),children:["despesa"===e.tipo?"-":"+",ln(e.valor)]})]}),Fe.jsxs("div",{className:"flex items-center justify-between mt-3",children:[Fe.jsx("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium "+("pago"===e.status?"bg-emerald-50 text-emerald-700 border border-emerald-100":"bg-amber-50 text-amber-700 border border-amber-100"),children:"pago"===e.status?Fe.jsxs(Fe.Fragment,{children:[Fe.jsx(J,{size:12})," Pago"]}):Fe.jsxs(Fe.Fragment,{children:[Fe.jsx(z,{size:12})," Pendente"]})}),Fe.jsxs("div",{className:"flex items-center gap-2",children:[Fe.jsx("button",{onClick:()=>w(e),className:"p-2.5 text-slate-500 hover:text-white hover:bg-gradient-to-br from-primary-500 to-primary-600 rounded-lg transition-all duration-200 shadow-sm hover:shadow-md","aria-label":"Editar transação",children:Fe.jsx(Q,{size:18})}),Fe.jsx("button",{onClick:()=>S(e._id,e.descricao),disabled:g===e._id,className:"p-2.5 text-slate-500 hover:text-white hover:bg-gradient-to-br from-red-500 to-red-600 rounded-lg transition-all duration-200 shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Excluir transação",children:g===e._id?Fe.jsx("div",{className:"animate-spin rounded-full h-[18px] w-[18px] border-2 border-white border-t-transparent"}):Fe.jsx(te,{size:18})})]})]})]},e._id))}),Fe.jsxs(Ir,{children:[Fe.jsx(Fr,{columns:["Descrição","Categoria","Data","Valor","Status","Ações"]}),Fe.jsx(Br,{children:C.map(e=>Fe.jsxs(Mr,{children:[Fe.jsx(Ur,{children:Fe.jsxs("div",{className:"flex items-center gap-3",children:[Fe.jsx("div",{className:"p-2 rounded-lg "+("receita"===e.tipo?"bg-emerald-100 text-emerald-600":"bg-red-100 text-red-600"),children:"receita"===e.tipo?Fe.jsx(ye,{size:18}):Fe.jsx(Ne,{size:18})}),Fe.jsxs("div",{children:[Fe.jsx("p",{className:"font-medium text-slate-900 dark:text-gray-100",children:e.descricao}),Fe.jsxs("p",{className:"text-[11px] text-slate-400",children:["Código: ",e.id||e._id]}),e.pacienteId&&Fe.jsx("p",{className:"text-xs text-slate-500 dark:text-gray-300",children:e.pacienteId.nome})]})]})}),Fe.jsx(Ur,{children:Fe.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-medium bg-slate-100 dark:bg-gray-800 text-slate-600 dark:text-gray-300",children:e.categoria})}),Fe.jsx(Ur,{className:"text-sm text-slate-600 dark:text-gray-300",children:Fe.jsxs("div",{className:"flex items-center gap-2",children:[Fe.jsx(R,{size:14,className:"text-slate-400"}),new Date(e.data).toLocaleDateString("pt-BR")]})}),Fe.jsxs(Ur,{className:"font-semibold "+("receita"===e.tipo?"text-emerald-600":"text-red-600"),children:["despesa"===e.tipo?"-":"+",ln(e.valor)]}),Fe.jsx(Ur,{children:Fe.jsx("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium "+("pago"===e.status?"bg-emerald-50 text-emerald-700 border border-emerald-100":"bg-amber-50 text-amber-700 border border-amber-100"),children:"pago"===e.status?Fe.jsxs(Fe.Fragment,{children:[Fe.jsx(J,{size:12})," Pago"]}):Fe.jsxs(Fe.Fragment,{children:[Fe.jsx(z,{size:12})," Pendente"]})})}),Fe.jsx(Ur,{className:"text-right",children:Fe.jsxs("div",{className:"flex items-center justify-end gap-2",children:[Fe.jsx(Lr,{onClick:()=>w(e),icon:Q,tooltip:"Editar",ariaLabel:"Editar transação",variant:"primary"}),Fe.jsx(Lr,{onClick:()=>S(e._id,e.descricao),icon:te,tooltip:"Excluir",ariaLabel:"Excluir transação",variant:"danger",disabled:g===e._id,loading:g===e._id})]})})]},e._id))})]})]}):Fe.jsx("div",{className:"p-8",children:Fe.jsx(Tr,{icon:L,title:"Nenhuma transação encontrada",description:"Comece adicionando uma nova receita ou despesa.",action:Fe.jsx("button",{onClick:()=>h(!0),className:"btn btn-primary mt-4",children:"Nova Transação"})})})}),u&&Fe.jsx(nn,{transacao:b,onClose:()=>{h(!1),f(null),N()}})]})}function dn(){const[e,t]=i.useState(""),[s,a]=i.useState(null),r=[{id:"dashboard",icon:y,title:"Dashboard",color:"bg-blue-500",description:"Visão geral do sistema com métricas e gráficos",sections:[{title:"Visualizar Métricas",content:"Acompanhe em tempo real os indicadores principais: Pacientes Ativos, Prescrições Ativas, Agendamentos do Dia e Receita Mensal.",steps:["Acesse o Dashboard","Visualize os cards com métricas","Clique em cada card para detalhes"]},{title:"Analisar Gráficos",content:"Gráficos interativos mostram evolução de pacientes, comparativo financeiro e taxa de ocupação.",steps:["Passe o mouse sobre os gráficos","Veja detalhes por período","Use filtros para personalizar"]},{title:"Ações Rápidas",content:"Botões de acesso rápido para criar prescrições, agendamentos e evoluções diretamente do Dashboard.",steps:["Localize os botões de ação","Clique para criar novo item","Preencha e salve"]}],permissions:"Todos os usuários"},{id:"agenda",icon:R,title:"Agenda",color:"bg-purple-500",description:"Gerenciamento de agendamentos e compromissos",sections:[{title:"Criar Agendamento",content:"Agende consultas, visitas, procedimentos e reuniões com facilidade.",steps:['Clique em "+ Novo Agendamento"',"Selecione o paciente","Escolha tipo, data, hora e profissional","Adicione observações",'Clique em "Salvar"']},{title:"Visualizar Agenda",content:"Escolha entre visualização por dia, semana ou mês para melhor organização.",steps:["Selecione a visualização desejada","Navegue entre datas","Clique em agendamento para detalhes"]},{title:"Gerenciar Agendamentos",content:"Edite, confirme ou cancele agendamentos conforme necessário.",steps:["Clique no agendamento","Escolha ação: Editar, Confirmar ou Cancelar","Confirme a operação"]}],permissions:"Admin, Atendente, Enfermeiro, Fisioterapeuta"},{id:"cronograma",icon:z,title:"Cronograma",color:"bg-indigo-500",description:"Planejamento de tarefas e rotinas",sections:[{title:"Criar Tarefa",content:"Organize tarefas com prioridades, responsáveis e prazos definidos.",steps:['Clique em "+ Nova Tarefa"',"Defina título, descrição e prioridade","Atribua responsável e prazo","Configure recorrência se necessário","Salve a tarefa"]},{title:"Acompanhar Status",content:"Visualize tarefas pendentes, em progresso, concluídas ou atrasadas.",steps:["Veja quadro de tarefas","Filtre por status","Marque como concluída quando finalizar"]},{title:"Configurar Rotinas",content:"Crie tarefas recorrentes para medicação, higienização, alimentação e atividades.",steps:["Crie tarefa com recorrência","Defina frequência (diária, semanal, mensal)","Sistema criará automaticamente"]}],permissions:"Admin, Enfermeiro, Técnico de Enfermagem, Auxiliar Administrativo"},{id:"prescricoes",icon:Z,title:"Prescrições",color:"bg-green-500",description:"Gestão de prescrições médicas e veterinárias",sections:[{title:"Criar Prescrição",content:"Prescreva medicamentos com dosagem, via, frequência e duração detalhadas.",steps:['Clique em "+ Nova Prescrição"',"Selecione o paciente","Adicione medicamentos e dosagens","Defina via, frequência e duração","Adicione observações especiais","Salve a prescrição"]},{title:"Administrar Medicamento",content:"Registre cada administração de medicamento com horário e observações.",steps:["Abra prescrição ativa",'Clique em "Registrar Administração"',"Confirme horário e dosagem","Salve o registro"]},{title:"Renovar Prescrição",content:"Renove prescrições finalizadas com ajustes de datas e dosagens.",steps:["Abra prescrição finalizada",'Clique em "Renovar"',"Ajuste conforme necessário","Salve nova prescrição"]}],permissions:"Nutricionista/Admin (criar) | Enfermeiro/Técnico de Enfermagem (registrar administração)"},{id:"censo",icon:C,title:"Censo M.P.",color:"bg-amber-500",description:"Censo de medicamentos prescritos",sections:[{title:"Gerar Censo",content:"Relatório consolidado de todos os medicamentos em uso no período selecionado.",steps:["Selecione o período desejado",'Clique em "Gerar Censo"',"Analise os dados apresentados"]},{title:"Exportar Relatório",content:"Exporte censo em PDF, Excel ou CSV para impressão ou análise externa.",steps:['Clique em "Exportar"',"Escolha o formato","Salve ou imprima o arquivo"]},{title:"Mapa de Medicação",content:"Imprima mapa organizado por paciente, horário ou medicamento para a equipe.",steps:['Clique em "Imprimir Mapa"',"Escolha organização","Imprima para distribuição"]}],permissions:"Nutricionista, Enfermeiro, Técnico de Enfermagem, Admin"},{id:"pacientes",icon:S,title:"Pacientes",color:"bg-rose-500",description:"Cadastro completo de residentes ou pets",sections:[{title:"Cadastrar Paciente",content:"Registre dados pessoais, responsável, histórico médico e documentos.",steps:['Clique em "+ Novo Paciente"',"Preencha dados pessoais e contato","Cadastre responsável (obrigatório)","Adicione dados médicos e alergias","Defina status (Ativo, Inativo, Alta)","Salve o cadastro"]},{title:"Visualizar Prontuário",content:"Acesse prontuário completo com prescrições, evoluções, agendamentos e documentos.",steps:["Clique no paciente","Navegue pelas abas","Visualize histórico completo"]},{title:"Anexar Documentos",content:"Anexe exames, laudos, receitas e contratos ao prontuário do paciente.",steps:["Abra aba Documentos",'Clique em "+ Anexar"',"Selecione tipo e arquivo","Faça upload"]}],permissions:"Admin/Atendente (cadastrar/editar) | Demais perfis (visualizar conforme permissões)"},{id:"estoque",icon:T,title:"Estoque",color:"bg-orange-500",description:"Controle de medicamentos e materiais",sections:[{title:"Cadastrar Produto",content:"Registre medicamentos, alimentos, materiais e produtos com estoque mínimo.",steps:['Clique em "+ Novo Produto"',"Preencha nome, categoria e código","Defina unidade e estoque mínimo","Adicione localização e validade","Informe fornecedor e valor","Salve o produto"]},{title:"Movimentar Estoque",content:"Registre entradas e saídas com lote, validade e motivo.",steps:["Clique no produto","Escolha Entrada ou Saída","Preencha dados da movimentação","Salve o registro"]},{title:"Gerenciar Alertas",content:"Sistema alerta automaticamente sobre estoque baixo e produtos vencendo.",steps:["Visualize alertas no topo","Clique para ver detalhes","Tome ações necessárias"]}],permissions:"Admin/Auxiliar Administrativo (gerenciar) | Enfermeiro/Técnico de Enfermagem (movimentações)"},{id:"evolucao",icon:A,title:"Evolução",color:"bg-teal-500",description:"Acompanhamento clínico e evolução",sections:[{title:"Registrar Evolução",content:"Documente sinais vitais, observações clínicas e condutas realizadas.",steps:["Selecione o paciente",'Clique em "+ Nova Evolução"',"Registre sinais vitais","Descreva observações clínicas","Documente condutas realizadas","Salve a evolução"]},{title:"Consultar Histórico",content:"Visualize evolução do paciente ao longo do tempo com gráficos.",steps:["Abra paciente","Visualize todas evoluções","Use filtros por período","Analise gráficos"]},{title:"Imprimir Evolução",content:"Gere relatório em PDF de evolução específica ou período completo.",steps:["Selecione evolução",'Clique em "Imprimir"',"Escolha formato","Salve ou imprima"]}],permissions:"Enfermeiro/Técnico de Enfermagem (criar) | Todos (visualizar)"},{id:"financeiro",icon:L,title:"Financeiro",color:"bg-emerald-500",description:"Gestão de receitas e despesas",sections:[{title:"Registrar Receitas",content:"Lance mensalidades, serviços e produtos recebidos com forma de pagamento.",steps:['Clique em "+ Nova Receita"',"Preencha descrição e valor","Selecione categoria e paciente","Defina data e forma de pagamento","Anexe comprovante (opcional)","Salve o lançamento"]},{title:"Registrar Despesas",content:"Controle pagamentos a fornecedores, salários, aluguel e outras despesas.",steps:['Clique em "+ Nova Despesa"',"Informe descrição e valor","Selecione categoria e fornecedor","Defina data e status de pagamento","Salve o lançamento"]},{title:"Analisar Relatórios",content:"Visualize fluxo de caixa, DRE e relatórios por categoria ou período.",steps:['Clique em "Relatórios"',"Escolha tipo de relatório","Analise gráficos e tabelas","Exporte se necessário"]}],permissions:"Admin (total) | Auxiliar Administrativo (registrar)"},{id:"usuarios",icon:I,title:"Usuários",color:"bg-violet-500",description:"Gerenciamento de usuários e permissões",sections:[{title:"Criar Usuário",content:"Cadastre novos usuários com role, permissões e status definidos.",steps:['Clique em "+ Novo Usuário"',"Preencha dados pessoais","Defina e-mail e senha","Escolha a função (admin, enfermeiro, fisioterapeuta, etc.)","Selecione permissões de módulos","Defina status e salve"]},{title:"Gerenciar Permissões",content:"Controle acesso aos módulos do sistema por usuário ou role.",steps:["Abra usuário","Vá para Permissões","Marque/desmarque módulos","Salve alterações"]},{title:"Resetar Senha",content:"Redefina senha de usuários que esqueceram ou por segurança.",steps:["Clique no usuário",'Clique em "Resetar Senha"',"Digite nova senha","Confirme operação"]}],permissions:"Admin (própria empresa) | Superadmin (todos)"},{id:"empresas",icon:u,title:"Empresas",color:"bg-cyan-500",description:"Gerenciamento de empresas (Superadmin)",sections:[{title:"Criar Empresa",content:"Cadastre novas empresas com plano, módulos e administrador.",steps:['Clique em "+ Nova Empresa"',"Preencha dados cadastrais","Escolha tipo (Casa Repouso ou Petshop)","Defina plano e módulos","Crie administrador","Salve a empresa"]},{title:"Gerenciar Planos",content:"Faça upgrade/downgrade de planos e configure limites de usuários.",steps:["Abra empresa","Vá para Plano","Altere configurações","Salve mudanças"]},{title:"Relatório Consolidado",content:"Visualize métricas de todas as empresas cadastradas no sistema.",steps:['Clique em "Relatório Geral"',"Analise estatísticas","Exporte se necessário"]}],permissions:"Apenas Superadmin"},{id:"configuracoes",icon:$,title:"Configurações",color:"bg-slate-500",description:"Personalização e preferências",sections:[{title:"Editar Perfil",content:"Atualize foto, nome, e-mail, telefone e outros dados pessoais.",steps:["Acesse Configurações","Vá para Meu Perfil","Edite campos desejados","Salve alterações"]},{title:"Alterar Senha",content:"Troque sua senha regularmente para manter segurança.",steps:["Vá para Segurança","Digite senha atual","Digite nova senha duas vezes","Confirme alteração"]},{title:"Configurar Preferências",content:"Personalize tema, idioma, fuso horário e notificações.",steps:["Acesse Preferências","Ajuste configurações desejadas","Ative/desative notificações","Salve mudanças"]}],permissions:"Todos (próprio perfil) | Admin (empresa)"}].filter(t=>t.title.toLowerCase().includes(e.toLowerCase())||t.description.toLowerCase().includes(e.toLowerCase())),n=[{icon:F,text:"Use senhas fortes com mínimo 8 caracteres",color:"text-red-600"},{icon:Se,text:"Faça backup regular dos dados importantes",color:"text-green-600"},{icon:F,text:"Mantenha informações atualizadas no sistema",color:"text-blue-600"},{icon:Se,text:"Configure notificações para não perder prazos",color:"text-purple-600"}];return Fe.jsxs("div",{className:"space-y-6",children:[Fe.jsx(yr,{title:"Manual do Sistema",subtitle:"Guia completo de como utilizar cada módulo"}),Fe.jsx("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-slate-200",children:Fe.jsxs("div",{className:"relative",children:[Fe.jsx(U,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400",size:20}),Fe.jsx("input",{type:"text",placeholder:"Buscar por módulo ou funcionalidade...",value:e,onChange:e=>t(e.target.value),className:"w-full pl-12 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})}),Fe.jsxs("div",{className:"bg-gradient-to-br from-primary-50 to-purple-50 p-6 rounded-xl border border-primary-100",children:[Fe.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[Fe.jsx(we,{className:"text-primary-600",size:24}),Fe.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Dicas Rápidas"})]}),Fe.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:n.map((e,t)=>Fe.jsxs("div",{className:"flex items-start gap-3 bg-white p-4 rounded-lg",children:[Fe.jsx(e.icon,{className:e.color,size:20}),Fe.jsx("p",{className:"text-sm text-slate-700",children:e.text})]},t))})]}),s?Fe.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[Fe.jsxs("div",{className:`${s.color} p-6 text-white`,children:[Fe.jsxs("button",{onClick:()=>a(null),className:"mb-4 flex items-center gap-2 text-white/80 hover:text-white transition-colors",children:[Fe.jsx(Ce,{size:20,className:"rotate-180"}),Fe.jsx("span",{children:"Voltar para módulos"})]}),Fe.jsxs("div",{className:"flex items-center gap-4",children:[Fe.jsx("div",{className:"w-16 h-16 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center",children:Fe.jsx(s.icon,{size:32})}),Fe.jsxs("div",{children:[Fe.jsx("h2",{className:"text-3xl font-bold mb-1",children:s.title}),Fe.jsx("p",{className:"text-white/90",children:s.description})]})]})]}),Fe.jsxs("div",{className:"p-6 space-y-6",children:[Fe.jsx("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-200",children:Fe.jsxs("div",{className:"flex items-center gap-2 text-slate-700",children:[Fe.jsx(I,{size:18}),Fe.jsx("span",{className:"font-medium",children:"Permissões necessárias:"}),Fe.jsx("span",{className:"text-slate-600",children:s.permissions})]})}),s.sections.map((e,t)=>Fe.jsxs("div",{className:"border-l-4 border-primary-500 pl-6 py-2",children:[Fe.jsxs("h3",{className:"text-xl font-semibold text-slate-900 mb-3 flex items-center gap-2",children:[Fe.jsx("span",{className:"flex items-center justify-center w-8 h-8 bg-primary-100 text-primary-600 rounded-full text-sm font-bold",children:t+1}),e.title]}),Fe.jsx("p",{className:"text-slate-700 mb-4 leading-relaxed",children:e.content}),e.steps&&Fe.jsxs("div",{className:"space-y-2",children:[Fe.jsx("p",{className:"text-sm font-medium text-slate-600 mb-2",children:"Passo a passo:"}),e.steps.map((e,t)=>Fe.jsxs("div",{className:"flex items-start gap-3 bg-slate-50 p-3 rounded-lg",children:[Fe.jsx("span",{className:"flex items-center justify-center w-6 h-6 bg-primary-600 text-white rounded-full text-xs font-bold flex-shrink-0 mt-0.5",children:t+1}),Fe.jsx("p",{className:"text-sm text-slate-700",children:e})]},t))]})]},t)),Fe.jsxs("div",{className:"flex flex-wrap gap-4 pt-4 border-t border-slate-200",children:[Fe.jsxs("button",{onClick:()=>window.open("/docs/MANUAL_COMPLETO_SISTEMA.md","_blank"),className:"flex items-center gap-2 px-6 py-3 bg-primary-600 hover:bg-primary-700 text-white font-semibold rounded-xl transition-colors",children:[Fe.jsx(P,{size:20}),Fe.jsx("span",{children:"Baixar Manual Completo"})]}),Fe.jsxs("button",{onClick:()=>window.open("mailto:suporte@prescrimed.com","_blank"),className:"flex items-center gap-2 px-6 py-3 bg-slate-200 hover:bg-slate-300 text-slate-700 font-semibold rounded-xl transition-colors",children:[Fe.jsx(ke,{size:20}),Fe.jsx("span",{children:"Contatar Suporte"})]})]})]})]}):Fe.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map(e=>{const t=e.icon;return Fe.jsxs("button",{onClick:()=>a(e),className:"bg-white p-6 rounded-xl shadow-sm border border-slate-200 hover:shadow-lg transition-all duration-200 text-left group",children:[Fe.jsxs("div",{className:"flex items-start justify-between mb-4",children:[Fe.jsx("div",{className:`w-14 h-14 ${e.color} rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform`,children:Fe.jsx(t,{className:"text-white",size:28})}),Fe.jsx(Ce,{className:"text-slate-400 group-hover:text-primary-600 transition-colors",size:24})]}),Fe.jsx("h3",{className:"text-xl font-semibold text-slate-900 mb-2",children:e.title}),Fe.jsx("p",{className:"text-sm text-slate-600 mb-3",children:e.description}),Fe.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[Fe.jsx(I,{size:14}),Fe.jsx("span",{children:e.permissions})]})]},e.id)})}),Fe.jsx("div",{className:"bg-gradient-to-br from-slate-800 to-slate-900 text-white p-8 rounded-xl",children:Fe.jsxs("div",{className:"max-w-3xl mx-auto text-center",children:[Fe.jsx("h3",{className:"text-2xl font-bold mb-4",children:"Precisa de Ajuda?"}),Fe.jsx("p",{className:"text-slate-300 mb-6",children:"Nossa equipe de suporte está pronta para ajudar você com qualquer dúvida ou problema."}),Fe.jsxs("div",{className:"flex flex-wrap justify-center gap-4",children:[Fe.jsx("a",{href:"mailto:suporte@prescrimed.com",className:"flex items-center gap-2 px-6 py-3 bg-white text-slate-900 font-semibold rounded-xl hover:bg-slate-100 transition-colors",children:"📧 suporte@prescrimed.com"}),Fe.jsx("a",{href:"https://wa.me/5571999999999",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-6 py-3 bg-green-600 text-white font-semibold rounded-xl hover:bg-green-700 transition-colors",children:"📱 WhatsApp"})]}),Fe.jsx("p",{className:"text-sm text-slate-400 mt-4",children:"Horário de atendimento: Segunda a Sexta, 8h às 18h"})]})})]})}function cn({onClose:e}){const{user:t,logout:s,hasPermission:a}=Ya(),r=[{path:"/dashboard",label:"Dashboard",icon:Ae,permission:null},{path:"/agenda",label:"Agenda",icon:R,permission:"agenda"},{path:"/cronograma",label:"Cronograma",icon:Ee,permission:"cronograma"},{path:"/prescricoes",label:"Prescrições",icon:C,permission:"prescricoes"},{path:"/censo-mp",label:"Censo M.P",icon:Pe,permission:"prescricoes"},{path:"/residentes",label:"Pacientes",icon:S,permission:"pacientes"},{path:"/estoque",label:"Estoque",icon:T,permission:"estoque"},{path:"/evolucao",label:"Evolução",icon:_,permission:"evolucao"},{path:"/financeiro",label:"Financeiro",icon:L,permission:"financeiro"},{path:"/usuarios",label:"Usuários",icon:Re,roles:["admin","superadmin"]},{path:"/configuracoes",label:"Configurações",icon:$,permission:"configuracoes"},{path:"/manual",label:"Manual",icon:we,permission:null},{path:"/empresas",label:"Empresas",icon:u,roles:["superadmin"]}];return Fe.jsxs("aside",{className:"h-full w-72 bg-primary-900 text-white flex flex-col border-r border-white/5 shadow-2xl",children:[Fe.jsxs("div",{className:"h-20 px-6 border-b border-white/10 flex items-center justify-between",children:[Fe.jsxs("div",{children:[Fe.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-primary-200",children:"Prescrimed"}),Fe.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Painel"})]}),Fe.jsx("button",{className:"lg:hidden p-2 rounded-xl bg-white/10 hover:bg-white/20 transition",onClick:()=>e?.(),children:Fe.jsx(q,{size:18})})]}),Fe.jsxs("div",{className:"px-6 py-5 border-b border-white/10",children:[Fe.jsx("p",{className:"text-sm text-primary-100",children:"Bem-vindo"}),Fe.jsx("p",{className:"text-lg font-semibold",children:t?.nome}),Fe.jsx("p",{className:"text-sm text-primary-200/60 truncate",title:t?.empresa?.nome||t?.email,children:t?.empresa?.nome||t?.email}),("admin"===t?.role||"superadmin"===t?.role)&&Fe.jsx("span",{className:"inline-flex items-center gap-2 mt-3 px-3 py-1 rounded-full bg-white/10 text-xs font-semibold text-primary-300",children:"superadmin"===t?.role?"Super Admin":"Administrador"})]}),Fe.jsxs("nav",{className:"flex-1 overflow-y-auto px-4 py-6",children:[Fe.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-primary-300/50 mb-4",children:"Navegação"}),Fe.jsx("ul",{className:"space-y-2",children:r.map(s=>"superadmin"===t?.role?Fe.jsx("li",{children:Fe.jsxs(l,{to:s.path,onClick:()=>e?.(),className:({isActive:e})=>"flex items-center gap-3 px-4 py-3 rounded-2xl transition-all duration-200 "+(e?"bg-white text-primary-900 shadow-xl":"text-primary-100 hover:bg-white/10"),children:[Fe.jsx(s.icon,{size:20}),Fe.jsx("span",{children:s.label})]})},s.path):s.roles&&!s.roles.includes(t?.role)||s.permission&&!a(s.permission)?null:Fe.jsx("li",{children:Fe.jsxs(l,{to:s.path,onClick:()=>e?.(),className:({isActive:e})=>"flex items-center gap-3 px-4 py-3 rounded-2xl transition-all duration-200 "+(e?"bg-white text-primary-900 shadow-xl":"text-primary-100 hover:bg-white/10"),children:[Fe.jsx(s.icon,{size:20}),Fe.jsx("span",{children:s.label})]})},s.path))})]}),Fe.jsx("div",{className:"px-4 py-6 border-t border-white/10",children:Fe.jsxs("button",{onClick:s,className:"w-full flex items-center justify-center gap-2 px-4 py-3 rounded-2xl bg-white/10 hover:bg-white/20 transition text-red-100",children:[Fe.jsx(ze,{size:18}),Fe.jsx("span",{children:"Sair"})]})})]})}function mn({onToggleSidebar:e}){const{user:t}=Ya(),s=r(),[a,n]=i.useState([]),[l,o]=i.useState(()=>localStorage.getItem("superadminEmpresaId")||""),d="superadmin"===t?.role;i.useEffect(()=>{if(!d)return;let e=!0;return(async()=>{try{const t=await wi.getAll();if(!e)return;const s=Array.isArray(t)?t:t?.empresas||t?.data||[];n(Array.isArray(s)?s:[])}catch{}})(),()=>{e=!1}},[d]);const c=i.useMemo(()=>(Array.isArray(a)?a:[]).map(e=>({id:e.id,nome:e.nome})).filter(e=>e.id&&e.nome),[a]),m=i.useMemo(()=>{if(!l)return"";const e=c.find(e=>String(e.id)===String(l));return e?.nome||""},[l,c]),x=e=>{if(o(e),!e)return localStorage.removeItem("superadminEmpresaId"),p.success("Modo superadmin: exibindo todas as empresas"),void Ta(null);localStorage.setItem("superadminEmpresaId",e),p.success("Empresa selecionada para navegação"),Ta(e)};return Fe.jsx("header",{className:"sticky top-0 z-10 bg-white/80 backdrop-blur-xl border-b border-slate-100",children:Fe.jsxs("div",{className:"h-20 px-4 lg:px-8 flex items-center justify-between gap-4",children:[Fe.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[Fe.jsx("button",{className:"lg:hidden p-2 rounded-xl bg-slate-100 text-slate-600 hover:bg-slate-200 transition",onClick:e,children:Fe.jsx(De,{size:20})}),Fe.jsx("div",{className:"hidden sm:block flex-1",children:Fe.jsxs("div",{className:"relative",children:[Fe.jsx(U,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400",size:20}),Fe.jsx("input",{type:"text",placeholder:"Pesquisar pacientes, prescrições ou usuários",className:"w-full pl-12 pr-4 py-3 rounded-2xl border border-slate-200 bg-white focus:outline-none focus:ring-2 focus:ring-primary-400 text-sm text-slate-700"})]})})]}),Fe.jsxs("div",{className:"flex items-center gap-3",children:[d&&Fe.jsxs(Fe.Fragment,{children:[Fe.jsxs("div",{className:"hidden sm:flex items-center gap-2 px-3 py-2 bg-slate-100 rounded-2xl",children:[Fe.jsx(u,{size:18,className:"text-slate-500"}),Fe.jsxs("select",{value:l,onChange:e=>x(e.target.value),className:"bg-transparent text-sm text-slate-700 font-medium focus:outline-none max-w-[260px]",title:"Selecionar empresa (contexto do superadmin)",children:[Fe.jsx("option",{value:"",children:"Todas as empresas"}),c.map(e=>Fe.jsx("option",{value:e.id,children:e.nome},e.id))]}),l&&Fe.jsx("button",{type:"button",onClick:()=>x(""),className:"p-1 rounded-xl hover:bg-slate-200 transition",title:"Limpar seleção",children:Fe.jsx(q,{size:16,className:"text-slate-500"})})]}),Fe.jsxs("div",{className:"sm:hidden inline-flex items-center gap-2 px-3 py-2 bg-slate-100 rounded-2xl",children:[Fe.jsx(u,{size:16,className:"text-slate-500"}),Fe.jsx("span",{className:"text-xs font-semibold text-slate-700 truncate max-w-[140px]",title:l?m||String(l):"Todas as empresas",children:l?m||`Empresa ${l}`:"Todas"}),l&&Fe.jsx("button",{type:"button",onClick:()=>x(""),className:"p-1 rounded-xl hover:bg-slate-200 transition",title:"Limpar seleção",children:Fe.jsx(q,{size:14,className:"text-slate-500"})})]})]}),Fe.jsx("button",{onClick:()=>s("/censo-mp"),className:"hidden sm:inline-flex items-center px-4 py-2 rounded-2xl bg-primary-50 text-primary-600 text-sm font-semibold hover:bg-primary-100 transition",children:"Nova Prescrição"}),Fe.jsxs("button",{className:"relative p-3 rounded-2xl bg-slate-100 text-slate-600 hover:bg-slate-200 transition",children:[Fe.jsx(re,{size:20}),Fe.jsx("span",{className:"absolute top-2 right-2 w-2 h-2 bg-red-400 rounded-full"})]}),Fe.jsxs("div",{className:"flex items-center gap-3 px-3 py-2 bg-slate-100 rounded-2xl",children:[Fe.jsxs("div",{className:"hidden sm:flex flex-col text-xs text-slate-500 leading-tight",children:[Fe.jsx("span",{children:"Conectado"}),Fe.jsx("span",{className:"text-slate-800 font-semibold text-sm",children:t?.nome})]}),Fe.jsx("div",{className:"w-11 h-11 rounded-2xl bg-gradient-to-br from-primary-600 to-primary-700 flex items-center justify-center text-white text-lg font-semibold",children:t?.nome?.charAt(0).toUpperCase()})]})]})]})})}function xn(){const[e,t]=i.useState(!1);return Fe.jsxs("div",{className:"min-h-screen bg-slate-100 flex",children:[Fe.jsx("div",{className:`\n          fixed inset-y-0 left-0 z-40 w-72 \n          transform transition-transform duration-300 \n          lg:static lg:translate-x-0 \n          ${e?"translate-x-0":"-translate-x-full"}\n        `,children:Fe.jsx(cn,{onClose:()=>t(!1)})}),e&&Fe.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-30 lg:hidden",onClick:()=>t(!1)}),Fe.jsxs("div",{className:"flex-1 flex flex-col min-h-screen",children:[Fe.jsx(mn,{onToggleSidebar:()=>t(e=>!e)}),Fe.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-8",children:Fe.jsx("div",{className:"max-w-6xl mx-auto space-y-6",children:Fe.jsx(o,{})})})]})]})}const pn=({children:e,requiredPermission:t})=>{const{isAuthenticated:s,hasPermission:a}=Ya();return s?t&&!a(t)?Fe.jsx(d,{to:"/dashboard",replace:!0}):e:Fe.jsx(d,{to:"/login",replace:!0})};function un(){const[e,t]=i.useState("online"),[s,a]=i.useState(!1),[r,n]=i.useState(null),[l,o]=i.useState(null);if(i.useEffect(()=>{const e=async e=>{let s=null;try{s=await e.clone().json()}catch(i){s=null}if(e.ok&&!s)return t("offline"),o(null),void a(!0);if(503===e.status)return t("degraded"),o("connecting"),void a(!0);if(!e.ok)return t("offline"),o(null),void a(!0);const r=s?.database;if(r&&"connected"!==r)return t("degraded"),o(r),void a(!0);t("online"),o(r||"connected"),a(!1)},s=async()=>{try{const r=Oa();let i=!1;try{if(r){i=new URL(r).origin===window.location.origin}else i=!0}catch(s){i=!1}if(i){const t=await fetch("/health",{method:"GET",signal:AbortSignal.timeout(5e3)});return await e(t),void n(new Date)}if(!r){if(window.location.hostname.includes("railway.app")){const t=await fetch("/health",{method:"GET",signal:AbortSignal.timeout(5e3)});return await e(t),void n(new Date)}return t("online"),o(null),a(!1),void n(new Date)}if(r.includes("localhost")&&(window.location.hostname.includes("railway.app")||window.location.hostname.includes("github.io")))return t("offline"),o(null),a(!0),void n(new Date);const l=`${r}/health`,d=await fetch(l,{method:"GET",mode:"cors",signal:AbortSignal.timeout(5e3)});await e(d)}catch(r){t("offline"),o(null),a(!0)}n(new Date)};s();const r=setInterval(s,3e4);return()=>clearInterval(r)},[]),!s)return null;const d="offline"===e,c="degraded"===e,m=d?"Backend Offline":"Backend Online (Banco Inicializando)",x=d?"Não foi possível conectar ao servidor. Verifique se o backend está rodando.":"O servidor respondeu, mas o banco de dados ainda não está conectado. Aguarde alguns instantes e tente novamente.",p=Oa()?Oa()+"/health":null,u=d?"bg-red-600":"bg-amber-500",h=d?"bg-red-700":"bg-amber-600";return Fe.jsxs("div",{className:"fixed top-0 left-0 right-0 z-50 animate-slide-down",children:[Fe.jsx("div",{className:`${u} text-white px-4 py-3 shadow-lg`,children:Fe.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[Fe.jsxs("div",{className:"flex items-center gap-3",children:[d?Fe.jsx(Te,{className:"w-5 h-5 animate-pulse"}):Fe.jsx(F,{className:"w-5 h-5"}),Fe.jsxs("div",{children:[Fe.jsx("p",{className:"font-semibold",children:m}),Fe.jsx("p",{className:"text-sm opacity-90",children:x}),c&&l?Fe.jsxs("p",{className:"text-xs opacity-90 mt-1",children:["Status do banco: ",Fe.jsx("span",{className:"font-semibold",children:l})]}):null]})]}),Fe.jsxs("div",{className:"flex items-center gap-4",children:[p?Fe.jsx("a",{href:p,target:"_blank",rel:"noopener noreferrer",className:"text-sm underline hover:no-underline",children:"Testar Conexão"}):null,Fe.jsx("button",{onClick:()=>a(!1),className:"text-white hover:bg-black/15 rounded p-1 transition-colors","aria-label":"Fechar alerta",children:"✕"})]})]})}),Fe.jsx("div",{className:`${h} px-4 py-2`,children:Fe.jsx("div",{className:"max-w-7xl mx-auto",children:Fe.jsxs("p",{className:"text-sm text-white/90",children:[Fe.jsx("strong",{children:"Como resolver:"})," ",d?Fe.jsxs(Fe.Fragment,{children:["Verifique se a API está rodando no Railway e se as variáveis ",Fe.jsx("code",{className:"bg-black/20 px-2 py-1 rounded text-xs",children:"VITE_BACKEND_ROOT"})," ou ",Fe.jsx("code",{className:"bg-black/20 px-2 py-1 rounded text-xs",children:"VITE_API_URL"})," estão configuradas corretamente no frontend."]}):Fe.jsxs(Fe.Fragment,{children:["No Railway, confirme se o Postgres foi criado e se ",Fe.jsx("code",{className:"bg-black/20 px-2 py-1 rounded text-xs",children:"DATABASE_URL"})," está presente. Enquanto isso, o sistema pode ficar parcialmente indisponível."]})]})})})]})}function hn(){return Fe.jsxs(Fe.Fragment,{children:[Fe.jsx(un,{}),Fe.jsx(c,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:Fe.jsxs(m,{children:[Fe.jsx(x,{path:"/login",element:Fe.jsx(dr,{})})," ",Fe.jsx(x,{path:"/register",element:Fe.jsx(ur,{})})," ",Fe.jsxs(x,{path:"/",element:Fe.jsxs(pn,{children:[" ",Fe.jsx(xn,{})," "]}),children:[Fe.jsx(x,{index:!0,element:Fe.jsx(d,{to:"dashboard",replace:!0})}),Fe.jsx(x,{path:"dashboard",element:Fe.jsx(wr,{})}),Fe.jsx(x,{path:"agenda",element:Fe.jsx(pn,{children:Fe.jsx($i,{})})}),Fe.jsx(x,{path:"cronograma",element:Fe.jsx(pn,{children:Fe.jsx(Oi,{})})}),Fe.jsx(x,{path:"censo-mp",element:Fe.jsx(pn,{requiredPermission:"prescricoes",children:Fe.jsx(xi,{})})}),Fe.jsx(x,{path:"prescricoes",element:Fe.jsx(pn,{requiredPermission:"prescricoes",children:Fe.jsx(mi,{})})}),Fe.jsx(x,{path:"estoque",element:Fe.jsx(pn,{children:Fe.jsx(Qi,{})})}),Fe.jsx(x,{path:"evolucao",element:Fe.jsx(pn,{children:Fe.jsx(Zi,{})})}),Fe.jsx(x,{path:"financeiro",element:Fe.jsx(pn,{children:Fe.jsx(on,{})})}),Fe.jsx(x,{path:"residentes",element:Fe.jsx(pn,{requiredPermission:"pacientes",children:Fe.jsx(li,{})})}),Fe.jsx(x,{path:"pacientes",element:Fe.jsx(d,{to:"/residentes",replace:!0})}),Fe.jsx(x,{path:"usuarios",element:Fe.jsx(pn,{requiredPermission:"usuarios",children:Fe.jsx(Ni,{})})}),Fe.jsx(x,{path:"empresas",element:Fe.jsx(pn,{children:Fe.jsx(Ci,{})})}),Fe.jsx(x,{path:"backups",element:Fe.jsx(pn,{children:Fe.jsx(Ri,{})})}),Fe.jsx(x,{path:"configuracoes",element:Fe.jsx(pn,{requiredPermission:"configuracoes",children:Fe.jsx(zi,{})})}),Fe.jsx(x,{path:"manual",element:Fe.jsx(pn,{children:Fe.jsx(dn,{})})})]}),Fe.jsx(x,{path:"*",element:Fe.jsx(d,{to:"/login",replace:!0})})]})}),Fe.jsx(_e,{position:"top-right"})]})}class bn extends a.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){}render(){return this.state.hasError?Fe.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-50 p-4",children:Fe.jsxs("div",{className:"bg-white p-8 rounded-2xl shadow-xl max-w-md w-full text-center",children:[Fe.jsx("h1",{className:"text-2xl font-bold text-slate-900 mb-4",children:"Algo deu errado"}),Fe.jsx("p",{className:"text-slate-600 mb-6",children:"Ocorreu um erro inesperado na aplicação. Tente recarregar a página."}),Fe.jsx("pre",{className:"text-xs text-left bg-slate-100 p-4 rounded-lg overflow-auto mb-6 text-red-600",children:this.state.error?.toString()}),Fe.jsx("button",{onClick:()=>window.location.reload(),className:"bg-primary-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-primary-700 transition",children:"Recarregar Página"}),Fe.jsx("button",{onClick:()=>{localStorage.clear(),window.location.reload()},className:"block w-full mt-3 text-sm text-slate-500 hover:text-slate-700",children:"Limpar dados e recarregar"})]})}):this.props.children}}Me.createRoot(document.getElementById("root")).render(Fe.jsx(a.StrictMode,{children:Fe.jsx(bn,{children:Fe.jsx(hn,{})})}));
